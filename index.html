<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>x5456</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="x5456">
<meta property="og:url" content="https://x54256.github.io/index.html">
<meta property="og:site_name" content="x5456">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="x5456">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">x5456</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">个人博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://x54256.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-SpringBoot+SpringDataJpa进阶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/29/SpringBoot+SpringDataJpa进阶/" class="article-date">
  <time datetime="2018-09-29T02:00:13.000Z" itemprop="datePublished">2018-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/SpringBoot+SpringDataJpa进阶/">Jpa的分页和@Query注解的使用和复杂查询，boot排除自动配置类，为true才启用配置类，SQL分组的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1、SpringDataJpa‘原生sql’查询"><a href="#1、SpringDataJpa‘原生sql’查询" class="headerlink" title="1、SpringDataJpa‘原生sql’查询"></a>1、SpringDataJpa‘原生sql’查询</h3><p>在SpringDataJpa中，单表操作可以使用Jpa自动生成的方法进行操作，那么下面的sql语句要怎样实现呢，这时候就需要使用@Query注解。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> u.userguid userCode,</span><br><span class="line">        u.username,</span><br><span class="line">        u.loginname,</span><br><span class="line">        u.email,</span><br><span class="line">        u.currentstatus <span class="keyword">status</span>,</span><br><span class="line">        u.datecreated,</span><br><span class="line">        o.orgname,</span><br><span class="line">        o.orgguid orgCode</span><br><span class="line">   <span class="keyword">from</span> sys_users u</span><br><span class="line">   <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> sys_organization_user o2u <span class="keyword">on</span> u.userguid =</span><br><span class="line">                                                o2u.userguid</span><br><span class="line">   <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> sys_organization o <span class="keyword">on</span> o2u.orgguid = o.orgguid</span><br><span class="line">  <span class="keyword">where</span> u.loginname = p_loginName</span><br><span class="line">    <span class="keyword">and</span> u.currentstatus = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>1、首先需要上面这三个表的实体类（Entriy）</p>
<p>以sys_users表为例</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180929/69l97adGcF.png?imageslim" alt="mark"></p>
<p>2、继承JpaRepository接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">SysUsersEntity</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(value = <span class="string">"select new cn.x5456.dist.vo.UserOrgVO(u.userguid,u.username,u.loginname,u.email,u.currentstatus,u.datecreated,o.orgname,o.orgguid)"</span> +</span><br><span class="line">            <span class="string">"from SysUsersEntity u "</span> +</span><br><span class="line">            <span class="string">"left join SysOrganizationUserEntity o2u on u.userguid=o2u.userguid "</span> +</span><br><span class="line">            <span class="string">"left join SysOrganizationEntity o on o2u.orgguid = o.orgguid "</span> +</span><br><span class="line">            <span class="string">"where u.loginname = ?1 and u.currentstatus = 1"</span>)</span><br><span class="line">    <span class="function">List&lt;UserOrgVO&gt; <span class="title">findUserByLoginName</span><span class="params">(String loginname)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>==注意点==：</p>
<ul>
<li>使用?1来做占位符</li>
<li>VO必须要有有参构造，而且类型不能错</li>
</ul>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180929/IhFc965ADB.png?imageslim" alt="mark"></p>
<ul>
<li>from的表名要是实体类名</li>
</ul>
<h3 id="2、SpringDataJpa分页查询"><a href="#2、SpringDataJpa分页查询" class="headerlink" title="2、SpringDataJpa分页查询"></a>2、SpringDataJpa分页查询</h3><p>此部分代码是<a href="https://docs.spring.io/spring-data/jpa/docs/2.1.0.RELEASE/reference/html/#jpa.query-methods.at-query" target="_blank" rel="noopener">官方文档</a>上的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Query</span>(value = <span class="string">"SELECT * FROM USERS WHERE LASTNAME = ?1"</span>,</span><br><span class="line">    countQuery = <span class="string">"SELECT count(*) FROM USERS WHERE LASTNAME = ?1"</span>,</span><br><span class="line">    nativeQuery = <span class="keyword">true</span>)</span><br><span class="line">  <span class="function">Page&lt;User&gt; <span class="title">findByLastname</span><span class="params">(String lastname, Pageable pageable)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>nativeQuery：是否使用原生SQL查询</li>
<li>countQuery：由于使用了原生SQL查询，分页查询就不能使用了，所以必须加上这个字段，现获取下数据库中数据的总数</li>
<li>Pageable对象的构造：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringBoot2.x版本的写法**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * arg1：第几页</span></span><br><span class="line"><span class="comment"> * arg2：每页显示几个</span></span><br><span class="line"><span class="comment"> * arg3：正序还是倒序</span></span><br><span class="line"><span class="comment"> * argsssss：按照哪些字段进行排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Pageable pageable = PageRequest.of(<span class="number">1</span>, <span class="number">10</span>, Sort.Direction.ASC, <span class="string">"xxx"</span>,<span class="string">"yyy"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="3、SpringDataJpa做复杂查询"><a href="#3、SpringDataJpa做复杂查询" class="headerlink" title="3、SpringDataJpa做复杂查询"></a>3、SpringDataJpa做复杂查询</h3><p>同样SpringDataJpa也提供了一个接口，方便我们做复杂查询的，我们需要继承JpaSpecificationExecutor接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JpaSpecificationExecutor接口源码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">findOne</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Page&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Pageable pageable)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Sort sort)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">count</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们发现所有的方法都需要我们传入一个Specification对象，Specification源码</span></span><br><span class="line"><span class="comment">// 里面只有一个方法toPredicate，我们需要按照JPA 2.0 criteria api写好查询条件就可以了</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Specification</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多表查询时依赖注解@ManyToMany..</p>
<p><a href="https://blog.csdn.net/yingxiake/article/details/51014223" target="_blank" rel="noopener">参考博客</a></p>
<h3 id="4、SpringBoot排除扫描自动配置类"><a href="#4、SpringBoot排除扫描自动配置类" class="headerlink" title="4、SpringBoot排除扫描自动配置类"></a>4、SpringBoot排除扫描自动配置类</h3><p>由于我们将entriy的类放在了==api==包中，而且在api包中引入了spring-boot-jpa.jar，所以我们在web层的时候，就必须排除Jpa相关的自动配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span>(exclude = &#123;DataSourceAutoConfiguration.class, DataSourceTransactionManagerAutoConfiguration.class,</span><br><span class="line">      HibernateJpaAutoConfiguration.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DgpwhServerWebApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      SpringApplication.run(DgpwhServerWebApplication.class, args);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>==注意点==：</p>
<ul>
<li>api中的entriy必须要在service层的主启动类的目录下</li>
</ul>
<h3 id="5、为true才启用下面的配置"><a href="#5、为true才启用下面的配置" class="headerlink" title="5、为true才启用下面的配置"></a>5、为true才启用下面的配置</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180930/L4gA7id0A6.png?imageslim" alt="mark"></p>
<h3 id="6、SQL分组的使用"><a href="#6、SQL分组的使用" class="headerlink" title="6、SQL分组的使用"></a>6、SQL分组的使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按照项目总流水号分组，并按照项目总流水号排序</span></span><br><span class="line"><span class="comment">-- flag为组内的序号</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	row_number()<span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> t.项目总流水号 <span class="keyword">ORDER</span> <span class="keyword">BY</span> t.项目总流水号) flag,</span><br><span class="line">	t.* </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	ts_project@dblink_ncgg t </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">	t.生命状态=<span class="string">'正常'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180930/L92Ea49C9G.png?imageslim" alt="mark"></p>
<h3 id="7、springboot2-0双数据源"><a href="#7、springboot2-0双数据源" class="headerlink" title="7、springboot2.0双数据源"></a>7、springboot2.0双数据源</h3><p>参考文章</p>
<h3 id="8、cas架构"><a href="#8、cas架构" class="headerlink" title="8、cas架构"></a>8、cas架构</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180930/idi3hKkjbC.png?imageslim" alt="mark"></p>
<h3 id="9、spring中mongo上传文件demo"><a href="#9、spring中mongo上传文件demo" class="headerlink" title="9、spring中mongo上传文件demo"></a>9、spring中mongo上传文件demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getExportExcelFileId</span><span class="params">()</span></span>&#123;</span><br><span class="line">    log.debug(<span class="string">"开始导出为Excel"</span>);</span><br><span class="line">    <span class="comment">// xin.我觉得要是我的话，我就把数据返回给web层，让web自己处理（不过这样是不好的）</span></span><br><span class="line">    List&lt;ProjectLibEntity&gt; entities = projectLibDAO.find(<span class="string">"id"</span>,<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">final</span> String excelFileName = <span class="string">"项目库导出"</span> + System.currentTimeMillis() + <span class="string">".xls"</span>;</span><br><span class="line">    String fileId = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>(ByteArrayOutputStream bout = <span class="keyword">new</span> ByteArrayOutputStream();) &#123;</span><br><span class="line">        <span class="comment">// excel生成工具类：               实体类型           实体    输出流</span></span><br><span class="line">        ExcelUtilsFixed.export2Xls(ProjectLibEntity.class,entities,bout, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">try</span>(ByteArrayInputStream bin = <span class="keyword">new</span> ByteArrayInputStream(bout.toByteArray()))&#123;</span><br><span class="line">            fileId = cacheFile.uploadMongoDB(excelFileName,bin);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">"生成Excel表格失败"</span>,e);</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">"Excel文件id&gt;&gt;"</span> + fileId);</span><br><span class="line">    <span class="keyword">return</span> fileId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ExcelUtilsFixed：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.dist.excel.context.ExcelTableAdapter;</span><br><span class="line"><span class="keyword">import</span> com.dist.excel.exception.NodeNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelUtilsFixed</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">export2Xls</span><span class="params">(Class&lt;T&gt; c, List&lt;T&gt; sourceList, OutputStream os, CellStyle titleStyle, CellStyle... dataStyles)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Workbook workbook = <span class="keyword">new</span> XSSFWorkbook();</span><br><span class="line">        exportExcel(c, sourceList, workbook, os, titleStyle, dataStyles);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">exportExcel</span><span class="params">(Class&lt;T&gt; c, List&lt;T&gt; sourceList, Workbook workbook, OutputStream os, CellStyle titleStyle, CellStyle... dataStyles)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, List&lt;Map&lt;String, String&gt;&gt;&gt; baseMap = ExcelTableAdapter.build().getMap();</span><br><span class="line">        List&lt;Map&lt;String, String&gt;&gt; fieldList = (List)baseMap.get(c.getSimpleName());</span><br><span class="line">        Sheet sheet = workbook.createSheet(c.getSimpleName());</span><br><span class="line">        <span class="keyword">if</span> (fieldList == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NodeNotFoundException(<span class="string">"Node \""</span> + c.getSimpleName() + <span class="string">"\" not found"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            List&lt;String&gt; fieldNameList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            Map&lt;Integer, String&gt; columnMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">            Map&lt;Integer, String&gt; columnTypeMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">            Map&lt;Integer, String&gt; fieldValueMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">            Field[] fields = c.getDeclaredFields();</span><br><span class="line">            Field[] arr$ = fields;</span><br><span class="line">            <span class="keyword">int</span> len$ = fields.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> rowIndex;</span><br><span class="line">            <span class="keyword">for</span>(rowIndex = <span class="number">0</span>; rowIndex &lt; len$; ++rowIndex) &#123;</span><br><span class="line">                Field field = arr$[rowIndex];</span><br><span class="line">                fieldNameList.add(field.getName());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> columnIndex = <span class="number">0</span>;</span><br><span class="line">            Iterator it = fieldList.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">                Map&lt;String, String&gt; fieldMap = (Map)it.next();</span><br><span class="line">                ++columnIndex;</span><br><span class="line">                Iterator it2 = fieldMap.keySet().iterator();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(it2.hasNext()) &#123;</span><br><span class="line">                    String key = (String)it2.next();</span><br><span class="line">                    String fieldName = (String)fieldMap.get(key);</span><br><span class="line">                    <span class="keyword">if</span> (fieldNameList.contains(fieldName)) &#123;</span><br><span class="line">                        columnMap.put(columnIndex, key);</span><br><span class="line">                        columnTypeMap.put(columnIndex, fieldMap.get(<span class="string">"type"</span>));</span><br><span class="line">                        fieldValueMap.put(columnIndex, fieldName);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Row titleRow = sheet.createRow(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(rowIndex = <span class="number">1</span>; rowIndex &lt;= columnMap.keySet().size(); ++rowIndex) &#123;</span><br><span class="line">                Cell cell = titleRow.createCell(rowIndex - <span class="number">1</span>);</span><br><span class="line">                cell.setCellValue((String)columnMap.get(rowIndex));</span><br><span class="line">                <span class="keyword">if</span> (titleStyle != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    cell.setCellStyle(titleStyle);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(rowIndex = <span class="number">0</span>; rowIndex &lt; sourceList.size(); ++rowIndex) &#123;</span><br><span class="line">                Row dataRow = sheet.createRow(rowIndex + <span class="number">1</span>);</span><br><span class="line">                T t = sourceList.get(rowIndex);</span><br><span class="line">                Class clazz = t.getClass();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> titleIndex = <span class="number">1</span>; titleIndex &lt;= columnMap.keySet().size(); ++titleIndex) &#123;</span><br><span class="line">                    Cell cell = dataRow.createCell(titleIndex - <span class="number">1</span>);</span><br><span class="line">                    Method method = clazz.getDeclaredMethod(<span class="string">"get"</span> + upperFirstWord((String)fieldValueMap.get(titleIndex)), (Class[])<span class="keyword">null</span>);</span><br><span class="line">                    Object obj = method.invoke(t, (Object[])<span class="keyword">null</span>);</span><br><span class="line">                    String type = (String)columnTypeMap.get(titleIndex);</span><br><span class="line">                    <span class="keyword">if</span> (obj != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">"java.lang.Integer"</span>.equals(type)) &#123;</span><br><span class="line">                            cell.setCellValue((<span class="keyword">double</span>)(Integer)obj);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"java.lang.Long"</span>.equals(type)) &#123;</span><br><span class="line">                            cell.setCellValue((<span class="keyword">double</span>) (Long) obj);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"java.lang.Double"</span>.equals(type))&#123;</span><br><span class="line">                            cell.setCellValue((<span class="keyword">double</span>)obj);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"java.lang.String"</span>.equals(type)) &#123;</span><br><span class="line">                            cell.setCellValue((String)obj);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"java.sql.Date"</span>.equals(type)) &#123;</span><br><span class="line">                            cell.setCellValue(parseDate((java.sql.Date)obj));</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"java.util.Date"</span>.equals(type)) &#123;</span><br><span class="line">                            cell.setCellValue(parseDate((Date)obj));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (dataStyles != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        cell.setCellStyle(dataStyles[rowIndex % dataStyles.length]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            workbook.write(os);</span><br><span class="line">            os.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">parseDate</span><span class="params">(java.sql.Date date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">parseDate</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">upperFirstWord</span><span class="params">(String field)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] arrays = field.toCharArray();</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">char</span> firstWord = Character.toUpperCase(arrays[<span class="number">0</span>]);</span><br><span class="line">        sb.append(firstWord);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arrays.length; ++i) &#123;</span><br><span class="line">            sb.append(arrays[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CacheFile工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mongodb.gridfs.GridFSDBFile;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheFile</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span>添加定时删除临时数据的任务，可以根据MongoDB中的时间进行删除（还需要考虑数据量）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String defaultTempFileName = <span class="string">"TempFile"</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GridFsTemplate gridFsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in 数据流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadMongoDB</span><span class="params">(InputStream in)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gridFsTemplate.store(in,defaultTempFileName).getId().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in 数据流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadMongoDB</span><span class="params">(String fileName,InputStream in)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gridFsTemplate.store(in,fileName).getId().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId 文件ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> InputStream <span class="title">downloadMongoDB</span><span class="params">(String fileId)</span></span>&#123;</span><br><span class="line">        GridFSDBFile gridFSDBFile = gridFsTemplate.findOne(<span class="keyword">new</span> Query(Criteria.where(<span class="string">"_id"</span>).is(fileId)));</span><br><span class="line">        <span class="keyword">if</span>(gridFSDBFile == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> gridFSDBFile.getInputStream();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NamedFile</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> InputStream in;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NamedFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NamedFile</span><span class="params">(String name, InputStream in)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">this</span>.in = in;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileId获取mongoDB中的文件名称和文件流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId MongoDB中文件唯一标示</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件名称和文件流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> NamedFile <span class="title">downloadMongoDBNamedFile</span><span class="params">(String fileId)</span></span>&#123;</span><br><span class="line">        GridFSDBFile gridFSDBFile = gridFsTemplate.findOne(<span class="keyword">new</span> Query(Criteria.where(<span class="string">"_id"</span>).is(fileId)));</span><br><span class="line">        <span class="keyword">if</span>(gridFSDBFile == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NamedFile(gridFSDBFile.getFilename(),gridFSDBFile.getInputStream());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/29/SpringBoot+SpringDataJpa进阶/" data-id="cjmvxlacy000d0gjeaqlimz18" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/日常笔记/">日常笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CORS的原理及整合SpringBoot" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/28/CORS的原理及整合SpringBoot/" class="article-date">
  <time datetime="2018-09-28T02:28:33.000Z" itemprop="datePublished">2018-09-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/28/CORS的原理及整合SpringBoot/">CORS的原理及整合SpringBoot</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文全部取自：<a href="http://www.spring4all.com/article/177" target="_blank" rel="noopener">http://www.spring4all.com/article/177</a></p>
<h2 id="一、基本介绍"><a href="#一、基本介绍" class="headerlink" title="一、基本介绍"></a>一、基本介绍</h2><p>简单来说，CORS是一种访问机制，英文全称是Cross-Origin Resource Sharing，即我们常说的跨域资源共享，通过在服务器端设置响应头，把发起跨域的原始域名添加到Access-Control-Allow-Origin 即可。</p>
<h3 id="1-CORS工作原理"><a href="#1-CORS工作原理" class="headerlink" title="1. CORS工作原理"></a>1. CORS工作原理</h3><p>CORS实现跨域访问并不是一蹴而就的，需要借助浏览器的支持，从原理题图我们可以清楚看到，简单的请求（通常指GET/POST/HEAD方式，并没有去增加额外的请求头信息）直接创建了跨域请求的XHR对象，而复杂的请求则要求先发送一个”预检”请求，待服务器批准后才能真正发起跨域访问请求。</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180928/cg1GgCBekG.png?imageslim" alt="mark"></p>
<p>根据官方文档<a href="https://www.w3.org/TR/cors/" target="_blank" rel="noopener">W3C规范-CORS</a> 的描述，目前CORS使用了如下头部信息：</p>
<blockquote>
<p>注：请求头信息由浏览器检测到跨域自动添加，无需过多干预，重点放在Response headers，它可以帮助我们在服务器进行跨域授权，例如允许哪些原始域可放行，是否需要携带Cookie信息等。</p>
</blockquote>
<h3 id="2-Request-Headers（请求头）"><a href="#2-Request-Headers（请求头）" class="headerlink" title="2. Request Headers（请求头）"></a>2. Request Headers（请求头）</h3><ul>
<li><h4 id="Origin"><a href="#Origin" class="headerlink" title="Origin"></a>Origin</h4><p>表示跨域请求的原始域。</p>
</li>
<li><h4 id="Access-Control-Request-Method"><a href="#Access-Control-Request-Method" class="headerlink" title="Access-Control-Request-Method"></a>Access-Control-Request-Method</h4><p>表示跨域请求的方式。（如GET/POST）</p>
</li>
<li><h4 id="Access-Control-Request-Headers"><a href="#Access-Control-Request-Headers" class="headerlink" title="Access-Control-Request-Headers"></a>Access-Control-Request-Headers</h4><p>表示跨域请求的请求头信息。</p>
</li>
</ul>
<h3 id="3-Response-headers（响应头-）"><a href="#3-Response-headers（响应头-）" class="headerlink" title="3. Response headers（响应头 ）"></a>3. Response headers（响应头 ）</h3><ul>
<li><h4 id="Access-Control-Allow-Origin"><a href="#Access-Control-Allow-Origin" class="headerlink" title="Access-Control-Allow-Origin"></a>Access-Control-Allow-Origin</h4><p>表示允许哪些原始域进行跨域访问。（字符数组）</p>
</li>
<li><h4 id="Access-Control-Allow-Credentials"><a href="#Access-Control-Allow-Credentials" class="headerlink" title="Access-Control-Allow-Credentials"></a>Access-Control-Allow-Credentials</h4><p>表示是否允许客户端获取用户凭据。（布尔类型）</p>
<p>使用场景：例如现在从浏览器发起跨域请求，并且要附带Cookie信息给服务器。则必须具备两个条件：</p>
<p>1.浏览器端：</p>
<p>发送AJAX请求前需设置通信对象XHR的withCredentials 属性为true。</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180928/k55EA2ea6K.png?imageslim" alt="mark"></p>
<p>2.服务器端：</p>
<p>设置Access-Control-Allow-Credentials为true。两个条件缺一不可，否则即使服务器同意发送Cookie，浏览器也无法获取。正确姿势如下：</p>
<ul>
<li><h4 id="Access-Control-Allow-Methods"><a href="#Access-Control-Allow-Methods" class="headerlink" title="Access-Control-Allow-Methods"></a>Access-Control-Allow-Methods</h4><p>表示跨域请求的方式的允许范围。（例如只授权GET/POST）</p>
</li>
<li><h4 id="Access-Control-Allow-Headers"><a href="#Access-Control-Allow-Headers" class="headerlink" title="Access-Control-Allow-Headers"></a>Access-Control-Allow-Headers</h4><p>表示跨域请求的头部的允许范围。</p>
</li>
<li><h4 id="Access-Control-Expose-Headers"><a href="#Access-Control-Expose-Headers" class="headerlink" title="Access-Control-Expose-Headers"></a>Access-Control-Expose-Headers</h4><p>表示暴露哪些头部信息，并提供给客户端。（因为基于安全考虑，如果没有设置额外的暴露，跨域的通信对象XMLHttpRequest只能获取标准的头部信息）</p>
</li>
<li><h4 id="Access-Control-Max-Age"><a href="#Access-Control-Max-Age" class="headerlink" title="Access-Control-Max-Age"></a>Access-Control-Max-Age</h4><p>表示预检请求的最大缓存时间。</p>
</li>
</ul>
</li>
</ul>
<h2 id="二、SpringBoot-CORS实现跨域访问"><a href="#二、SpringBoot-CORS实现跨域访问" class="headerlink" title="二、SpringBoot+CORS实现跨域访问"></a>二、SpringBoot+CORS实现跨域访问</h2><h3 id="授权方式"><a href="#授权方式" class="headerlink" title="授权方式"></a>授权方式</h3><ul>
<li>方式1：返回新的CorsFilter</li>
<li>方式2：重写WebMvcConfigurer</li>
<li>方式3：使用注解（<a href="https://github.com/CrossOrigin" target="_blank" rel="noopener">@CrossOrigin</a>）</li>
<li>方式4：手工设置响应头（HttpServletResponse ）</li>
</ul>
<blockquote>
<p>注：CorsFilter / WebMvcConfigurer / <a href="https://github.com/CrossOrigin" target="_blank" rel="noopener">@CrossOrigin</a> 需要SpringMVC 4.2 以上的版本才支持，对应SpringBoot 1.3 版本以上都支持这些CORS特性。不过，使用SpringMVC4.2 以下版本的小伙伴也不用慌，直接使用方式4通过手工添加响应头来授权CORS跨域访问也是可以的。附：在SpringBoot 1.2.8 + SpringMVC 4.1.9 亲测成功。</p>
<p>注：方式1和方式2属于全局CORS配置，方式3和方式4属于局部CORS配置。如果使用了局部跨域是会覆盖全局跨域的规则，所以可以通过<a href="https://github.com/CrossOrigin" target="_blank" rel="noopener">@CrossOrigin</a>注解来进行细粒度更高的跨域资源控制。</p>
</blockquote>
<h4 id="1-返回新的CorsFilter（全局跨域）"><a href="#1-返回新的CorsFilter（全局跨域）" class="headerlink" title="1. 返回新的CorsFilter（全局跨域）"></a>1. 返回新的CorsFilter（全局跨域）</h4><p>在任意配置类，返回一个新的CorsFilter Bean，并添加映射路径和具体的CORS配置信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hehe.yyweb.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.添加CORS配置信息</span></span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">          <span class="comment">//放行哪些原始域</span></span><br><span class="line">          config.addAllowedOrigin(<span class="string">"*"</span>);</span><br><span class="line">          <span class="comment">//是否发送Cookie信息</span></span><br><span class="line">          config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">          <span class="comment">//放行哪些原始域(请求方式)</span></span><br><span class="line">          config.addAllowedMethod(<span class="string">"*"</span>);</span><br><span class="line">          <span class="comment">//放行哪些原始域(头部信息)</span></span><br><span class="line">          config.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line">          <span class="comment">//暴露哪些头部信息（因为跨域访问默认不能获取全部头部信息）</span></span><br><span class="line">          config.addExposedHeader(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.添加映射路径</span></span><br><span class="line">        UrlBasedCorsConfigurationSource configSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        configSource.registerCorsConfiguration(<span class="string">"/**"</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.返回新的CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-重写WebMvcConfigurer（全局跨域）"><a href="#2-重写WebMvcConfigurer（全局跨域）" class="headerlink" title="2. 重写WebMvcConfigurer（全局跨域）"></a>2. 重写WebMvcConfigurer（全局跨域）</h4><p>在任意配置类，返回一个新的WebMvcConfigurer Bean，并重写其提供的跨域请求处理的接口，目的是添加映射路径和具体的CORS配置信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hehe.yyweb.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">corsConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">//重写父类提供的跨域请求处理的接口</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//添加映射路径</span></span><br><span class="line">                registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">                        <span class="comment">//放行哪些原始域</span></span><br><span class="line">                        .allowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">                        <span class="comment">//是否发送Cookie信息</span></span><br><span class="line">                        .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">                        <span class="comment">//放行哪些原始域(请求方式)</span></span><br><span class="line">                        .allowedMethods(<span class="string">"GET"</span>,<span class="string">"POST"</span>, <span class="string">"PUT"</span>, <span class="string">"DELETE"</span>)</span><br><span class="line">                        <span class="comment">//放行哪些原始域(头部信息)</span></span><br><span class="line">                        .allowedHeaders(<span class="string">"*"</span>)</span><br><span class="line">                        <span class="comment">//暴露哪些头部信息（因为跨域访问默认不能获取全部头部信息）</span></span><br><span class="line">                        .exposedHeaders(<span class="string">"Header1"</span>, <span class="string">"Header2"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-使用注解（局部跨域）"><a href="#3-使用注解（局部跨域）" class="headerlink" title="3. 使用注解（局部跨域）"></a>3. 使用注解（局部跨域）</h4><p>在方法上（<a href="https://github.com/RequestMapping" target="_blank" rel="noopener">@RequestMapping</a>）使用注解 <strong>@CrossOrigin</strong> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>(<span class="string">"http://localhost:8080"</span>) </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">( )</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者在控制器（<a href="https://github.com/Controller" target="_blank" rel="noopener">@Controller</a>）上使用注解 <strong>@CrossOrigin</strong> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>(origins = <span class="string">"http://xx-domain.com"</span>, maxAge = <span class="number">3600</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">( )</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-手工设置响应头（局部跨域-）"><a href="#4-手工设置响应头（局部跨域-）" class="headerlink" title="4. 手工设置响应头（局部跨域 ）"></a>4. 手工设置响应头（局部跨域 ）</h4><p>使用HttpServletResponse对象添加响应头（Access-Control-Allow-Origin）来授权原始域，这里Origin的值也可以设置为”*” ，表示全部放行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(HttpServletResponse response)</span></span>&#123;</span><br><span class="line">    response.addHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"http://localhost:8080"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三、测试跨域访问"><a href="#三、测试跨域访问" class="headerlink" title="三、测试跨域访问"></a>三、测试跨域访问</h2><p>首先使用<a href="http://www.jianshu.com/p/d2b08a671e27" target="_blank" rel="noopener"> Spring Initializr </a>快速构建一个Maven工程，什么都不用改，在static目录下，添加一个页面：index.html 来模拟跨域访问。目标地址: <a href="http://localhost:8090/hello" target="_blank" rel="noopener">http://localhost:8090/hello</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Page Index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>前台系统<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"info"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"webjars/jquery/3.2.1/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    $.ajax(&#123;</span></span><br><span class="line"><span class="undefined">        url: 'http://localhost:8090/hello',</span></span><br><span class="line"><span class="undefined">        type: "POST",</span></span><br><span class="line"><span class="undefined">        success: function (data) &#123;</span></span><br><span class="line"><span class="undefined">            $("#info").html("跨域访问成功:"+data);</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        error: function (data) &#123;</span></span><br><span class="line"><span class="undefined">            $("#info").html("跨域失败!!");</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后创建另一个工程，在Root Package添加Config目录并创建配置类来开启全局CORS。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hehe.yyweb.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">corsConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addMapping(<span class="string">"/**"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着，简单编写一个Rest接口 ，并指定应用端口为8090。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hehe.yyweb;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YyWebApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TomcatServletWebServerFactory <span class="title">tomcat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TomcatServletWebServerFactory tomcatFactory = <span class="keyword">new</span> TomcatServletWebServerFactory();</span><br><span class="line">        tomcatFactory.setPort(<span class="number">8090</span>); <span class="comment">//默认启动8090端口</span></span><br><span class="line">        <span class="keyword">return</span> tomcatFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(YyWebApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后分别启动两个应用，然后在浏览器访问：<a href="http://localhost:8080/index.html" target="_blank" rel="noopener">http://localhost:8080/index.html</a> ，可以正常接收JSON数据，说明跨域访问成功！！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/28/CORS的原理及整合SpringBoot/" data-id="cjmvxlacx000c0gje4zjuxidw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-BS运维" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/27/BS运维/" class="article-date">
  <time datetime="2018-09-27T01:28:33.000Z" itemprop="datePublished">2018-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/27/BS运维/">日常笔记：Dubbo的Filter，httpclient发送webservice请求，Hibranate注解使用，OSS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Dubbo的Filter"><a href="#Dubbo的Filter" class="headerlink" title="Dubbo的Filter"></a>Dubbo的Filter</h3><p><a href="https://blog.csdn.net/mj158518/article/details/47379799" target="_blank" rel="noopener">com.alibaba.dubbo.rpc.Filter接口</a></p>
<p>在开发中，有时候需要限制访问的权限，白名单就是一种方法。对于Java Web应用，Spring的拦截器可以拦截Web接口的调用；而对于dubbo接口，Spring的拦截器就不管用了。</p>
<h4 id="第一步：实现接口"><a href="#第一步：实现接口" class="headerlink" title="第一步：实现接口"></a>第一步：实现接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.*;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorityFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(AuthorityFilter.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ip白名单</span></span><br><span class="line">    <span class="keyword">private</span> IpWhiteList ipWhiteList;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//dubbo通过setter方式自动注入（扩展点加载机制）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIpWhiteList</span><span class="params">(IpWhiteList ipWhiteList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ipWhiteList = ipWhiteList;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!ipWhiteList.isEnabled()) &#123;</span><br><span class="line">            LOGGER.debug(<span class="string">"白名单禁用"</span>);</span><br><span class="line">            <span class="keyword">return</span> invoker.invoke(invocation);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        String clientIp = RpcContext.getContext().getRemoteHost();</span><br><span class="line">        LOGGER.debug(<span class="string">"访问ip为&#123;&#125;"</span>, clientIp);</span><br><span class="line">        List&lt;String&gt; allowedIps = ipWhiteList.getAllowedIps();</span><br><span class="line">        <span class="keyword">if</span> (allowedIps.contains(clientIp)) &#123;</span><br><span class="line">            <span class="keyword">return</span> invoker.invoke(invocation);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> RpcResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：只能通过setter方式来注入其他的bean，且不要标注注解！</strong></p>
<p>dubbo自己会对这些bean进行注入，不需要再标注@Resource让Spring注入，参见扩展点加载</p>
<h4 id="第二步：配置文件"><a href="#第二步：配置文件" class="headerlink" title="第二步：配置文件"></a>第二步：<a href="http://dubbo.apache.org/zh-cn/docs/dev/impls/filter.html" target="_blank" rel="noopener">配置文件</a></h4><p>在resources目录下添加纯文本文件META-INF/dubbo/com.alibaba.dubbo.rpc.Filter，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxxFilter=com.xxx.AuthorityFilter</span><br></pre></td></tr></table></figure>
<p>修改dubbo的provider配置文件，在dubbo:provider中添加配置的filter，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">filter</span>=<span class="string">"xxxFilter"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/meilong_whpu/article/details/72179453" target="_blank" rel="noopener">扩展点加载机制</a></p>
<pre><code>只有标有@SPI注解的接口类才会查找扩展点的实现，依次从下面这三个路径读取扩展点文件：META-INF/dubbo/internal 、META-INF/dubbo/ 、META-INF/services/，其中dubbo内部实现的各种扩展文件都放在META-INF/dubbo/internal目录下面。
</code></pre><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/CLh1C0l2bm.png?imageslim" alt="mark"></p>
<p>文件内容，类似下面这样</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/deciJ69Gk0.png?imageslim" alt="mark"></p>
<h3 id="HttpClient作为WebService客户端进行调用服务"><a href="#HttpClient作为WebService客户端进行调用服务" class="headerlink" title="HttpClient作为WebService客户端进行调用服务"></a><a href="https://blog.csdn.net/zilong_zilong/article/details/53932667" target="_blank" rel="noopener">HttpClient作为WebService客户端进行调用服务</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClientCallSoapUtil</span> </span>&#123;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">int</span> socketTimeout = <span class="number">30000</span>;<span class="comment">// 请求超时时间</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">int</span> connectTimeout = <span class="number">30000</span>;<span class="comment">// 传输超时时间</span></span><br><span class="line">   <span class="keyword">static</span> Logger logger = Logger.getLogger(HttpClientCallSoapUtil.class);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用SOAP1.1发送消息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> postUrl</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapXml</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapAction</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">doPostSoap1_1</span><span class="params">(String postUrl, String soapXml,</span></span></span><br><span class="line"><span class="function"><span class="params">         String soapAction)</span> </span>&#123;</span><br><span class="line">      String retStr = <span class="string">""</span>;</span><br><span class="line">      <span class="comment">// 创建HttpClientBuilder</span></span><br><span class="line">      HttpClientBuilder httpClientBuilder = HttpClientBuilder.create();</span><br><span class="line">      <span class="comment">// HttpClient</span></span><br><span class="line">      CloseableHttpClient closeableHttpClient = httpClientBuilder.build();</span><br><span class="line">      HttpPost httpPost = <span class="keyword">new</span> HttpPost(postUrl);</span><br><span class="line">                <span class="comment">//  设置请求和传输超时时间</span></span><br><span class="line">      RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">            .setSocketTimeout(socketTimeout)</span><br><span class="line">            .setConnectTimeout(connectTimeout).build();</span><br><span class="line">      httpPost.setConfig(requestConfig);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         httpPost.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/xml;charset=UTF-8"</span>);</span><br><span class="line">         httpPost.setHeader(<span class="string">"SOAPAction"</span>, soapAction);</span><br><span class="line">         StringEntity data = <span class="keyword">new</span> StringEntity(soapXml,Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">         httpPost.setEntity(data);</span><br><span class="line">         CloseableHttpResponse response = closeableHttpClient.execute(httpPost);</span><br><span class="line">         HttpEntity httpEntity = response.getEntity();</span><br><span class="line">         <span class="keyword">if</span> (httpEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 打印响应内容</span></span><br><span class="line">            retStr = EntityUtils.toString(httpEntity, <span class="string">"UTF-8"</span>);</span><br><span class="line">            logger.info(<span class="string">"response:"</span> + retStr);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 释放资源</span></span><br><span class="line">         closeableHttpClient.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         logger.error(<span class="string">"exception in doPostSoap1_1"</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> retStr;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用SOAP1.2发送消息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> postUrl</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapXml</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapAction</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">doPostSoap1_2</span><span class="params">(String postUrl, String soapXml,</span></span></span><br><span class="line"><span class="function"><span class="params">         String soapAction)</span> </span>&#123;</span><br><span class="line">      String retStr = <span class="string">""</span>;</span><br><span class="line">      <span class="comment">// 创建HttpClientBuilder</span></span><br><span class="line">      HttpClientBuilder httpClientBuilder = HttpClientBuilder.create();</span><br><span class="line">      <span class="comment">// HttpClient</span></span><br><span class="line">      CloseableHttpClient closeableHttpClient = httpClientBuilder.build();</span><br><span class="line">      HttpPost httpPost = <span class="keyword">new</span> HttpPost(postUrl);</span><br><span class="line">                <span class="comment">// 设置请求和传输超时时间</span></span><br><span class="line">      RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">            .setSocketTimeout(socketTimeout)</span><br><span class="line">            .setConnectTimeout(connectTimeout).build();</span><br><span class="line">      httpPost.setConfig(requestConfig);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         httpPost.setHeader(<span class="string">"Content-Type"</span>,</span><br><span class="line">               <span class="string">"application/soap+xml;charset=UTF-8"</span>);</span><br><span class="line">         httpPost.setHeader(<span class="string">"SOAPAction"</span>, soapAction);</span><br><span class="line">         StringEntity data = <span class="keyword">new</span> StringEntity(soapXml,</span><br><span class="line">               Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">         httpPost.setEntity(data);</span><br><span class="line">         CloseableHttpResponse response = closeableHttpClient</span><br><span class="line">               .execute(httpPost);</span><br><span class="line">         HttpEntity httpEntity = response.getEntity();</span><br><span class="line">         <span class="keyword">if</span> (httpEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 打印响应内容</span></span><br><span class="line">            retStr = EntityUtils.toString(httpEntity, <span class="string">"UTF-8"</span>);</span><br><span class="line">            logger.info(<span class="string">"response:"</span> + retStr);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 释放资源</span></span><br><span class="line">         closeableHttpClient.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         logger.error(<span class="string">"exception in doPostSoap1_2"</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> retStr;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 需要发送的xml</span></span><br><span class="line">      String orderSoapXml = <span class="string">"&lt;?xml version = \"1.0\" ?&gt;"</span></span><br><span class="line">            + <span class="string">"&lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservices.b.com\"&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Header/&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Body&gt;"</span></span><br><span class="line">            + <span class="string">"      &lt;web:order soapenv:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;in0 xsi:type=\"web:OrderRequest\"&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;mobile xsi:type=\"soapenc:string\" xmlns:soapenc=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;?&lt;/mobile&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;orderStatus xsi:type=\"xsd:int\"&gt;?&lt;/orderStatus&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;productCode xsi:type=\"soapenc:string\" xmlns:soapenc=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;?&lt;/productCode&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;/in0&gt;"</span> + <span class="string">"      &lt;/web:order&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;/soapenv:Body&gt;"</span> + <span class="string">"&lt;/soapenv:Envelope&gt;"</span>;</span><br><span class="line">      String querySoapXml = <span class="string">"&lt;?xml version = \"1.0\" ?&gt;"</span></span><br><span class="line">            + <span class="string">"&lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservices.b.com\"&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Header/&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Body&gt;"</span></span><br><span class="line">            + <span class="string">"      &lt;web:query soapenv:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;in0 xsi:type=\"web:QueryRequest\"&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;endTime xsi:type=\"xsd:dateTime\"&gt;?&lt;/endTime&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;mobile xsi:type=\"soapenc:string\" xmlns:soapenc=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;?&lt;/mobile&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;startTime xsi:type=\"xsd:dateTime\"&gt;?&lt;/startTime&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;/in0&gt;"</span> + <span class="string">"      &lt;/web:query&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;/soapenv:Body&gt;"</span> + <span class="string">"&lt;/soapenv:Envelope&gt;"</span>;</span><br><span class="line">      String postUrl = <span class="string">"http://localhost:8080/services/WebServiceFromB"</span>;</span><br><span class="line">      <span class="comment">//采用SOAP1.1调用服务端，这种方式能调用服务端为soap1.1和soap1.2的服务</span></span><br><span class="line">      doPostSoap1_1(postUrl, orderSoapXml, <span class="string">""</span>);</span><br><span class="line">      doPostSoap1_1(postUrl, querySoapXml, <span class="string">""</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//采用SOAP1.2调用服务端，这种方式只能调用服务端为soap1.2的服务</span></span><br><span class="line">      <span class="comment">//doPostSoap1_2(postUrl, orderSoapXml, "order");</span></span><br><span class="line">      <span class="comment">//doPostSoap1_2(postUrl, querySoapXml, "query");</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>问题，怎么传参？？</p>
<p>将xml字符串中的‘？’改为需要传的参数</p>
<h3 id="CORS解决跨域问题"><a href="#CORS解决跨域问题" class="headerlink" title="CORS解决跨域问题"></a><a href="https://www.jianshu.com/p/9203e9b14465" target="_blank" rel="noopener">CORS解决跨域问题</a></h3><p>使用前后端分离模式开发项目时，往往会遇到这样一个问题 – 无法跨域获取服务端数据</p>
<p>这是由于浏览器的同源策略导致的，目的是为了安全。在前后端分离开发模式备受青睐的今天，前端和后台项目往往会在不同的环境下进行开发，这时就会出现跨域请求数据的需求，目前的解决方案主要有以下几种：</p>
<blockquote>
<p>JSONP、iframe、代理模式、CORS等等</p>
</blockquote>
<p>前面几种方式在这里不讲，网上有很多资料。在这里我主要分享一下CORS这种解决方式，CORS即“跨域资源共享”，它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</p>
<p>使用 CORS 跨域的时候和普通的 ajax 过程是一样的，只是浏览器在发现这是一个跨域请求的时候会自动帮我们处理一些事情，所以说<strong>只要服务端提供支持，前端是不需要做额外的事情的</strong>。</p>
<h4 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h4><p>实现的大概思路是这样的，首先使用过滤器获取请求对象request的信息，比如Origin 字段（表示请求来自哪个源，包括协议、域名、端口），通过预先配置的参数判断请求是否合法，然后设置响应对象response的头信息，实现跨域资源请求。在介绍实现方式之前我们先来了解一下会用到的响应头信息。</p>
<h4 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h4><ul>
<li>Access-Control-Allow-Methods<br> 用来列出浏览器的CORS请求允许使用的HTTP方法，如：GET、POST、PUT、DELETE、OPTIONS</li>
<li>Access-Control-Allow-Credentials<br> 表示是否支持跨域Cookie</li>
<li>Access-Control-Allow-Headers<br> 逗号分隔的字符串，表示服务器支持的所有头信息字段，如Content-Type以及自定义的字段</li>
<li>Access-Control-Expose-Headers<br> 与“Access-Control-Allow-Headers”相反，表示不支持的头信息字段</li>
<li>Access-Control-Allow-Origin<br> 允许跨域的请求源信息，包括协议、域名、端口，为*表示允许所有请求来源，并且<strong>只能设置一个请求源</strong></li>
</ul>
<h4 id="使用Servlet-Filter-实现-CORS"><a href="#使用Servlet-Filter-实现-CORS" class="headerlink" title="使用Servlet Filter 实现 CORS"></a>使用Servlet Filter 实现 CORS</h4><pre><code>CORS 跨域协议的实现是通过使用一组 HTTP 首部字段实现的，其核心是服务端返回响应中的 `Access-Control-Allow-Origin` 首部字段，这个字段来声明服务端允许来自哪些源的请求访问该资源，浏览器可以根据这个响应首部字段来判断是否可以放行跨域请求。因此要实现 CORS ，我们可以在项目中声明一个 Filter 过滤器为响应加上需要的 `Access-Control-Allow-*`首部。
</code></pre><p>首先创建一个实现 <code>javax.servlet.Filter</code> 接口的过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CORSFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"work"</span>);</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"POST, GET"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Max-Age"</span>, <span class="string">"3600"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With"</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后在web.xml中，进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- CORS Filter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CORSFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.ken.localserver.filter.CORSFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CORSFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="使用-Spring-MVC-的-CrossOrigin-注解实现-CORS-跨域"><a href="#使用-Spring-MVC-的-CrossOrigin-注解实现-CORS-跨域" class="headerlink" title="使用 Spring MVC 的 @CrossOrigin 注解实现 CORS 跨域"></a>使用 Spring MVC 的 @CrossOrigin 注解实现 CORS 跨域</h4><p>   Spring Framework 从 4.2 版本中开始原生支持 CORS，相比上面的需要配置 Filter 过滤器的实现方式，使用原生的 <code>@CrossOrigin</code> 注解的实现方式来得更加简单。</p>
<p>   要启用 Spring MVC 的 CORS 支持十分简单，只需要添加一个<code>@CrossOrigin</code>注解即可，根据添加注解位置可以控制配置的细粒度，如：允许这个Controller 还是特定的方法</p>
<ul>
<li><p>在方法上使用 <code>@CrossOrigin</code> 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/account"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CrossOrigin</span></span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">retrieve</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上例中将允许对<code>retrieve()</code>方法的跨域访问。默认情况下， <code>@CrossOrigin</code> 注解将允许来自任意的源站以及任意 HTTP 请求方法的请求访问。</p>
</li>
<li><p>在Controller 上使用 <code>@CrossOrigin</code> 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span>(origins = <span class="string">"http://domain2.com"</span>, maxAge = <span class="number">3600</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/account"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">retrieve</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当 <code>@CrossOrigin</code> 注解声明在Controller 时，将允许对 Controller 下得所有方法得跨域请求。另外，如果不满足与  <code>@CrossOrigin</code>  注解得默认属性，我们可以自定义配置 CORS 属性。</p>
</li>
<li><p>同时在 Controller 和方法上使用  <code>@CrossOrigin</code>  注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span>(maxAge = <span class="number">3600</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/account"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CrossOrigin</span>(origins = <span class="string">"http://domain2.com"</span>)</span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">retrieve</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果同时在 Controller 和方法上都有使用<code>@CrossOrigin</code> 注解，那么在具体某个方法上的 CORS 属性将是两个注解属性合并的结果，如果属性的设置发生冲突，那么Controller 上的主机属性将被覆盖。</p>
</li>
<li><p>全局 CORS 配置</p>
<p>在某些情况，我们并不需要针对不同的URL来配置不同 CORS 属性，那么我们可以通过一个全局的 CORS 配置来避免单独注解配置的麻烦。</p>
<ul>
<li><p>基于 JavaConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">"/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在以及 Java 配置的配置方式中，我们只需要简单加入以上的代码就可以配置全局的 CORS。默认情况下，将允许来自任意源站以及任意 HTTP 请求方法的请求访问。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">"/api/**"</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">"http://domain2.com"</span>)</span><br><span class="line">                .allowedMethods(<span class="string">"PUT"</span>, <span class="string">"DELETE"</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">"header1"</span>, <span class="string">"header2"</span>, <span class="string">"header3"</span>)</span><br><span class="line">                .exposedHeaders(<span class="string">"header1"</span>, <span class="string">"header2"</span>)</span><br><span class="line">                .allowCredentials(<span class="keyword">false</span>).maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时，我们也可以根据自己的需要 CORS 的相关属性进行配置，配置的方式如上面的代码所示。</p>
</li>
</ul>
</li>
<li><p>基于 XML 配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:cors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:cors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>基于 XML 配置文件的配置方式也是十分简单，只需要 Spring 的Context 配置文件中加入上面的 <code>&lt;mvc:cors&gt;</code> 即可。同样的，默认情况下将允许来自任意源站以及任意 HTTP 请求方法的请求访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:cors&gt;</span><br><span class="line">    &lt;mvc:mapping path=&quot;/api/**&quot;</span><br><span class="line">        allowed-origins=&quot;http://domain1.com, http://domain2.com&quot;</span><br><span class="line">        allowed-methods=&quot;GET, PUT&quot;</span><br><span class="line">        allowed-headers=&quot;header1, header2, header3&quot;</span><br><span class="line">        exposed-headers=&quot;header1, header2&quot; allow-credentials=&quot;false&quot;</span><br><span class="line">        max-age=&quot;123&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;mvc:mapping path=&quot;/resources/**&quot;</span><br><span class="line">        allowed-origins=&quot;http://domain1.com&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mvc:cors&gt;</span><br></pre></td></tr></table></figure>
<p>另外，也可以通过上面的方式根据自己需要来自定义 CORS 属性。</p>
</li>
</ul>
<h3 id="Java关键字default"><a href="#Java关键字default" class="headerlink" title="Java关键字default"></a>Java关键字default</h3><pre><code>default常用于接口中，我们本来写Java接口的时候，是不能有方法体的函数，default关键字在接口中修饰方法时，方法可以有方法体。
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Default</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"method in interface"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomeThing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"do something in interface"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Spring-Data-Jpa中的CrudRepository和JpaRepository接口之间的区别"><a href="#Spring-Data-Jpa中的CrudRepository和JpaRepository接口之间的区别" class="headerlink" title="Spring Data Jpa中的CrudRepository和JpaRepository接口之间的区别"></a>Spring Data Jpa中的CrudRepository和JpaRepository接口之间的区别</h3><p>JpaRepository延伸PagingAndSortingRepository，其继而延伸CrudRepository。</p>
<p>它们的主要功能是：</p>
<p>> <a href="http://static.springsource.org/spring-data/data-commons/docs/current/api/org/springframework/data/repository/CrudRepository.html" target="_blank" rel="noopener">CrudRepository</a>主要提供CRUD功能。<br>> <a href="http://static.springsource.org/spring-data/data-commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html" target="_blank" rel="noopener">PagingAndSortingRepository</a>提供了做分页和排序记录的方法。<br>> <a href="http://static.springsource.org/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html" target="_blank" rel="noopener">JpaRepository</a>提供了一些JPA相关的方法，例如刷新持久化上下文和批量删除记录。</p>
<p>因为上面提到的继承，JpaRepository将具有CrudRepository和PagingAndSortingRepository的所有函数。因此，如果您不需要存储库具有JpaRepository和PagingAndSortingRepository提供的函数，请使用CrudRepository。</p>
<h3 id="Spring-AOP注解"><a href="#Spring-AOP注解" class="headerlink" title="Spring AOP注解"></a>Spring AOP<a href="https://blog.csdn.net/rainbow702/article/details/52185827" target="_blank" rel="noopener">注解</a></h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/Jeh4Dj6J3J.png?imageslim" alt="mark"></p>
<p>标识有@DomainFilterResource的方法有这个==环绕通知==</p>
<h3 id="利用axis发送webservice的工具类"><a href="#利用axis发送webservice的工具类" class="headerlink" title="利用axis发送webservice的工具类"></a>利用axis发送webservice的工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"><span class="keyword">import</span> javax.xml.namespace.QName;</span><br><span class="line"><span class="keyword">import</span> javax.xml.rpc.ParameterMode;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.OutputKeys;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.dom.DOMSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.stream.StreamResult;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.axis.Constants;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.client.Call;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.client.Service;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.encoding.XMLType;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.message.MessageElement;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.types.Schema;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.jettison.json.JSONException;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.jettison.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 利用axis解析webservice</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> TangSir</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebServiceByAxisUtil</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Service service; <span class="comment">// 定义一个服务</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		service = <span class="keyword">new</span> Service();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回单个String类型的值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSingleStrFromWb</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 返回值类型，设置为string</span></span><br><span class="line">			call.setReturnType(<span class="keyword">new</span> QName(<span class="string">"http://www.w3.org/2001/XMLSchema"</span>,<span class="string">"string"</span>));</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			Object obj = call.invoke(values);</span><br><span class="line">			<span class="comment">// 返回值</span></span><br><span class="line">			<span class="keyword">return</span> obj.toString();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回XML的String类型值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getXMLStrFromWb</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 返回值类型</span></span><br><span class="line">			call.setReturnType(Constants.XSD_SCHEMA);</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			Object o = call.invoke(values);</span><br><span class="line">			Schema schema = (Schema) o;</span><br><span class="line">			MessageElement[] msgele = schema.get_any();</span><br><span class="line">			String xml = <span class="string">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; msgele.length; i++) &#123;</span><br><span class="line">				xml += msgele[i].toString().replace(<span class="string">"\""</span>, <span class="string">"\'"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> xml.toString();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 利用W3C解析xml，并返回xml字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getXMLStrFromWbByW3C</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			call.setReturnClass(org.w3c.dom.Document.class); <span class="comment">// 返回值类型</span></span><br><span class="line">			Object o = call.invoke(values);</span><br><span class="line">			String result = toStringFromDoc((org.w3c.dom.Document) o);</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 利用W3C解析xml，并返回org.w3c.dom.Document</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace</span></span><br><span class="line"><span class="comment">	 *            webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">	 *            webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName</span></span><br><span class="line"><span class="comment">	 *            方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras</span></span><br><span class="line"><span class="comment">	 *            方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values</span></span><br><span class="line"><span class="comment">	 *            参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> org.w3c.dom.<span class="function">Document <span class="title">getXMLDocumentStrFromWbByW3C</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			String namespace, String wbUrl, String methodName, String[] paras,</span></span></span><br><span class="line"><span class="function"><span class="params">			Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			call.setReturnClass(org.w3c.dom.Document.class); <span class="comment">// 返回值类型</span></span><br><span class="line">			Object o = call.invoke(values);</span><br><span class="line">			<span class="keyword">return</span> (org.w3c.dom.Document) o;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回org.codehaus.jettison.json.JSONObject类型的json值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title">getJsonFromWbByW3C</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		String result = getSingleStrFromWb(namespace, wbUrl, methodName, paras,values);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			JSONObject json = <span class="keyword">new</span> JSONObject(result);</span><br><span class="line">			<span class="keyword">return</span> json;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回TreeMap类型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TreeMap <span class="title">getMapFromWbByW3C</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		String result = getSingleStrFromWb(namespace, wbUrl, methodName, paras,values);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//根据字符串生成Json对象</span></span><br><span class="line">			JSONObject json = <span class="keyword">new</span> JSONObject(result);</span><br><span class="line">			TreeMap&lt;String, String&gt; map = <span class="keyword">new</span> TreeMap();</span><br><span class="line">			<span class="comment">//将Json对象转换成TreeMap</span></span><br><span class="line">			Iterator keys = json.keys();</span><br><span class="line">			String key = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">while</span> (keys.hasNext()) &#123;</span><br><span class="line">				key = keys.next().toString();</span><br><span class="line">				map.put(key, json.get(key).toString());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> map;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取Call</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Call <span class="title">getCall</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//默认的命名空间为 http://tempuri.org/</span></span><br><span class="line">		<span class="keyword">if</span> (namespace == <span class="keyword">null</span>) &#123;</span><br><span class="line">			namespace = <span class="string">"http://tempuri.org/"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = (Call) service.createCall();</span><br><span class="line">			call.setTargetEndpointAddress(<span class="keyword">new</span> java.net.URL(wbUrl));</span><br><span class="line">			call.setEncodingStyle(<span class="keyword">null</span>);</span><br><span class="line">			<span class="comment">// 解决错误：服务器未能识别 HTTP 头 SOAPAction 的值，好像是只有C#的webservice需要加这个</span></span><br><span class="line">			call.setUseSOAPAction(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">//设置URI</span></span><br><span class="line">			call.setSOAPActionURI(namespace + methodName);</span><br><span class="line">			<span class="comment">// 设置调用方法</span></span><br><span class="line">			call.setOperationName(<span class="keyword">new</span> QName(namespace, methodName));</span><br><span class="line">			<span class="comment">// 设置参数</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paras.length; i++) &#123;</span><br><span class="line">				call.addParameter(<span class="keyword">new</span> QName(namespace, paras[i]),<span class="comment">// 参数</span></span><br><span class="line">						Constants.XSD_STRING, ParameterMode.IN);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> call;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(e.getMessage());</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将w3c类型的document转换成String字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">toStringFromDoc</span><span class="params">(Document document)</span> </span>&#123;</span><br><span class="line">		String result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (document != <span class="keyword">null</span>) &#123;</span><br><span class="line">			StringWriter strWtr = <span class="keyword">new</span> StringWriter();</span><br><span class="line">			StreamResult strResult = <span class="keyword">new</span> StreamResult(strWtr);</span><br><span class="line">			TransformerFactory tfac = TransformerFactory.newInstance();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				javax.xml.transform.Transformer t = tfac.newTransformer();</span><br><span class="line">				t.setOutputProperty(OutputKeys.ENCODING, <span class="string">"UTF-8"</span>);</span><br><span class="line">				t.setOutputProperty(OutputKeys.INDENT, <span class="string">"yes"</span>);</span><br><span class="line">				t.setOutputProperty(OutputKeys.METHOD, <span class="string">"xml"</span>); <span class="comment">// xml, html,</span></span><br><span class="line">				<span class="comment">// text</span></span><br><span class="line">				t.setOutputProperty(<span class="string">"&#123;http://xml.apache.org/xslt&#125;indent-amount"</span>, <span class="string">"4"</span>);</span><br><span class="line">				t.transform(<span class="keyword">new</span> DOMSource(document.getDocumentElement()),</span><br><span class="line">						strResult);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				System.err.println(<span class="string">"XML.toString(Document): "</span> + e);</span><br><span class="line">			&#125;</span><br><span class="line">			result = strResult.getWriter().toString();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				strWtr.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Hibranate——一对多（注解）"><a href="#Hibranate——一对多（注解）" class="headerlink" title="Hibranate——一对多（注解）"></a>Hibranate——一对多（注解）</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/g51GJcBiEE.png?imageslim" alt="mark"></p>
<p>还有，写之前好好想想，==外键==到底在那个表中。</p>
<h3 id="Hibranate——表中字段自关联（注解）"><a href="#Hibranate——表中字段自关联（注解）" class="headerlink" title="Hibranate——表中字段自关联（注解）"></a>Hibranate——表中字段自关联（注解）</h3><p>自关联其实就是，@ManyToOne和@OneToMany注解</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/b49ekCJhBJ.png?imageslim" alt="mark"></p>
<h3 id="Hibranate——多对多（注解）"><a href="#Hibranate——多对多（注解）" class="headerlink" title="Hibranate——多对多（注解）"></a>Hibranate——多对多（注解）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************用户方**************/</span></span><br><span class="line"><span class="meta">@ManyToMany</span></span><br><span class="line"><span class="meta">@Cascade</span>(org.hibernate.annotations.CascadeType.SAVE_UPDATE)<span class="comment">//使用hibernate注解级联保存和更新</span></span><br><span class="line"><span class="meta">@JoinTable</span>(name = <span class="string">"t_user_role"</span>,</span><br><span class="line">joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"user_id"</span>)&#125;,<span class="comment">//JoinColumns定义本方在中间表的主键映射</span></span><br><span class="line">inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"role_id"</span>)&#125;)<span class="comment">//inverseJoinColumns定义另一在中间表的主键映射</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Role&gt; roles;</span><br><span class="line"><span class="comment">/********************角色方**************/</span></span><br><span class="line"><span class="meta">@ManyToMany</span></span><br><span class="line"><span class="meta">@Cascade</span>(org.hibernate.annotations.CascadeType.SAVE_UPDATE)<span class="comment">//使用hibernate注解级联保存和更新</span></span><br><span class="line"><span class="meta">@JoinTable</span>(name = <span class="string">"t_user_role"</span>,</span><br><span class="line">joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"role_id"</span>)&#125;,<span class="comment">//JoinColumns定义本方在中间表的主键映射</span></span><br><span class="line">inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"user_id"</span>)&#125;)<span class="comment">//inverseJoinColumns定义另一在中间表的主键映射</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;User&gt; users;</span><br></pre></td></tr></table></figure>
<p>在这里，我们将两边都设为主控方，这样两边都可以对关联关系进行维护。假如我们只需要User方维护关联关系，可以将角色方改成如下配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManyToMany</span>(mapperBy = <span class="string">"roles"</span>)</span><br><span class="line"><span class="meta">@Cascade</span>(org.hibernate.annotations.CascadeType.SAVE_UPDATE)<span class="comment">//使用hibernate注解级联保存和更新</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;User&gt; users;</span><br></pre></td></tr></table></figure>
<h3 id="Hibranate使用问题"><a href="#Hibranate使用问题" class="headerlink" title="Hibranate使用问题"></a>Hibranate使用问题</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/ca86KcDcm4.png?imageslim" alt="mark"></p>
<p>在返回的时候，如果entity中有注解，需要转成dto（没有注解的），==否则会导致序列化失败==</p>
<ul>
<li>返回：<strong>在服务提供者与消费者之间的通信的时候不能使用含有JPA注解的实体类</strong></li>
</ul>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/JBL20A3hI2.png?imageslim" alt="mark"></p>
<p>可以使用==Dozer==进行对象转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Mapper dozerMapper;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;BizPlanManageProjectDTO&gt; <span class="title">Entity2DTO</span><span class="params">(List&lt;BizPlanManageProject&gt; entities)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;BizPlanManageProjectDTO&gt; bizPlanManageProjectDTOS = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (BizPlanManageProject entity : entities) &#123;</span><br><span class="line">        </span><br><span class="line">        BizPlanManageProjectDTO bizDto = <span class="keyword">this</span>.dozerMapper.map(entity, BizPlanManageProjectDTO.class);</span><br><span class="line">        bizPlanManageProjectDTOS.add(bizDto);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bizPlanManageProjectDTOS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>注解版entry不加Lazy注解，默认不是懒加载</strong></li>
</ul>
<h3 id="阿里云OSS使用"><a href="#阿里云OSS使用" class="headerlink" title="阿里云OSS使用"></a><a href="https://pan.baidu.com/s/1OxYewBfhpXZce1U-Bk_DcQ" target="_blank" rel="noopener">阿里云OSS使用</a></h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/LBbma6micF.png?imageslim" alt="mark"></p>
<h3 id="Postman的使用"><a href="#Postman的使用" class="headerlink" title="Postman的使用"></a>Postman的使用</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180925/lfij3eEBha.png?imageslim" alt="mark"></p>
<h3 id="Controller层使用-Value注解"><a href="#Controller层使用-Value注解" class="headerlink" title="@Controller层使用@Value注解"></a>@Controller层使用@Value注解</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在controller 中使用 properties 文件 所以加上这个 配置项--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"configProperties"</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertiesFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:config/web-server.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/27/BS运维/" data-id="cjmvxlan7000m0gje3p4pgsao" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/日常笔记/">日常笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring注解使用 " class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/27/Spring注解使用 /" class="article-date">
  <time datetime="2018-09-27T01:28:33.000Z" itemprop="datePublished">2018-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/27/Spring注解使用 /">Spring注解使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>项目所需依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1、-Configuration，-ComponentScans，-ComponentScan注解"><a href="#1、-Configuration，-ComponentScans，-ComponentScan注解" class="headerlink" title="1、@Configuration，@ComponentScans，@ComponentScan注解"></a>1、@Configuration，@ComponentScans，@ComponentScan注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.FilterType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan.Filter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Configuration：告诉Spring这是一个配置类，配置类&lt;==&gt;配置文件</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// @ComponentScans：可以多指定几个扫描包</span></span><br><span class="line"><span class="meta">@ComponentScans</span>(</span><br><span class="line">      value = &#123;</span><br><span class="line">            <span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>,includeFilters = &#123;</span><br><span class="line">                  <span class="meta">@Filter</span>(type=FilterType.ANNOTATION,classes=&#123;Controller.class&#125;),</span><br><span class="line">                  <span class="meta">@Filter</span>(type=FilterType.ASSIGNABLE_TYPE,classes=&#123;BookService.class&#125;),</span><br><span class="line">                  <span class="meta">@Filter</span>(type=FilterType.CUSTOM,classes=&#123;MyTypeFilter.class&#125;)</span><br><span class="line">            &#125;,useDefaultFilters = <span class="keyword">false</span>)   </span><br><span class="line">      &#125;</span><br><span class="line">      )</span><br><span class="line"><span class="comment">//@ComponentScan  value:指定要扫描的包</span></span><br><span class="line">    <span class="comment">//excludeFilters = Filter[] ：指定扫描的时候按照什么规则排除那些组件</span></span><br><span class="line">    <span class="comment">//includeFilters = Filter[] ：指定扫描的时候只需要包含哪些组件</span></span><br><span class="line">        <span class="comment">//FilterType.ANNOTATION：按照注解</span></span><br><span class="line">        <span class="comment">//FilterType.ASSIGNABLE_TYPE：按照给定的类型；</span></span><br><span class="line">        <span class="comment">//FilterType.ASPECTJ：使用ASPECTJ表达式</span></span><br><span class="line">        <span class="comment">//FilterType.REGEX：使用正则指定</span></span><br><span class="line">        <span class="comment">//FilterType.CUSTOM：使用自定义规则</span></span><br><span class="line">	<span class="comment">// useDefaultFilters：是否反过来0.0</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//给容器中注册一个Bean;类型为返回值的类型，id默认是用方法名作为id</span></span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Person <span class="title">person01</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"lisi"</span>, <span class="number">20</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.AnnotationMetadata;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.ClassMetadata;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.MetadataReader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.MetadataReaderFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.filter.TypeFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title">TypeFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * metadataReader：读取到的当前正在扫描的类的信息</span></span><br><span class="line"><span class="comment">    * metadataReaderFactory:可以获取到其他任何类信息的</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span></span></span><br><span class="line"><span class="function">         <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">      <span class="comment">//获取当前类注解的信息</span></span><br><span class="line">      AnnotationMetadata annotationMetadata = metadataReader.getAnnotationMetadata();</span><br><span class="line">      <span class="comment">//获取当前正在扫描的类的类信息</span></span><br><span class="line">      ClassMetadata classMetadata = metadataReader.getClassMetadata();</span><br><span class="line">      <span class="comment">//获取当前类资源（类的路径）</span></span><br><span class="line">      Resource resource = metadataReader.getResource();</span><br><span class="line">      </span><br><span class="line">      String className = classMetadata.getClassName();</span><br><span class="line">      System.out.println(<span class="string">"---&gt;"</span>+className);</span><br><span class="line">      <span class="keyword">if</span>(className.contains(<span class="string">"er"</span>))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IOCTest</span> </span>&#123;</span><br><span class="line">   AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(MainConfig.class);</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testImport</span><span class="params">()</span></span>&#123;</span><br><span class="line">      Person bean = applicationContext.getBean(Person.class);</span><br><span class="line">      System.out.println(bean);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、-Scope，-Lazy，-Conditional，-Import注解"><a href="#2、-Scope，-Lazy，-Conditional，-Import注解" class="headerlink" title="2、@Scope，@Lazy，@Conditional，@Import注解"></a>2、@Scope，@Lazy，@Conditional，@Import注解</h3><ul>
<li>@Scope：对象作用域（默认单例）</li>
<li>@Lazy：懒加载，在用到对象时加载</li>
<li><p>@Conditional：</p>
<ul>
<li>按照一定的条件进行判断，满足条件给容器中注册bean</li>
<li>对类中组件统一设置，==满足括号中的条件==，这个类中配置的所有bean注册才能生效</li>
</ul>
</li>
<li><p>@Import：导入对象</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.ConfigurableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Conditional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Blue;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Color;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.ColorFactoryBean;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Person;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Red;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.condition.LinuxCondition;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.condition.MyImportBeanDefinitionRegistrar;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.condition.MyImportSelector;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.condition.WindowsCondition;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.test.IOCTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类中组件统一设置。满足当前条件，这个类中配置的所有bean注册才能生效；</span></span><br><span class="line"><span class="meta">@Conditional</span>(&#123;WindowsCondition.class&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;Color.class,Red.class,MyImportSelector.class,MyImportBeanDefinitionRegistrar.class&#125;)</span><br><span class="line"><span class="comment">//@Import导入组件，id默认是组件的全类名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig2</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//默认是单实例的</span></span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @Scope:调整作用域</span></span><br><span class="line"><span class="comment">    * prototype：多实例的：ioc容器启动并不会去调用方法创建对象放在容器中。</span></span><br><span class="line"><span class="comment">    *                 每次获取的时候才会调用方法创建对象；</span></span><br><span class="line"><span class="comment">    * singleton：单实例的（默认值）：ioc容器启动会调用方法创建对象放到ioc容器中。</span></span><br><span class="line"><span class="comment">    *           以后每次获取就是直接从容器（map.get()）中拿，</span></span><br><span class="line"><span class="comment">    * request：同一次请求创建一个实例</span></span><br><span class="line"><span class="comment">    * session：同一个session创建一个实例</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * 懒加载：</span></span><br><span class="line"><span class="comment">    *        单实例bean：默认在容器启动的时候创建对象；</span></span><br><span class="line"><span class="comment">    *        懒加载：容器启动不创建对象。第一次使用(获取)Bean创建对象，并初始化；</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="comment">// @Scope("prototype")</span></span><br><span class="line">   <span class="meta">@Lazy</span></span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"给容器中添加Person...."</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"张三"</span>, <span class="number">25</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Conditional</span>(&#123;Condition&#125;) ： 按照一定的条件进行判断，满足条件给容器中注册bean</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * 如果系统是windows，给容器中注册("bill")</span></span><br><span class="line"><span class="comment">    * 如果是linux系统，给容器中注册("linus")</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"bill"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Person <span class="title">person01</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"Bill Gates"</span>,<span class="number">62</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Conditional</span>(LinuxCondition.class)</span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"linus"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Person <span class="title">person02</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"linus"</span>, <span class="number">48</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 给容器中注册组件；</span></span><br><span class="line"><span class="comment">    * 1）、包扫描+组件标注注解（<span class="doctag">@Controller</span>/<span class="doctag">@Service</span>/<span class="doctag">@Repository</span>/<span class="doctag">@Component</span>）[导入自己写的类的方式]</span></span><br><span class="line"><span class="comment">    * 2）、<span class="doctag">@Bean</span>[导入的第三方包里面的组件的方式]</span></span><br><span class="line"><span class="comment">    * 3）、<span class="doctag">@Import</span>[快速给容器中导入一个组件]</span></span><br><span class="line"><span class="comment">    *        1）、<span class="doctag">@Import</span>(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名</span></span><br><span class="line"><span class="comment">    *        2）、ImportSelector:返回需要导入的组件的全类名数组；</span></span><br><span class="line"><span class="comment">    *        3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中</span></span><br><span class="line"><span class="comment">    * 4）、使用Spring提供的 FactoryBean（工厂Bean）;</span></span><br><span class="line"><span class="comment">    *        1）、默认获取到的是工厂bean调用getObject创建的对象</span></span><br><span class="line"><span class="comment">    *        2）、要获取工厂Bean本身，我们需要给id前面加一个&amp;</span></span><br><span class="line"><span class="comment">    *           &amp;colorFactoryBean</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ColorFactoryBean <span class="title">colorFactoryBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ColorFactoryBean();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Import注解的使用"><a href="#Import注解的使用" class="headerlink" title="@Import注解的使用"></a>@Import注解的使用</h4><p>MyImportSelector</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义逻辑返回需要导入的组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportSelector</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//返回值，就是要导入到容器中的组件全类名</span></span><br><span class="line">   <span class="comment">//AnnotationMetadata:当前标注@Import注解的类的所有注解信息</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">      <span class="comment">//方法不要返回null值</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">"com.atguigu.bean.Blue"</span>,<span class="string">"com.atguigu.bean.Yellow"</span>&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MyImportBeanDefinitionRegistrar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * AnnotationMetadata：当前类的注解信息</span></span><br><span class="line"><span class="comment">    * BeanDefinitionRegistry:BeanDefinition注册类；</span></span><br><span class="line"><span class="comment">    *        把所有需要添加到容器中的bean；调用</span></span><br><span class="line"><span class="comment">    *        BeanDefinitionRegistry.registerBeanDefinition手工注册进来</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 判断容器中是否具有这个对象</span></span><br><span class="line">      <span class="keyword">boolean</span> definition = registry.containsBeanDefinition(<span class="string">"com.atguigu.bean.Red"</span>);</span><br><span class="line">      <span class="keyword">boolean</span> definition2 = registry.containsBeanDefinition(<span class="string">"com.atguigu.bean.Blue"</span>);</span><br><span class="line">      <span class="keyword">if</span>(definition &amp;&amp; definition2)&#123;</span><br><span class="line">         <span class="comment">//指定Bean定义信息；（Bean的类型，Bean。。。）</span></span><br><span class="line">         RootBeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition(RainBow.class);</span><br><span class="line">         <span class="comment">//注册一个Bean，指定bean名</span></span><br><span class="line">         registry.registerBeanDefinition(<span class="string">"rainBow"</span>, beanDefinition);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="FactoryBean的使用"><a href="#FactoryBean的使用" class="headerlink" title="FactoryBean的使用"></a>FactoryBean的使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个Spring定义的FactoryBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Color</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//返回一个Color对象，这个对象会添加到容器中</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Color <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">      System.out.println(<span class="string">"ColorFactoryBean...getObject..."</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Color();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">      <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">      <span class="keyword">return</span> Color.class;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//是单例？</span></span><br><span class="line">   <span class="comment">//true：这个bean是单实例，在容器中保存一份</span></span><br><span class="line">   <span class="comment">//false：多实例，每次获取都会创建一个新的bean；</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注入容器中</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180926/lDgJf83fHc.png?imageslim" alt="mark"></p>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IOCTest</span> </span>&#123;</span><br><span class="line">   AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(MainConfig2.class);</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testImport</span><span class="params">()</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//工厂Bean获取的是调用getObject创建的对象</span></span><br><span class="line">      Object bean2 = applicationContext.getBean(<span class="string">"colorFactoryBean"</span>);</span><br><span class="line">      Object bean3 = applicationContext.getBean(<span class="string">"colorFactoryBean"</span>);</span><br><span class="line">      System.out.println(<span class="string">"bean的类型："</span>+bean2.getClass());   <span class="comment">// 对象的类型为Color类型</span></span><br><span class="line">      System.out.println(bean2 == bean3);	<span class="comment">// 由于是单例，所以是true</span></span><br><span class="line">       </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3</p>
<h3 id="3、实例的生命周期"><a href="#3、实例的生命周期" class="headerlink" title="3、实例的生命周期"></a>3、实例的生命周期</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Car;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * bean的生命周期：</span></span><br><span class="line"><span class="comment"> *        bean创建---初始化----销毁的过程</span></span><br><span class="line"><span class="comment"> * 容器管理bean的生命周期；</span></span><br><span class="line"><span class="comment"> * 我们可以自定义初始化和销毁方法；容器在bean进行到当前生命周期的时候来调用我们自定义的初始化和销毁方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 构造（对象创建）</span></span><br><span class="line"><span class="comment"> *        单实例：在容器启动的时候创建对象</span></span><br><span class="line"><span class="comment"> *        多实例：在每次获取的时候创建对象</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 在初始化之前执行BeanPostProcessor.postProcessBeforeInitialization方法</span></span><br><span class="line"><span class="comment"> * 初始化：</span></span><br><span class="line"><span class="comment"> *        对象创建完成，并赋值好，调用初始化方法。。。</span></span><br><span class="line"><span class="comment"> * 在销毁之前执行BeanPostProcessor.postProcessAfterInitialization方法</span></span><br><span class="line"><span class="comment"> * 销毁：</span></span><br><span class="line"><span class="comment"> *        单实例：容器关闭的时候</span></span><br><span class="line"><span class="comment"> *        多实例：容器不会管理这个bean；容器不会调用销毁方法；</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 遍历得到容器中所有的BeanPostProcessor；挨个执行beforeInitialization，</span></span><br><span class="line"><span class="comment"> * 一但返回null，跳出for循环，不会执行后面的BeanPostProcessor.postProcessorsBeforeInitialization</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 1）、指定初始化和销毁方法（需要在Car中写好这两个方法）</span></span><br><span class="line"><span class="comment"> *        通过@Bean指定init-method和destroy-method；</span></span><br><span class="line"><span class="comment"> * 2）、通过让Bean实现InitializingBean（定义初始化逻辑），</span></span><br><span class="line"><span class="comment"> *                 DisposableBean（定义销毁逻辑）接口;</span></span><br><span class="line"><span class="comment"> * 3）、可以使用JSR250（直接戴在Car类中的方法上）</span></span><br><span class="line"><span class="comment"> *        @PostConstruct：在bean创建完成并且属性赋值完成；来执行初始化方法</span></span><br><span class="line"><span class="comment"> *        @PreDestroy：在容器销毁bean之前通知我们进行清理工作</span></span><br><span class="line"><span class="comment"> * 4）、BeanPostProcessor【interface】：bean的后置处理器；</span></span><br><span class="line"><span class="comment"> *        在bean初始化前后进行一些处理工作；</span></span><br><span class="line"><span class="comment"> *        postProcessBeforeInitialization:在初始化之前工作</span></span><br><span class="line"><span class="comment"> *        postProcessAfterInitialization:在初始化之后工作</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Spring底层对 BeanPostProcessor 的使用；</span></span><br><span class="line"><span class="comment"> *        bean赋值，注入其他组件，@Autowired，生命周期注解功能，@Async,xxx BeanPostProcessor;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.atguigu.bean"</span>)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfigOfLifeCycle</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//@Scope("prototype")</span></span><br><span class="line">   <span class="meta">@Bean</span>(initMethod=<span class="string">"init"</span>,destroyMethod=<span class="string">"detory"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Car <span class="title">car</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Car();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后置处理器：初始化前后进行处理工作</span></span><br><span class="line"><span class="comment"> * 将后置处理器加入到容器中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"postProcessBeforeInitialization..."</span>+beanName+<span class="string">"=&gt;"</span>+bean);</span><br><span class="line">      <span class="keyword">return</span> bean;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"postProcessAfterInitialization..."</span>+beanName+<span class="string">"=&gt;"</span>+bean);</span><br><span class="line">      <span class="keyword">return</span> bean;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4、属性赋值"><a href="#4、属性赋值" class="headerlink" title="4、属性赋值"></a>4、属性赋值</h3><p>Person类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//使用@Value赋值；</span></span><br><span class="line">   <span class="comment">//1、基本数值</span></span><br><span class="line">   <span class="comment">//2、可以写SpEL； #&#123;&#125;</span></span><br><span class="line">   <span class="comment">//3、可以写$&#123;&#125;；取出配置文件【properties】中的值（在运行环境变量里面的值）</span></span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Value</span>(<span class="string">"张三"</span>)</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="meta">@Value</span>(<span class="string">"#&#123;20-2&#125;"</span>)</span><br><span class="line">   <span class="keyword">private</span> Integer age;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Value</span>(<span class="string">"$&#123;person.nickName&#125;"</span>)</span><br><span class="line">   <span class="keyword">private</span> String nickName;</span><br></pre></td></tr></table></figure>
<p>配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用@PropertySource读取外部配置文件中的k/v保存到运行的环境变量中;加载完外部的配置文件以后使用$&#123;&#125;取出配置文件的值</span></span><br><span class="line"><span class="meta">@PropertySource</span>(value=&#123;<span class="string">"classpath:/person.properties"</span>&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfigOfPropertyValues</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、切换环境"><a href="#5、切换环境" class="headerlink" title="5、切换环境"></a>5、切换环境</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.EmbeddedValueResolverAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Profile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringValueResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Yellow;</span><br><span class="line"><span class="keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Profile：</span></span><br><span class="line"><span class="comment"> *        Spring为我们提供的可以根据当前环境，动态的激活和切换一系列组件的功能；</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 开发环境、测试环境、生产环境；</span></span><br><span class="line"><span class="comment"> * 数据源：(/A)(/B)(/C)；</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Profile</span>：指定组件在哪个环境的情况下才能被注册到容器中，不指定，任何环境下都能注册这个组件</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 1）、加了环境标识的bean，只有这个环境被激活的时候才能注册到容器中。默认是default环境</span></span><br><span class="line"><span class="comment"> * 2）、写在配置类上，只有是指定的环境的时候，整个配置类里面的所有配置才能开始生效</span></span><br><span class="line"><span class="comment"> * 3）、没有标注环境标识的bean在，任何环境下都是加载的；</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:/dbconfig.properties"</span>)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfigOfProfile</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Value</span>(<span class="string">"$&#123;db.user&#125;"</span>)</span><br><span class="line">   <span class="keyword">private</span> String user;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String  driverClass;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Profile</span>(<span class="string">"test"</span>)</span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"testDataSource"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSourceTest</span><span class="params">(@Value(<span class="string">"$&#123;db.password&#125;"</span>)</span>String pwd) <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">      dataSource.setUser(user);</span><br><span class="line">      dataSource.setPassword(pwd);</span><br><span class="line">      dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306/test"</span>);</span><br><span class="line">      dataSource.setDriverClass(driverClass);</span><br><span class="line">      <span class="keyword">return</span> dataSource;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Profile</span>(<span class="string">"dev"</span>)</span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"devDataSource"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSourceDev</span><span class="params">(@Value(<span class="string">"$&#123;db.password&#125;"</span>)</span>String pwd) <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">      dataSource.setUser(user);</span><br><span class="line">      dataSource.setPassword(pwd);</span><br><span class="line">      dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306/ssm_crud"</span>);</span><br><span class="line">      dataSource.setDriverClass(driverClass);</span><br><span class="line">      <span class="keyword">return</span> dataSource;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Profile</span>(<span class="string">"prod"</span>)</span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"prodDataSource"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSourceProd</span><span class="params">(@Value(<span class="string">"$&#123;db.password&#125;"</span>)</span>String pwd) <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">      dataSource.setUser(user);</span><br><span class="line">      dataSource.setPassword(pwd);</span><br><span class="line">      dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306/scw_0515"</span>);</span><br><span class="line">      </span><br><span class="line">      dataSource.setDriverClass(driverClass);</span><br><span class="line">      <span class="keyword">return</span> dataSource;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Boss;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Car;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Color;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Red;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.bean.Yellow;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.config.MainConfigOfProfile;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.config.MainConifgOfAutowired;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.dao.BookDao;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.service.BookService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IOCTest_Profile</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//1、使用命令行动态参数: 在虚拟机参数位置加载 -Dspring.profiles.active=test</span></span><br><span class="line">   <span class="comment">//2、代码的方式激活某种环境；</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">      AnnotationConfigApplicationContext applicationContext = </span><br><span class="line">            <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">      <span class="comment">//1、创建一个applicationContext</span></span><br><span class="line">      <span class="comment">//2、设置需要激活的环境</span></span><br><span class="line">      applicationContext.getEnvironment().setActiveProfiles(<span class="string">"dev"</span>);</span><br><span class="line">      <span class="comment">//3、注册主配置类</span></span><br><span class="line">      applicationContext.register(MainConfigOfProfile.class);</span><br><span class="line">      <span class="comment">//4、启动刷新容器</span></span><br><span class="line">      applicationContext.refresh();</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      String[] namesForType = applicationContext.getBeanNamesForType(DataSource.class);</span><br><span class="line">      <span class="keyword">for</span> (String string : namesForType) &#123;</span><br><span class="line">         System.out.println(string);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      Yellow bean = applicationContext.getBean(Yellow.class);</span><br><span class="line">      System.out.println(bean);</span><br><span class="line">      applicationContext.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6、注解模式AOP"><a href="#6、注解模式AOP" class="headerlink" title="6、注解模式AOP"></a>6、注解模式AOP</h3><p>引入jar包：spring-aspects</p>
<p>配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aopalliance.aop.Advice;</span><br><span class="line"><span class="keyword">import</span> org.aopalliance.intercept.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.Advisor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.AopInfrastructureBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.aop.LogAspects;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.aop.MathCalculator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AOP：【动态代理】</span></span><br><span class="line"><span class="comment"> *        指在程序运行期间动态的将某段代码切入到指定方法指定位置进行运行的编程方式；</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 1、导入aop模块；Spring AOP：(spring-aspects)</span></span><br><span class="line"><span class="comment"> * 2、定义一个业务逻辑类（MathCalculator）；在业务逻辑运行的时候将日志进行打印（方法之前、方法运行结束、方法出现异常，xxx）</span></span><br><span class="line"><span class="comment"> * 3、定义一个日志切面类（LogAspects）：切面类里面的方法需要动态感知MathCalculator.div运行到哪里然后执行；</span></span><br><span class="line"><span class="comment"> *        通知方法：</span></span><br><span class="line"><span class="comment"> *           前置通知(<span class="doctag">@Before</span>)：logStart：在目标方法(div)运行之前运行</span></span><br><span class="line"><span class="comment"> *           后置通知(<span class="doctag">@After</span>)：logEnd：在目标方法(div)运行结束之后运行（无论方法正常结束还是异常结束）</span></span><br><span class="line"><span class="comment"> *           返回通知(<span class="doctag">@AfterReturning</span>)：logReturn：在目标方法(div)正常返回之后运行</span></span><br><span class="line"><span class="comment"> *           异常通知(<span class="doctag">@AfterThrowing</span>)：logException：在目标方法(div)出现异常以后运行</span></span><br><span class="line"><span class="comment"> *           环绕通知(<span class="doctag">@Around</span>)：动态代理，手动推进目标方法运行（joinPoint.procced()）</span></span><br><span class="line"><span class="comment"> * 4、给切面类的目标方法标注何时何地运行（通知注解）；</span></span><br><span class="line"><span class="comment"> * 5、将切面类和业务逻辑类（目标方法所在类）都加入到容器中;</span></span><br><span class="line"><span class="comment"> * 6、必须告诉Spring哪个类是切面类(给切面类上加一个注解：<span class="doctag">@Aspect</span>)</span></span><br><span class="line"><span class="comment"> * [7]、给配置类中加 <span class="doctag">@EnableAspectJAutoProxy</span> 【开启基于注解的aop模式】</span></span><br><span class="line"><span class="comment"> *        在Spring中很多的 <span class="doctag">@EnableXXX</span>;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 三步：</span></span><br><span class="line"><span class="comment"> *     1）、将业务逻辑组件和切面类都加入到容器中；告诉Spring哪个是切面类（<span class="doctag">@Aspect</span>）</span></span><br><span class="line"><span class="comment"> *     2）、在切面类上的每一个通知方法上标注通知注解，告诉Spring何时何地运行（切入点表达式）</span></span><br><span class="line"><span class="comment"> *     3）、开启基于注解的aop模式；<span class="doctag">@EnableAspectJAutoProxy</span></span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * 执行效果：</span></span><br><span class="line"><span class="comment"> *     正常执行：前置通知-》目标方法-》后置通知-》返回通知</span></span><br><span class="line"><span class="comment"> *     出现异常：前置通知-》目标方法-》后置通知-》异常通知</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfigOfAOP</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//业务逻辑类加入容器中</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> MathCalculator <span class="title">calculator</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MathCalculator();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//切面类加入到容器中</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LogAspects <span class="title">logAspects</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LogAspects();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Aspect</span>： 告诉Spring当前类是一个切面类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspects</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//抽取公共的切入点表达式</span></span><br><span class="line">   <span class="comment">//1、本类引用</span></span><br><span class="line">   <span class="comment">//2、其他的切面引用</span></span><br><span class="line">   <span class="meta">@Pointcut</span>(<span class="string">"execution(public int com.atguigu.aop.MathCalculator.*(..))"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//@Before在目标方法之前切入；切入点表达式（指定在哪个方法切入）</span></span><br><span class="line">   <span class="meta">@Before</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logStart</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">      Object[] args = joinPoint.getArgs();   <span class="comment">// 获取方法参数</span></span><br><span class="line">      System.out.println(<span class="string">""</span>+joinPoint.getSignature().getName()+<span class="string">"运行。。。@Before:参数列表是：&#123;"</span>+Arrays.asList(args)+<span class="string">"&#125;"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@After</span>(<span class="string">"com.atguigu.aop.LogAspects.pointCut()"</span>)    <span class="comment">// 如果外部类想要采用pointCut()这个切面</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logEnd</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">""</span>+joinPoint.getSignature().getName()+<span class="string">"结束。。。@After"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//JoinPoint一定要出现在参数表的第一位</span></span><br><span class="line">   <span class="meta">@AfterReturning</span>(value=<span class="string">"pointCut()"</span>,returning=<span class="string">"result"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logReturn</span><span class="params">(JoinPoint joinPoint,Object result)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">""</span>+joinPoint.getSignature().getName()+<span class="string">"正常返回。。。@AfterReturning:运行结果：&#123;"</span>+result+<span class="string">"&#125;"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@AfterThrowing</span>(value=<span class="string">"pointCut()"</span>,throwing=<span class="string">"exception"</span>)    <span class="comment">// 使用exception来接收异常</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(JoinPoint joinPoint,Exception exception)</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">""</span>+joinPoint.getSignature().getName()+<span class="string">"异常。。。异常信息：&#123;"</span>+exception+<span class="string">"&#125;"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7、Servlet3-0新特性"><a href="#7、Servlet3-0新特性" class="headerlink" title="7、Servlet3.0新特性"></a>7、Servlet3.0新特性</h3><p>3.0可以不用使用web.xml进行配置了，，开心~</p>
<p>容器在启动应用的时候，会扫描当前应用每一个jar包里面META-INF/services/javax.servlet.ServletContainerInitializer文件</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180926/Dbjk1Fh3AG.png?imageslim" alt="mark"></p>
<p>我们可以通过这个类来注册servlet、listener、filter等操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.EnumSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.DispatcherType;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterRegistration;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContainerInitializer;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRegistration;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.HandlesTypes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.service.HelloService;</span><br><span class="line"></span><br><span class="line"><span class="comment">//容器启动的时候会将@HandlesTypes指定的这个类型下面的子类（实现类，子接口等）传递过来；</span></span><br><span class="line"><span class="meta">@HandlesTypes</span>(value=&#123;HelloService.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletContainerInitializer</span> <span class="keyword">implements</span> <span class="title">ServletContainerInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 应用启动的时候，会运行onStartup方法；</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * Set&lt;Class&lt;?&gt;&gt; arg0：感兴趣的类型的所有子类型；</span></span><br><span class="line"><span class="comment">    * ServletContext arg1:代表当前Web应用的ServletContext；一个Web应用一个ServletContext；</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * 1）、使用ServletContext注册Web组件（Servlet、Filter、Listener）</span></span><br><span class="line"><span class="comment">    * 2）、使用编码的方式，在项目启动的时候给ServletContext里面添加组件；</span></span><br><span class="line"><span class="comment">    *        必须在项目启动的时候来添加，有以下两种方式获取ServletContext进行注册</span></span><br><span class="line"><span class="comment">    *        1）、ServletContainerInitializer得到的ServletContext；</span></span><br><span class="line"><span class="comment">    *        2）、ServletContextListener得到的ServletContext；</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(Set&lt;Class&lt;?&gt;&gt; arg0, ServletContext sc)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ================= 获取@HandlesTypes传入的类 ==================</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (Class&lt;?&gt; claz : arg0) &#123;</span><br><span class="line">         System.out.println(claz);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// =========================== 注册组件 ======================</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//注册组件  ServletRegistration  </span></span><br><span class="line">      ServletRegistration.Dynamic servlet = sc.addServlet(<span class="string">"userServlet"</span>, <span class="keyword">new</span> UserServlet());</span><br><span class="line">      <span class="comment">//配置servlet的映射信息</span></span><br><span class="line">      servlet.addMapping(<span class="string">"/user"</span>);</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      <span class="comment">//注册Listener</span></span><br><span class="line">      sc.addListener(UserListener.class);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//注册Filter  FilterRegistration</span></span><br><span class="line">      FilterRegistration.Dynamic filter = sc.addFilter(<span class="string">"userFilter"</span>, UserFilter.class);</span><br><span class="line">      <span class="comment">//配置Filter的映射信息</span></span><br><span class="line">      filter.addMappingForUrlPatterns(EnumSet.of(DispatcherType.REQUEST), <span class="keyword">true</span>, <span class="string">"/*"</span>);</span><br><span class="line">      </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8、SpringMVC整合"><a href="#8、SpringMVC整合" class="headerlink" title="8、SpringMVC整合"></a>8、<a href="https://docs.spring.io/spring/docs/5.1.1.BUILD-SNAPSHOT/spring-framework-reference/web.html#mvc-config" target="_blank" rel="noopener">SpringMVC</a>整合</h3><p>所需jar包和控件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.11.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0-alpha-1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">failOnMissingWebXml</span>&gt;</span>false<span class="tag">&lt;/<span class="name">failOnMissingWebXml</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Spring帮我们写好了这个文件</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180926/bImjkdc1Dd.png?imageslim" alt="mark"></p>
<p>以注解方式来启动SpringMVC；继承AbstractAnnotationConfigDispatcherServletInitializer；</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180926/mdC8kEagF2.png?imageslim" alt="mark"></p>
<p>官方推荐采用这种方式进行配置</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180926/4m2ElEj0CB.png?imageslim" alt="mark"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.config.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.config.RootConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">//web容器启动的时候创建对象；调用方法来初始化容器以前的前端控制器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取根容器的配置类；（Spring的配置文件）   父容器；</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[]&#123;RootConfig.class&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取web容器的配置类（SpringMVC配置文件）  子容器；</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[]&#123;AppConfig.class&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取DispatcherServlet的映射信息</span></span><br><span class="line">   <span class="comment">//  /：拦截所有请求（包括静态资源（xx.js,xx.png）），但是不包括*.jsp；</span></span><br><span class="line">   <span class="comment">//  /*：拦截所有请求；连*.jsp页面都拦截；jsp页面是tomcat的jsp引擎解析的；</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">"/"</span>&#125;;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现抽象方法指定DispatcherServlet的配置信息</p>
<p>==AppConfig==：配置web容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan.Filter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.FilterType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.FormatterRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.MessageCodesResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Validator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.support.HandlerMethodArgumentResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.support.HandlerMethodReturnValueHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerExceptionResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.AsyncSupportConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ContentNegotiationConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.PathMatchConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewResolverRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.controller.MyFirstInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SpringMVC只扫描Controller；子容器</span></span><br><span class="line"><span class="comment">//useDefaultFilters=false 禁用默认的过滤规则；</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>,includeFilters=&#123;</span><br><span class="line">      <span class="meta">@Filter</span>(type=FilterType.ANNOTATION,classes=&#123;Controller.class&#125;)</span><br><span class="line">&#125;,useDefaultFilters=<span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@EnableWebMvc</span>	<span class="comment">// 要开启webmvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span>  <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ==================== 定制 ====================</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">//视图解析器</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//默认所有的页面都从 /WEB-INF/ xxx .jsp</span></span><br><span class="line">      registry.jsp(<span class="string">"/WEB-INF/views/"</span>, <span class="string">".jsp"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//静态资源访问</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> </span>&#123;</span><br><span class="line">      configurer.enable();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//拦截器</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">      registry.addInterceptor(<span class="keyword">new</span> MyFirstInterceptor()).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>==RootConfig==：配置spring容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Spring的容器不扫描controller;父容器</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>,excludeFilters=&#123;</span><br><span class="line">      <span class="meta">@Filter</span>(type=FilterType.ANNOTATION,classes=&#123;Controller.class&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RootConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9、异步"><a href="#9、异步" class="headerlink" title="9、异步"></a>9、异步</h3><p>异步==&gt;servlet3.0 ==&gt;高并发</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/27/Spring注解使用 /" data-id="cjmvxlan7000n0gjemslsvon9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SpringBoot与Redis的整合" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/26/SpringBoot与Redis的整合/" class="article-date">
  <time datetime="2018-09-26T01:33:33.000Z" itemprop="datePublished">2018-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/26/SpringBoot与Redis的整合/">SpringBoot与Redis的整合</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1、引入redis依赖"><a href="#1、引入redis依赖" class="headerlink" title="1、引入redis依赖"></a>1、引入redis依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--添加redis缓存依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2、书写配置文件"><a href="#2、书写配置文件" class="headerlink" title="2、书写配置文件"></a>2、书写配置文件</h3><p>在application.properties文件中写下连接redis所需要的信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Redis数据库索引（默认为0）,如果设置为1，那么存入的key-value都存放在select 1中</span><br><span class="line">spring.redis.database=0</span><br><span class="line"># Redis服务器地址</span><br><span class="line">spring.redis.host=127.0.0.1</span><br><span class="line"># Redis服务器连接端口</span><br><span class="line">spring.redis.port=6379</span><br><span class="line"># Redis服务器连接密码（默认为空）</span><br><span class="line">spring.redis.password=</span><br><span class="line">#连接池最大连接数（使用负值表示没有限制）</span><br><span class="line">spring.redis.pool.max-active=8</span><br><span class="line"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span><br><span class="line">spring.redis.pool.max-wait=-1</span><br><span class="line"># 连接池中的最大空闲连接</span><br><span class="line">spring.redis.pool.max-idle=8</span><br><span class="line"># 连接池中的最小空闲连接</span><br><span class="line">spring.redis.pool.min-idle=0</span><br><span class="line"># 连接超时时间（毫秒）</span><br><span class="line">spring.redis.timeout=0</span><br></pre></td></tr></table></figure>
<h3 id="3、RedisCacheConfig配置"><a href="#3、RedisCacheConfig配置" class="headerlink" title="3、RedisCacheConfig配置"></a>3、RedisCacheConfig配置</h3><p>主要分3个步骤</p>
<ul>
<li>使用JedisConnectionFactory建立连接工厂</li>
<li>创建RedisTemplate模板</li>
<li>配置序列化器，RedisTemplate提供了以下几种序列化器，我们可以根据项目的需求进行选择。</li>
</ul>
<table>
<thead>
<tr>
<th>序列化器</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>RedisSerializer</td>
<td>redis序列化的接口类</td>
</tr>
<tr>
<td>OxmSerializer</td>
<td>xml到object的序列化/反序列化</td>
</tr>
<tr>
<td>StringRedisSerializer</td>
<td>string字符串的序列化/反序列化</td>
</tr>
<tr>
<td>JacksonJsonRedisSerializer</td>
<td>json到object的序列化/反序列化</td>
</tr>
<tr>
<td>Jackson2JsonRedisSerializer（默认）</td>
<td>json到object的序列化/反序列化</td>
</tr>
<tr>
<td>JdkSerializationRedisSerializer</td>
<td>java对象的序列化/反序列化</td>
</tr>
</tbody>
</table>
<p><a href="http://stamen.iteye.com/blog/1907984" target="_blank" rel="noopener">序列化器</a>比较结果：从执行时间上来看，JdkSerializationRedisSerializer是最高效的（毕竟是JDK原生的），但是是序列化的结果字符串是最长的。JSON由于其数据格式的紧凑性，序列化的长度是最小的，时间比前者要多一些。而OxmSerialiabler在时间上看是最长的（当时和使用具体的Marshaller有关）。所以个人的选择是倾向使用JacksonJsonRedisSerializer作为POJO的序列器。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCacheConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.host&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.port&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.timeout&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> timeout;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.database&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> database;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.redis.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接redis的工厂类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JedisConnectionFactory <span class="title">jedisConnectionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JedisConnectionFactory factory = <span class="keyword">new</span> JedisConnectionFactory();</span><br><span class="line">        factory.setHostName(host);</span><br><span class="line">        factory.setPort(port);</span><br><span class="line">        factory.setTimeout(timeout);</span><br><span class="line">        factory.setPassword(password);</span><br><span class="line">        factory.setDatabase(database);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置RedisTemplate</span></span><br><span class="line"><span class="comment">     * 设置添加序列化器</span></span><br><span class="line"><span class="comment">     * key 使用string序列化器</span></span><br><span class="line"><span class="comment">     * value 使用Json序列化器</span></span><br><span class="line"><span class="comment">     * 还有一种简单的设置方式，改变defaultSerializer对象的实现。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//StringRedisTemplate的构造方法中默认设置了stringSerializer</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">//set key serializer</span></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line"></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line"></span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line">        <span class="comment">//set value serializer</span></span><br><span class="line">        template.setDefaultSerializer(jackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        template.setConnectionFactory(jedisConnectionFactory());</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4、测试"><a href="#4、测试" class="headerlink" title="4、测试"></a>4、测试</h3><p>连接redis，，测试存储</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">helloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        redisTemplate.opsForValue();//操作字符串</span></span><br><span class="line"><span class="comment">        redisTemplate.opsForHash();//操作hash</span></span><br><span class="line"><span class="comment">        redisTemplate.opsForList();//操作list</span></span><br><span class="line"><span class="comment">        redisTemplate.opsForSet();//操作set</span></span><br><span class="line"><span class="comment">        redisTemplate.opsForZSet();//操作有序set</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ValueOperations&lt;String,Object&gt; valueOperations = redisTemplate.opsForValue();</span><br><span class="line">        valueOperations.set(<span class="string">"hello"</span>, <span class="string">"redis"</span>);</span><br><span class="line">        System.out.println(<span class="string">"useRedisDao = "</span> + valueOperations.get(<span class="string">"hello"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、数据缓存"><a href="#5、数据缓存" class="headerlink" title="5、数据缓存"></a>5、数据缓存</h3><ul>
<li>实体类要实现Serializable接口</li>
<li><del>JPA的类要转为DTO（dozer）</del></li>
<li>还要开启注解式的缓存支持（<strong>@EnableCaching</strong>）</li>
</ul>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180925/f3GlcGIehk.png?imageslim" alt="mark"></p>
<h4 id="条件缓存"><a href="#条件缓存" class="headerlink" title="条件缓存"></a>条件缓存</h4><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180925/gFalk7Dm45.png?imageslim" alt="mark"></p>
<p>本文参考：<a href="https://www.jianshu.com/p/7f6a180e6ee7" target="_blank" rel="noopener">1</a>，<a href="https://www.jianshu.com/p/a8694d97caaa" target="_blank" rel="noopener">2</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/26/SpringBoot与Redis的整合/" data-id="cjmvxla5m00030gjeoitldfiy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-gitlab+idea的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/24/gitlab+idea的使用/" class="article-date">
  <time datetime="2018-09-24T01:33:33.000Z" itemprop="datePublished">2018-09-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/24/gitlab+idea的使用/">Idea中使用Gitlab</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Idea中使用Gitlab"><a href="#Idea中使用Gitlab" class="headerlink" title="Idea中使用Gitlab"></a>Idea中使用Gitlab</h2><h3 id="一、项目下载"><a href="#一、项目下载" class="headerlink" title="一、项目下载"></a>一、项目下载</h3><p>1、配置git的位置</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/KgEA10L75a.png?imageslim" alt="mark"></p>
<p>2、选择git导入项目</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/I8dk0GAGba.png?imageslim" alt="mark"></p>
<p>弹出这个界面</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/lfGAlalh8b.png?imageslim" alt="mark"></p>
<p>仓库的地址从这里获取</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/h2d1g4IC1d.png?imageslim" alt="mark"></p>
<p>当项目下载成功后，会弹出下面的对话框，==直接关闭它==，并手动open下载的项目</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/84cKj37Cb8.png?imageslim" alt="mark"></p>
<h3 id="二、上传修改的文件"><a href="#二、上传修改的文件" class="headerlink" title="二、上传修改的文件"></a>二、上传修改的文件</h3><p>当打开下载完成的项目，会发现多了个Git菜单，我们就使用这个菜单进行各种操作</p>
<h4 id="1、选择Git-gt-add，将项目中的文件加入到git-add-中等待本地提交。"><a href="#1、选择Git-gt-add，将项目中的文件加入到git-add-中等待本地提交。" class="headerlink" title="1、选择Git-&gt;add，将项目中的文件加入到git add 中等待本地提交。"></a>1、选择<code>Git-&gt;add</code>，将项目中的文件加入到git add 中等待本地提交。</h4><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/K820dD1jk0.png?imageslim" alt="mark"></p>
<p>add 后文件都会由<code>橙色</code>变成 <code>绿色</code></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/ccb6BcDH2K.png?imageslim" alt="mark"></p>
<h4 id="2、将本地代码上传到暂存区"><a href="#2、将本地代码上传到暂存区" class="headerlink" title="2、将本地代码上传到暂存区"></a>2、将本地代码上传到暂存区</h4><p>右击项目，选择 <code>Git-&gt;Commit Directory...</code></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/ad3cbHda0K.png?imageslim" alt="mark"></p>
<p>点击之后会弹出下面的对话框，选则修改的文件和提交信息之后点击commit，就会将代码存入==暂存区==</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/ig30dhflJK.png?imageslim" alt="mark"></p>
<p><code>Performing Code Analysis</code>提示，有时候会很慢，这个功能是它对代码进行分析，查找错误，并提醒你是否修改。每次提交前都要查询一次，很麻烦，可以关闭该功能。</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/hikgJkIkHG.png?imageslim" alt="mark"></p>
<p>这时本地提交成功，可以看见颜色 从 <code>绿色</code> 变成 了<code>黑色</code>。</p>
<h4 id="3、将代码push到远程-git-仓库"><a href="#3、将代码push到远程-git-仓库" class="headerlink" title="3、将代码push到远程 git 仓库"></a>3、将代码push到远程 git 仓库</h4><p>代码Pull 远程前，必须先要进行本地Commit完毕。</p>
<p>右击项目 <code>Git-&gt; Repository -&gt; Push</code> </p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/27kj8f40C5.png?imageslim" alt="mark"></p>
<p>点击<code>Define remote</code> 设置一个远程Git 仓库</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/3DKf3jJehK.png?imageslim" alt="mark"></p>
<p>push成功，然后就上传到gitlab上了</p>
<h3 id="三、本地与gitlab上代码冲突解决"><a href="#三、本地与gitlab上代码冲突解决" class="headerlink" title="三、本地与gitlab上代码冲突解决"></a>三、本地与gitlab上代码冲突解决</h3><p>看这篇文章就好了：<a href="https://blog.csdn.net/jc_zhibaobao/article/details/76339044" target="_blank" rel="noopener">https://blog.csdn.net/jc_zhibaobao/article/details/76339044</a></p>
<p><strong>本文参考：<a href="https://www.cnblogs.com/x54256/p/8183123.html" target="_blank" rel="noopener">文章1</a>，<a href="https://blog.csdn.net/zsq520520/article/details/51004721" target="_blank" rel="noopener">文章2</a></strong></p>
<p>注：<a href="https://blog.csdn.net/u010237107/article/details/50910879" target="_blank" rel="noopener">第一次项目上传</a></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/l4JeDKC8f5.png?imageslim" alt="mark"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/24/gitlab+idea的使用/" data-id="cjmvxla5n00040gje2lbthpux" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Gitlab/">Gitlab</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Gradle+idea配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/11/Gradle+idea配置/" class="article-date">
  <time datetime="2018-09-11T02:28:33.000Z" itemprop="datePublished">2018-09-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/11/Gradle+idea配置/">Gradle+idea的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、Gradle的配置"><a href="#一、Gradle的配置" class="headerlink" title="一、Gradle的配置"></a>一、Gradle的配置</h2><h3 id="1、下载Gradle"><a href="#1、下载Gradle" class="headerlink" title="1、下载Gradle"></a>1、下载Gradle</h3><p><a href="https://gradle.org/releases/" target="_blank" rel="noopener">这里</a>，选择二进制版本。</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/A5179i9J99.png?imageslim" alt="mark"></p>
<h3 id="2、添加环境变量"><a href="#2、添加环境变量" class="headerlink" title="2、添加环境变量"></a>2、添加环境变量</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/iidBgLkDac.png?imageslim" alt="mark"></p>
<p>配置完后，可以打开命令窗口，输入 gradle -v，检查是否配置成功。</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/jAGELF2bbd.png?imageslim" alt="mark"></p>
<h3 id="3、配置Gradle仓库的位置"><a href="#3、配置Gradle仓库的位置" class="headerlink" title="3、配置Gradle仓库的位置"></a>3、配置Gradle仓库的位置</h3><p>file-&gt;other-&gt;settings-&gt;default settings</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/AhKD5ce52d.png?imageslim" alt="mark"></p>
<h2 id="二、创建一个web项目"><a href="#二、创建一个web项目" class="headerlink" title="二、创建一个web项目"></a>二、创建一个web项目</h2><h3 id="1、新建项目"><a href="#1、新建项目" class="headerlink" title="1、新建项目"></a>1、新建项目</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/KlfGF8JfII.png?imageslim" alt="mark"></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/gjGbCKa5Lg.png?imageslim" alt="mark"></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/G24I54ABE4.png?imageslim" alt="mark">项目创建成功</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/i9cC4fig9G.png?imageslim" alt="mark"></p>
<p>需要说明的是，最初创建的项目视图是不完整的，包括webapp文件夹下没有web.xml，我们做以下操作，使得项目的结构符合web 应用项目的层级标准。</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/AmJHKELcA0.png?imageslim" alt="mark"></p>
<h3 id="2、书写项目构建脚本"><a href="#2、书写项目构建脚本" class="headerlink" title="2、书写项目构建脚本"></a>2、书写项目构建脚本</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">group <span class="string">'cn.x5456'</span></span><br><span class="line">version <span class="string">'1.0-SNAPSHOT'</span></span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">'java'</span></span><br><span class="line">apply plugin: <span class="string">'war'</span></span><br><span class="line"></span><br><span class="line">sourceCompatibility = <span class="number">1.8</span></span><br><span class="line"><span class="comment">// 配置仓库</span></span><br><span class="line">repositories &#123;</span><br><span class="line">    maven &#123; url <span class="string">"http://maven.aliyun.com/nexus/content/groups/public/"</span> &#125;</span><br><span class="line">    mavenLocal()</span><br><span class="line">    jcenter()</span><br><span class="line">    maven &#123; url <span class="string">"http://repo.maven.apache.org/maven2/"</span>&#125;</span><br><span class="line">    maven &#123; url <span class="string">'https://repo.spring.io/libs-milestone'</span>&#125;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 配置jar包</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    testCompile group: <span class="string">'junit'</span>, name: <span class="string">'junit'</span>, version: <span class="string">'4.12'</span></span><br><span class="line">    <span class="comment">// servlet-api</span></span><br><span class="line">    compile group: <span class="string">'javax.servlet'</span>, name: <span class="string">'servlet-api'</span>, version: <span class="string">'2.5'</span></span><br><span class="line">    <span class="comment">//spring相关</span></span><br><span class="line">    compile group: <span class="string">'org.springframework'</span>, name: <span class="string">'spring-webmvc'</span>, version: <span class="string">'4.3.3.RELEASE'</span></span><br><span class="line">    compile group: <span class="string">'org.springframework'</span>, name: <span class="string">'spring-orm'</span>, version: <span class="string">'4.3.3.RELEASE'</span></span><br><span class="line">    compile group: <span class="string">'org.springframework'</span>, name: <span class="string">'spring-aspects'</span>, version: <span class="string">'4.3.3.RELEASE'</span></span><br><span class="line">    compile group: <span class="string">'org.springframework.security'</span>, name: <span class="string">'spring-security-config'</span>, version: <span class="string">'3.2.0.RELEASE'</span></span><br><span class="line">    compile group: <span class="string">'org.springframework.security'</span>, name: <span class="string">'spring-security-taglibs'</span>, version: <span class="string">'3.2.0.RELEASE'</span></span><br><span class="line">    compile <span class="string">'org.springframework.security:spring-security-web:3.2.0.RELEASE'</span></span><br><span class="line">    <span class="comment">//hibernate相关</span></span><br><span class="line">    compile <span class="string">'org.hibernate:hibernate-core:4.3.6.Final'</span></span><br><span class="line">    <span class="comment">//c3p0连接池</span></span><br><span class="line">    compile group: <span class="string">'org.hibernate'</span>, name: <span class="string">'hibernate-c3p0'</span>, version: <span class="string">'4.3.6.Final'</span></span><br><span class="line">    <span class="comment">//ehcahe二级缓存</span></span><br><span class="line">    compile group: <span class="string">'org.hibernate'</span>, name: <span class="string">'hibernate-ehcache'</span>, version: <span class="string">'4.3.6.Final'</span></span><br><span class="line">    <span class="comment">//mysql</span></span><br><span class="line">    compile group: <span class="string">'mysql'</span>, name: <span class="string">'mysql-connector-java'</span>, version: <span class="string">'5.1.39'</span></span><br><span class="line">    <span class="comment">//springData</span></span><br><span class="line">    compile group: <span class="string">'org.springframework.data'</span>, name: <span class="string">'spring-data-jpa'</span>, version: <span class="string">'1.10.3.RELEASE'</span></span><br><span class="line">    <span class="comment">// https://mvnrepository.com/artifact/log4j/log4j日志</span></span><br><span class="line">    compile group: <span class="string">'log4j'</span>, name: <span class="string">'log4j'</span>, version: <span class="string">'1.2.17'</span></span><br><span class="line">    <span class="comment">//json解析相关</span></span><br><span class="line">    compile group: <span class="string">'com.fasterxml.jackson.core'</span>, name: <span class="string">'jackson-databind'</span>, version: <span class="string">'2.5.4'</span></span><br><span class="line">    compile group: <span class="string">'com.fasterxml.jackson.core'</span>, name: <span class="string">'jackson-core'</span>, version: <span class="string">'2.5.4'</span></span><br><span class="line">    <span class="comment">//迅雷接口有关jar 包</span></span><br><span class="line">    compile <span class="string">'org.apache.httpcomponents:httpclient:4.4'</span></span><br><span class="line">    compile <span class="string">'org.json:json:20141113'</span></span><br><span class="line">    compile group: <span class="string">'org.apache.clerezza.ext'</span>, name: <span class="string">'org.json.simple'</span>, version: <span class="string">'0.4'</span></span><br><span class="line">    <span class="comment">//https://mvnrepository.com/artifact/org.apache.commons/commons-io 读取文件相关</span></span><br><span class="line">    compile group: <span class="string">'org.apache.commons'</span>, name: <span class="string">'commons-io'</span>, version: <span class="string">'1.3.2'</span></span><br><span class="line">    <span class="comment">// https://mvnrepository.com/artifact/org.apache.poi/poi 文件读取相关 apache-poi</span></span><br><span class="line">    compile group: <span class="string">'org.apache.poi'</span>, name: <span class="string">'poi'</span>, version: <span class="string">'3.9'</span></span><br><span class="line">    <span class="comment">// https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml 解决execl 版本差异</span></span><br><span class="line">    compile group: <span class="string">'org.apache.poi'</span>, name: <span class="string">'poi-ooxml'</span>, version: <span class="string">'3.9'</span></span><br><span class="line">    <span class="comment">// https://mvnrepository.com/artifact/commons-io/commons-io 文件上传</span></span><br><span class="line">    compile group: <span class="string">'commons-io'</span>, name: <span class="string">'commons-io'</span>, version: <span class="string">'1.3.1'</span></span><br><span class="line">    <span class="comment">// https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload</span></span><br><span class="line">    compile group: <span class="string">'commons-fileupload'</span>, name: <span class="string">'commons-fileupload'</span>, version: <span class="string">'1.2.2'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于我们创建项目时选择了自动导入，idea会帮我们自动导入相应jar包</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/cjE0c4dc8c.png?imageslim" alt="mark"></p>
<h3 id="3、Gradle使用Maven仓库"><a href="#3、Gradle使用Maven仓库" class="headerlink" title="3、Gradle使用Maven仓库"></a>3、Gradle使用Maven仓库</h3><p>在build.gradle文件中, 修改repositories如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    mavenLocal()</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的话, 就会==优先从maven的仓库中查找所需的jar包==</p>
<p>还可以使用<code>Alt</code>+<code>Inert</code>，直接添加maven仓库的jar包</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/GKJALbmd7f.png?imageslim" alt="mark"></p>
<h3 id="4、打包等…"><a href="#4、打包等…" class="headerlink" title="4、打包等…"></a>4、打包等…</h3><p>其实我也不会用。。</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/lbG9gkiggK.png?imageslim" alt="mark"></p>
<p>本文参考：<a href="https://www.jianshu.com/p/25039d901ac2" target="_blank" rel="noopener">这里</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/11/Gradle+idea配置/" data-id="cjmvxla5i00010gjevym51vz2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Gradle/">Gradle</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Dubbo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/03/Dubbo/" class="article-date">
  <time datetime="2018-09-03T01:28:33.000Z" itemprop="datePublished">2018-09-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/03/Dubbo/">Dubbo的使用，以及整合springboot</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、分布式基础理论"><a href="#1、分布式基础理论" class="headerlink" title="1、分布式基础理论"></a>1、分布式基础理论</h2><h3 id="1）什么是分布式系统？"><a href="#1）什么是分布式系统？" class="headerlink" title="1）什么是分布式系统？"></a>1）什么是分布式系统？</h3><p>《分布式系统原理与范型》定义：</p>
<blockquote>
<p>“分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统”</p>
</blockquote>
<p>分布式系统（distributed system）是建立在网络之上的软件系统。</p>
<h3 id="2）发展演变"><a href="#2）发展演变" class="headerlink" title="2）发展演变"></a>2）发展演变</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/4AGjHHaeEe.png?imageslim" alt="mark"></p>
<p>随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需<strong>一个治理系统</strong>确保架构有条不紊的演进。 </p>
<p><strong>应用架构</strong> </p>
<ul>
<li>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。</li>
<li>此时，用于简化增删改查工作量的<strong>数据访问框架</strong>(ORM)是关键。</li>
</ul>
<p><strong>垂直应用架构</strong></p>
<ul>
<li>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。</li>
<li>此时，用于加速前端页面开发的<strong>Web框架(MVC)</strong>是关键。</li>
</ul>
<p><strong>分布式服务架构</strong></p>
<ul>
<li>当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。</li>
<li>此时，用于提高业务复用及整合的<strong>分布式服务框架(RPC)</strong>是关键。</li>
</ul>
<p><strong>流动计算架构</strong></p>
<ul>
<li>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。</li>
<li>此时，用于提高机器利用率的<strong>资源调度和治理中心(SOA)</strong>是关键。</li>
</ul>
<p>Dubbo就是<strong>资源调度和治理中心的管理工具</strong>。</p>
<h3 id="3）RPC"><a href="#3）RPC" class="headerlink" title="3）RPC"></a>3）RPC</h3><h4 id="什么叫RPC"><a href="#什么叫RPC" class="headerlink" title="什么叫RPC"></a>什么叫RPC</h4><p>RPC【Remote Procedure Call】是指远程过程调用，是一种进程间通信方式，他是一种技术的思想，而不是规范。它允许程序调用另一个地址空间（通常是共享网络的另一台机器上）的过程或函数，而不用程序员显式编码这个远程调用的细节。即程序员无论是调用本地的还是远程的函数，本质上编写的调用代码基本相同。</p>
<h4 id="RPC基本原理"><a href="#RPC基本原理" class="headerlink" title="RPC基本原理"></a>RPC基本原理</h4><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/FlkLDC7gjf.png?imageslim" alt=""></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/dgmhff7368.png?imageslim" alt="mark"></p>
<p>RPC两个核心模块：通讯，序列化。</p>
<h2 id="2、dubbo核心概念"><a href="#2、dubbo核心概念" class="headerlink" title="2、dubbo核心概念"></a>2、dubbo核心概念</h2><h3 id="1）简介"><a href="#1）简介" class="headerlink" title="1）简介"></a>1）简介</h3><p>Apache Dubbo (incubating) |ˈdʌbəʊ| 是一款高性能、轻量级的开源Java RPC框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。</p>
<p>官网：<a href="http://dubbo.apache.org/" target="_blank" rel="noopener">http://dubbo.apache.org/</a></p>
<h3 id="2）基本架构"><a href="#2）基本架构" class="headerlink" title="2）基本架构"></a>2）基本架构</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/BjHeG2m139.png?imageslim" alt="mark"></p>
<p><strong>服务提供者（Provider</strong>）：暴露服务的服务提供方，服务提供者在启动时，向注册中心注册自己提供的服务。</p>
<p><strong>服务消费者（Consumer</strong>）: 调用远程服务的服务消费方，服务消费者在启动时，向注册中心订阅自己所需的服务，服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</p>
<p><strong>注册中心（Registry</strong>）：注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者</p>
<p><strong>监控中心（Monitor</strong>）：服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心</p>
<h4 id="调用关系说明"><a href="#调用关系说明" class="headerlink" title="调用关系说明"></a>调用关系说明</h4><ul>
<li><p>服务容器负责启动，加载，运行服务提供者。</p>
</li>
<li><p>服务提供者在启动时，向注册中心注册自己提供的服务。</p>
</li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。</li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li>
<li><p>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</p>
</li>
<li><p>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</p>
</li>
</ul>
<h3 id="3）环境的搭建"><a href="#3）环境的搭建" class="headerlink" title="3）环境的搭建"></a>3）环境的搭建</h3><p><a href="https://www.cnblogs.com/x54256/p/8622272.html" target="_blank" rel="noopener">看这</a></p>
<h3 id="4）监控中心"><a href="#4）监控中心" class="headerlink" title="4）监控中心"></a>4）监控中心</h3><h4 id="dubbo-admin"><a href="#dubbo-admin" class="headerlink" title="dubbo-admin"></a>dubbo-admin</h4><p>图形化的服务管理页面；安装时需要指定注册中心地址，即可从注册中心中获取到所有的提供者/消费者进行配置管理</p>
<h4 id="dubbo-monitor-simple"><a href="#dubbo-monitor-simple" class="headerlink" title="dubbo-monitor-simple"></a>dubbo-monitor-simple</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>1、下载 <a href="https://github.com/apache/incubator-dubbo-ops" target="_blank" rel="noopener">dubbo-ops</a></p>
<p>2、修改配置指定注册中心地址</p>
<blockquote>
<p>进入 dubbo-monitor-simple\src\main\resources\conf</p>
<p>修改 dubbo.properties文件</p>
</blockquote>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/gaLB9ai4DC.png?imageslim" alt="mark"></p>
<p>3、打包dubbo-monitor-simple</p>
<blockquote>
<p>mvn clean package -Dmaven.test.skip=true</p>
</blockquote>
<p>4、解压 tar.gz 文件，并运行start.bat</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/J9I5K7cE7e.png?imageslim" alt="mark"></p>
<p>如果缺少servlet-api，自行导入servlet-api再访问监控中心</p>
<p>5、访问8080</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/Fef2GlJ4Kf.png?imageslim" alt="mark"></p>
<h5 id="监控中心配置"><a href="#监控中心配置" class="headerlink" title="监控中心配置"></a>监控中心配置</h5><p>所有服务配置连接监控中心，进行监控统计</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--监控中心协议，如果为protocol="registry"，表示从注册中心发现监控中心地址，否则直连监控中心--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:monitor</span> <span class="attr">protocol</span>=<span class="string">"registry"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:monitor</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Simple Monitor 挂掉不会影响到 Consumer 和 Provider 之间的调用，所以用于生产环境不会有风险。</p>
<p>Simple Monitor 采用磁盘存储统计信息，请注意安装机器的磁盘限制，如果要集群，建议用mount共享磁盘。</p>
</blockquote>
<h3 id="5）整合SpringBoot"><a href="#5）整合SpringBoot" class="headerlink" title="5）整合SpringBoot"></a>5）整合SpringBoot</h3><p>新建3个项目</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/HiKEAF4b34.png?imageslim" alt="mark"></p>
<ul>
<li><strong>boot-dubbo-base</strong>：</li>
</ul>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/39Jk2iDdhE.png?imageslim" alt="mark"></p>
<p>UserAddress.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAddress</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String userAddress; <span class="comment">//用户地址</span></span><br><span class="line">    <span class="keyword">private</span> String userId; <span class="comment">//用户id</span></span><br><span class="line">    <span class="keyword">private</span> String consignee; <span class="comment">//收货人</span></span><br><span class="line">    <span class="keyword">private</span> String phoneNum; <span class="comment">//电话号码</span></span><br><span class="line">    <span class="keyword">private</span> String isDefault; <span class="comment">//是否为默认地址    Y-是     N-否</span></span><br></pre></td></tr></table></figure>
<p>UserService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 按照用户id返回所有的收货地址</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">getUserAddressList</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><h6 id="boot-dubbo-service："><a href="#boot-dubbo-service：" class="headerlink" title="boot-dubbo-service："></a>boot-dubbo-service：</h6></li>
</ul>
<p><img src="C:\Users\x5456\AppData\Local\Temp\1535952686730.png" alt="1535952686730"></p>
<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.stereotype.Service	<span class="comment">// spring的注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">getUserAddressList</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"UserServiceImpl.....old..."</span>);</span><br><span class="line"></span><br><span class="line">		UserAddress address1 = <span class="keyword">new</span> UserAddress(<span class="number">1</span>, <span class="string">"北京市昌平区宏福科技园综合楼3层"</span>, <span class="string">"1"</span>, <span class="string">"李老师"</span>, <span class="string">"010-56253825"</span>, <span class="string">"Y"</span>);</span><br><span class="line">		UserAddress address2 = <span class="keyword">new</span> UserAddress(<span class="number">2</span>, <span class="string">"深圳市宝安区西部硅谷大厦B座3层（深圳分校）"</span>, <span class="string">"1"</span>, <span class="string">"王老师"</span>, <span class="string">"010-56253825"</span>, <span class="string">"N"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> Arrays.asList(address1,address2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><h6 id="boot-dubbo-web"><a href="#boot-dubbo-web" class="headerlink" title="boot-dubbo-web"></a>boot-dubbo-web</h6></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getUserAddressList"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">getUserAddressList</span><span class="params">(@RequestParam(<span class="string">"uid"</span>)</span>String userId) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getUserAddressList(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="方式一："><a href="#方式一：" class="headerlink" title="方式一："></a>方式一：</h4><p>1）导入dubbo-starter依赖（提供者+消费者），此步骤是必须的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意starter版本适配：</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/CfG7CGmhhg.png?imageslim" alt="mark"></p>
<p>2）修改提供者</p>
<p>修改Service</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/09mjaC8AFF.png?imageslim" alt="mark"></p>
<p>修改主启动类</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/j4IdBH7G3c.png?imageslim" alt="mark"></p>
<p>书写application.properties配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 应用名</span><br><span class="line">dubbo.application.name=user-service-provider</span><br><span class="line"># 注册中心地址</span><br><span class="line">dubbo.registry.address=127.0.0.1:2181</span><br><span class="line"># 注册中心协议</span><br><span class="line">dubbo.registry.protocol=zookeeper</span><br><span class="line"># dubbo通信协议</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line"># dubbo暴露的端口</span><br><span class="line">dubbo.protocol.port=20881</span><br><span class="line"># 从注册中心发现监控中心地址</span><br><span class="line">#dubbo.monitor.protocol=registry</span><br></pre></td></tr></table></figure>
<p>3）修改消费者</p>
<p>修改Controller</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/a42LC01A57.png?imageslim" alt="mark"></p>
<p>修改主启动类</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/b3hLBLIf6I.png?imageslim" alt="mark"></p>
<p>书写application.properties配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server.port=8081</span><br><span class="line"></span><br><span class="line">dubbo.application.name=boot-order-service-consumer</span><br><span class="line">dubbo.registry.address=zookeeper://127.0.0.1:2181</span><br><span class="line">#dubbo.monitor.protocol=registry</span><br></pre></td></tr></table></figure>
<h4 id="方式二："><a href="#方式二：" class="headerlink" title="方式二："></a>方式二：</h4><p>保留dubbo xml配置文件;</p>
<p>使用@ImportResource导入dubbo的配置文件即可</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/Dkmk24C4LH.png?imageslim" alt="mark"></p>
<h4 id="方式三："><a href="#方式三：" class="headerlink" title="方式三："></a>方式三：</h4><p>使用注解API的方式，将每一个组件手动创建到容器中,让dubbo来扫描其他的组件</p>
<p>书写配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDubboConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ApplicationConfig <span class="title">applicationConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ApplicationConfig applicationConfig = <span class="keyword">new</span> ApplicationConfig();</span><br><span class="line">		applicationConfig.setName(<span class="string">"boot-user-service-provider"</span>);</span><br><span class="line">		<span class="keyword">return</span> applicationConfig;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//&lt;dubbo:registry protocol="zookeeper" address="127.0.0.1:2181"&gt;</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RegistryConfig <span class="title">registryConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		RegistryConfig registryConfig = <span class="keyword">new</span> RegistryConfig();</span><br><span class="line">		registryConfig.setProtocol(<span class="string">"zookeeper"</span>);</span><br><span class="line">		registryConfig.setAddress(<span class="string">"127.0.0.1:2181"</span>);</span><br><span class="line">		<span class="keyword">return</span> registryConfig;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//&lt;dubbo:protocol name="dubbo" port="20882"&gt;&lt;/dubbo:protocol&gt;</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ProtocolConfig <span class="title">protocolConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ProtocolConfig protocolConfig = <span class="keyword">new</span> ProtocolConfig();</span><br><span class="line">		protocolConfig.setName(<span class="string">"dubbo"</span>);</span><br><span class="line">		protocolConfig.setPort(<span class="number">20882</span>);</span><br><span class="line">		<span class="keyword">return</span> protocolConfig;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *&lt;dubbo:service interface="com.atguigu.gmall.service.UserService" </span></span><br><span class="line"><span class="comment">		ref="userServiceImpl01" timeout="1000" version="1.0.0"&gt;</span></span><br><span class="line"><span class="comment">		&lt;dubbo:method name="getUserAddressList" timeout="1000"&gt;&lt;/dubbo:method&gt;</span></span><br><span class="line"><span class="comment">	&lt;/dubbo:service&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ServiceConfig&lt;UserService&gt; <span class="title">userServiceConfig</span><span class="params">(UserService userService)</span></span>&#123;</span><br><span class="line">		ServiceConfig&lt;UserService&gt; serviceConfig = <span class="keyword">new</span> ServiceConfig&lt;&gt;();</span><br><span class="line">		serviceConfig.setInterface(UserService.class);</span><br><span class="line">		serviceConfig.setRef(userService);</span><br><span class="line">		serviceConfig.setVersion(<span class="string">"1.0.0"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//配置每一个method的信息</span></span><br><span class="line">		MethodConfig methodConfig = <span class="keyword">new</span> MethodConfig();</span><br><span class="line">		methodConfig.setName(<span class="string">"getUserAddressList"</span>);</span><br><span class="line">		methodConfig.setTimeout(<span class="number">1000</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将method的设置关联到service配置中</span></span><br><span class="line">		List&lt;MethodConfig&gt; methods = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		methods.add(methodConfig);</span><br><span class="line">		serviceConfig.setMethods(methods);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//ProviderConfig</span></span><br><span class="line">		<span class="comment">//MonitorConfig</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> serviceConfig;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此种方式要配合dubbo的@Service和@Reference注解，主配置类上要添加注解来扫描包：</p>
<blockquote>
<p>@EnableDubbo(scanBasePackages=”cn.x5456.xxx”)</p>
</blockquote>
<h2 id="3、dubbo配置"><a href="#3、dubbo配置" class="headerlink" title="3、dubbo配置"></a>3、dubbo配置</h2><p><a href="http://dubbo.apache.org/zh-cn/docs/user/demos/" target="_blank" rel="noopener">http://dubbo.apache.org/zh-cn/docs/user/demos/</a></p>
<h3 id="1、配置原则"><a href="#1、配置原则" class="headerlink" title="1、配置原则"></a>1、配置原则</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/Fg6KmaB94F.png?imageslim" alt="mark"></p>
<p>JVM 启动 -D 参数优先，这样可以使用户在部署和启动时进行参数重写，比如在启动时需改变协议的端口。</p>
<p>XML 次之，如果在 XML 中有配置，则 dubbo.properties 中的相应配置项无效。</p>
<p>Properties 最后，相当于缺省值，只有 XML 没有配置时，dubbo.properties 的相应配置项才会生效，通常用于共享公共配置，比如应用名。</p>
<h3 id="2、重试次数"><a href="#2、重试次数" class="headerlink" title="2、重试次数"></a>2、重试次数</h3><p>失败自动切换，当出现失败，重试其它服务器，但重试会带来更长延迟。可通过 retries=”2” 来设置重试次数(不含第一次)。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">重试次数配置如下：</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">retries</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line">或</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">retries</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line">或</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"findFoo"</span> <span class="attr">retries</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3、超时时间"><a href="#3、超时时间" class="headerlink" title="3、超时时间"></a>3、超时时间</h3><p>由于网络或服务端不可靠，会导致调用出现一种不确定的中间状态（超时）。为了避免超时导致客户端资源（线程）挂起耗尽，必须设置超时时间。</p>
<p>消费者配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">全局超时配置</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">timeout</span>=<span class="string">"5000"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">指定接口以及特定方法超时配置</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">timeout</span>=<span class="string">"2000"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"sayHello"</span> <span class="attr">timeout</span>=<span class="string">"3000"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>提供者配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">全局超时配置</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">"5000"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">指定接口以及特定方法超时配置</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">timeout</span>=<span class="string">"2000"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"sayHello"</span> <span class="attr">timeout</span>=<span class="string">"3000"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>dubbo推荐在Provider上尽量多配置Consumer端属性：</p>
<p>1、作服务的提供者，比服务使用方更清楚服务性能参数，如调用的超时时间，合理的重试次数，等等<br>2、在Provider配置后，Consumer不配置则会使用Provider的配置值，即Provider配置可以作为Consumer的缺省值。否则，Consumer会使用Consumer端的全局设置，这对于Provider不可控的，并且往往是不合理的   </p>
<p>配置的覆盖规则：</p>
<p>1) 方法级配置别优于接口级别，即小Scope优先 </p>
<p>2) Consumer端配置 优于 Provider配置 优于 全局配置，</p>
<p>3) 最后是Dubbo Hard Code的配置值（见配置文档）</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/b2a0k87Jcl.png?imageslim" alt="mark"></p>
<h3 id="4、版本号"><a href="#4、版本号" class="headerlink" title="4、版本号"></a>4、版本号</h3><p>当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。</p>
<p>可以按照以下的步骤进行版本迁移：</p>
<p>在低压力时间段，先升级一半提供者为新版本，再将所有消费者升级为新版本，然后将剩下的一半提供者升级为新版本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">老版本服务提供者配置：</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">新版本服务提供者配置：</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">version</span>=<span class="string">"2.0.0"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">老版本服务消费者配置：</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">新版本服务消费者配置：</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">version</span>=<span class="string">"2.0.0"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">如果不需要区分版本，可以按照以下的方式配置：（随机调用不同版本版本）</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">version</span>=<span class="string">"*"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5、本地存根"><a href="#5、本地存根" class="headerlink" title="5、本地存根"></a>5、本地存根</h3><p>远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做 ThreadLocal 缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在 API 中带上 <a href="https://zh.wikipedia.org/wiki/%E6%A1%A9_(%E8%AE%A1%E7%AE%97%E6%9C%BA" target="_blank" rel="noopener">Stub</a>)，客户端生成 Proxy 实例，会把 Proxy 通过构造函数传给 Stub，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。</p>
<p>在 spring 配置文件中按以下方式配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">stub</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">stub</span>=<span class="string">"com.foo.BarServiceStub"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>提供 Stub 的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foo;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarServiceStub</span> <span class="keyword">implements</span> <span class="title">BarService</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BarService barService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造函数传入真正的远程代理对象</span></span><br><span class="line">    <span class="keyword">public</span> (BarService barService) &#123;</span><br><span class="line">        <span class="keyword">this</span>.barService = barService;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 此代码在客户端执行, 你可以在客户端做ThreadLocal本地缓存，或预先验证参数是否合法，等等</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> barService.sayHello(name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 你可以容错，可以做任何AOP拦截事项</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"容错数据"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Stub 必须有可传入 Proxy 的构造函数。</li>
<li>在 interface 旁边放一个 Stub 实现，它实现 BarService 接口，并有一个传入远程 BarService 实例的构造函数。</li>
</ol>
<h2 id="4、高可用"><a href="#4、高可用" class="headerlink" title="4、高可用"></a>4、高可用</h2><h3 id="1、zookeeper宕机与dubbo直连"><a href="#1、zookeeper宕机与dubbo直连" class="headerlink" title="1、zookeeper宕机与dubbo直连"></a>1、zookeeper宕机与dubbo直连</h3><p>现象：zookeeper注册中心宕机，还可以消费dubbo暴露的服务。</p>
<p>原因：</p>
<ul>
<li>监控中心宕掉不影响使用，只是丢失部分采样数据</li>
<li>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</li>
<li>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</li>
<li><strong>注册中心全部宕掉后，服务提供者和服务消费者仍能通过==本地缓存==通讯</strong></li>
<li>服务提供者无状态，任意一台宕掉后，不影响使用</li>
<li>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</li>
</ul>
<p>没有注册中心，可不可以实现服务间的调用？</p>
<p>答：可以，使用Dubbo直连</p>
<p><img src="C:\Users\x5456\AppData\Local\Temp\1535957524273.png" alt="1535957524273"></p>
<h3 id="2、集群下dubbo负载均衡配置"><a href="#2、集群下dubbo负载均衡配置" class="headerlink" title="2、集群下dubbo负载均衡配置"></a>2、集群下dubbo负载均衡配置</h3><p>在集群负载均衡时，Dubbo 提供了多种均衡策略，缺省为 random 随机调用。</p>
<p>负载均衡策略</p>
<p><strong>Random LoadBalance</strong>（默认）<br>随机，按权重设置随机概率。<br>在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。<br><strong>RoundRobin LoadBalance</strong><br>轮循，按公约后的权重设置轮循比率。<br>存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。<br><strong>LeastActive LoadBalance</strong><br>最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差。<br>使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。<br><strong>ConsistentHash LoadBalance</strong><br>一致性 Hash，相同参数的请求总是发到同一提供者。<br>当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。算法参见：<a href="http://en.wikipedia.org/wiki/Consistent_hashing" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Consistent_hashing</a><br>缺省只对第一个参数 Hash，如果要修改，请配置 &lt;dubbo:parameter key=”hash.arguments” value=”0,1” /&gt;<br>缺省用 160 份虚拟节点，如果要修改，请配置 &lt;dubbo:parameter key=”hash.nodes” value=”320” /&gt;</p>
<h3 id="3、整合hystrix"><a href="#3、整合hystrix" class="headerlink" title="3、整合hystrix"></a>3、整合hystrix</h3><p>dubbo有两种服务容错的解决方案：</p>
<ul>
<li>不进行远程调用，直接返回空对象</li>
<li>进行远程调用，失败返回空对象</li>
</ul>
<p>Hystrix 旨在通过控制那些访问远程系统、服务和第三方库的节点，从而对延迟和故障提供更强大的容错能力。Hystrix具备拥有回退机制和断路器功能的线程和信号隔离，请求缓存和请求打包，以及监控和配置等功能</p>
<h4 id="1、配置spring-cloud-starter-netflix-hystrix"><a href="#1、配置spring-cloud-starter-netflix-hystrix" class="headerlink" title="1、配置spring-cloud-starter-netflix-hystrix"></a>1、配置spring-cloud-starter-netflix-hystrix</h4><p>spring boot官方提供了对hystrix的集成，直接在pom.xml里加入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在Application类上增加@EnableHystrix来启用hystrix starter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderApplication</span> </span>&#123;</span><br></pre></td></tr></table></figure>
<h4 id="2、配置Provider端"><a href="#2、配置Provider端" class="headerlink" title="2、配置Provider端"></a>2、配置Provider端</h4><p>在Dubbo的Provider上增加@HystrixCommand配置，这样子调用就会经过Hystrix代理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(version = <span class="string">"1.0.0"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServiceImpl</span> <span class="keyword">implements</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@HystrixCommand</span>(commandProperties = &#123;</span><br><span class="line">     <span class="meta">@HystrixProperty</span>(name = <span class="string">"circuitBreaker.requestVolumeThreshold"</span>, value = <span class="string">"10"</span>),</span><br><span class="line">     <span class="meta">@HystrixProperty</span>(name = <span class="string">"execution.isolation.thread.timeoutInMilliseconds"</span>, value = <span class="string">"2000"</span>) &#125;)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// System.out.println("async provider received: " + name);</span></span><br><span class="line">        <span class="comment">// return "annotation: hello, " + name;</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Exception to show hystrix enabled."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、配置Consumer端"><a href="#3、配置Consumer端" class="headerlink" title="3、配置Consumer端"></a>3、配置Consumer端</h3><p>对于Consumer端，则可以增加一层method调用，并在method上配置@HystrixCommand。当调用出错时，会走到fallbackMethod = “reliable”的调用里。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference</span></span><br><span class="line"><span class="keyword">private</span> HelloService demoService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"reliable"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">doSayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> demoService.sayHello(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reliable</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hystrix fallback value"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/09/03/Dubbo/" data-id="cjmvxlahg000i0gjeqeyqng7b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dubbo/">dubbo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS7下安装Oracle" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/23/CentOS7下安装Oracle/" class="article-date">
  <time datetime="2018-08-23T01:28:33.000Z" itemprop="datePublished">2018-08-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/23/CentOS7下安装Oracle/">CentOS7下安装Oracle</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-安装Docker"><a href="#1-安装Docker" class="headerlink" title="1/安装Docker"></a>1/安装Docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> step 1: 安装必要的一些系统工具</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta">#</span> Step 2: 添加软件源信息</span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span> Step 3: 更新并安装 Docker-CE</span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"><span class="meta">#</span> Step 4: 开启Docker服务</span><br><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure>
<h3 id="2-配置镜像加速器"><a href="#2-配置镜像加速器" class="headerlink" title="2/配置镜像加速器"></a>2/配置镜像加速器</h3><p>访问<a href="https://cr.console.aliyun.com/cn-hangzhou/mirrors" target="_blank" rel="noopener">网址</a>获取个人的加速器地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span><br><span class="line">&#123;</span><br><span class="line">  "registry-mirrors": ["https://l7s5cnt9.mirror.aliyuncs.com"]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h3 id="3-下载镜像"><a href="#3-下载镜像" class="headerlink" title="3/下载镜像"></a>3/下载镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull filemon/oracle_11g</span><br></pre></td></tr></table></figure>
<h3 id="4-启动镜像"><a href="#4-启动镜像" class="headerlink" title="4/启动镜像"></a>4/启动镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 直接启动，没做映射</span><br><span class="line"><span class="meta">$</span> sudo docker run -d -p 11521:1521 -p 10022:22 --name=oracle11g filemon/oracle_11g</span><br></pre></td></tr></table></figure>
<h3 id="5-对容器进行一系列的操作"><a href="#5-对容器进行一系列的操作" class="headerlink" title="5/对容器进行一系列的操作"></a>5/对容器进行一系列的操作</h3><p>1）进入容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker exec -it 容器ID /bin/bash</span><br></pre></td></tr></table></figure>
<p>2）配置系统环境变量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> vi ~/.bash_profile</span><br><span class="line"></span><br><span class="line">export ORACLE_SID=orcl</span><br><span class="line">export ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_2</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>3）加载环境变量 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /home/oracle/.bash_profile</span><br></pre></td></tr></table></figure>
<p>4）登陆</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 无账号登陆</span></span><br><span class="line">sqlplus /nolog</span><br><span class="line">connect /as sysdba</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置sys和system的密码</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="keyword">sys</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">"sys"</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="keyword">system</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">"sys"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 本地远程连接</span></span><br><span class="line">sqlplus <span class="keyword">sys</span>/<span class="keyword">sys</span>@<span class="number">52.83</span><span class="number">.134</span><span class="number">.236</span>:<span class="number">1521</span>/orcl <span class="keyword">as</span> <span class="keyword">sysdba</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>实例名(SID )</th>
<th>orcl</th>
</tr>
</thead>
<tbody>
<tr>
<td>管理员帐号</td>
<td>sys/sys</td>
</tr>
<tr>
<td>字符集</td>
<td>utf-8</td>
</tr>
<tr>
<td>端口</td>
<td>1521</td>
</tr>
</tbody>
</table>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: failed to copy files: copy file range failed: no space left on device.</span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line"><span class="meta">#</span> docker volume rm $(docker volume ls -qf dangling=true)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/08/23/CentOS7下安装Oracle/" data-id="cjmvxla5d00000gjenyf3obji" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Docker学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/21/Docker学习/" class="article-date">
  <time datetime="2018-08-21T01:28:33.000Z" itemprop="datePublished">2018-08-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/21/Docker学习/">Docker入门使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、Docker简介"><a href="#一、Docker简介" class="headerlink" title="一、Docker简介"></a>一、Docker简介</h1><p>由于在项目部署的时候经常会出现在本机上运行是好使的，但是部署到服务器上时出现各种问题，而这种问题的原因经常是因为环境的问题，所以Docker出现了。</p>
<p>Docker 是基于Go语言实现的开源项目。</p>
<p>Docker是在Linux容器技术的基础上发展出来的。我们可以将应用运行在Docker容器上，而Docker容器在任何操作系统上都是一致的。</p>
<p>Docker主要通过对应用组件的封装、分发、部署、运行等进行管理，来实现用户的app及其运行环境能够做到<strong>一次封装，到处运行</strong>。</p>
<h1 id="二、Docker的安装"><a href="#二、Docker的安装" class="headerlink" title="二、Docker的安装"></a>二、Docker的安装</h1><h2 id="1、Ubuntu安装Docker"><a href="#1、Ubuntu安装Docker" class="headerlink" title="1、Ubuntu安装Docker"></a>1、Ubuntu安装Docker</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo apt install docker.io</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> sudo systemctl start docker</span><br><span class="line"><span class="meta">$</span> sudo systemctl enable docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 查看是否安装成功</span><br><span class="line"><span class="meta">$</span> docker -v</span><br><span class="line"><span class="meta">&gt;</span>&gt; Docker version 17.12.1-ce, build 7390fc6</span><br></pre></td></tr></table></figure>
<h2 id="2、配置阿里云镜像加速"><a href="#2、配置阿里云镜像加速" class="headerlink" title="2、配置阿里云镜像加速"></a>2、配置阿里云镜像加速</h2><p>1）访问<a href="https://cr.console.aliyun.com/cn-hangzhou/mirrors" target="_blank" rel="noopener">网址</a>获取个人的加速器地址</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/B9eLLEbak7.png?imageslim" alt=""></p>
<p>2）按照下面的操作文档进行操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span><br><span class="line">&#123;</span><br><span class="line">  "registry-mirrors": ["https://l7s5cnt9.mirror.aliyuncs.com"]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h2 id="3、hello，world"><a href="#3、hello，world" class="headerlink" title="3、hello，world"></a>3、hello，world</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 非管理员用户要加sudo</span><br><span class="line"><span class="meta">$</span> sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\x5456\AppData\Local\Temp\1533623675145.png" alt="1533623675145"></p>
<h2 id="4、Docker是怎么工作的"><a href="#4、Docker是怎么工作的" class="headerlink" title="4、Docker是怎么工作的"></a>4、Docker是怎么工作的</h2><pre><code>Docker是一个CS结构的系统，Docker的守护进程运行在主机上，客户端通过socket连接与守护进程进行传输命令，守护进程接受命令并管理运行在主机上的容器。

一个主机上可能有多个容器，每个中运行着镜像（tomcat、mysql...）的实例。
</code></pre><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/Hb4FkGjDKB.png?imageslim" alt=""> </p>
<h2 id="5、Docker为什么比虚拟机快"><a href="#5、Docker为什么比虚拟机快" class="headerlink" title="5、Docker为什么比虚拟机快"></a>5、Docker为什么比虚拟机快</h2><p><a href="https://www.cnblogs.com/doublegi/p/5923898.html" target="_blank" rel="noopener">详情请见</a></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/ECIIdefiGA.png?imageslim" alt=""></p>
<p>（1）由上图可以看出Docker比虚拟机少了抽象层Hypervisor，Docker不需要Hypervisor来实现硬件资源虚拟化，而是直接采用宿主的硬件资源。</p>
<p>（2）而且Docker采用的是宿主机的内核，所以新建一个容器时不需要像虚拟机那样重新加载操作系统内核，从而避免引导、加载系统内核这个耗时的操作。</p>
<h1 id="三、常用命令"><a href="#三、常用命令" class="headerlink" title="三、常用命令"></a>三、常用命令</h1><h2 id="1、帮助命令"><a href="#1、帮助命令" class="headerlink" title="1、帮助命令"></a>1、帮助命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker --help</span><br></pre></td></tr></table></figure>
<h2 id="2、镜像命令"><a href="#2、镜像命令" class="headerlink" title="2、镜像命令"></a>2、镜像命令</h2><h3 id="1）查看本地主机中的所有镜像"><a href="#1）查看本地主机中的所有镜像" class="headerlink" title="1）查看本地主机中的所有镜像"></a>1）查看本地主机中的所有镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker images</span><br><span class="line"></span><br><span class="line">	Option：</span><br><span class="line">	  -a:列出本地所有镜像（包括中间映像层）**</span><br><span class="line">	  -q:只显示镜像id**</span><br><span class="line">	  --digests:显示镜像完整的描述信息</span><br><span class="line">	  --no-trunc：不截断输出</span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\x5456\AppData\Local\Temp\1533634161051.png" alt="1533634161051"></p>
<p>同一个仓库源可以有多个tag，代表这个仓库源的不同版本，所以我们使用REPOSITORY:TAG来定义不同的镜像。</p>
<h3 id="2）从hub上查找镜像"><a href="#2）从hub上查找镜像" class="headerlink" title="2）从hub上查找镜像"></a>2）从hub上查找镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker search 查找镜像名</span><br><span class="line">	</span><br><span class="line">	Option：</span><br><span class="line">	   --no-trunc：不截断输出</span><br><span class="line">	   -s 数字：列出星星不小于指定值的镜像</span><br><span class="line">	   --automated：列出自动构建类型的镜像</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/La6fkGi2Jl.png?imageslim" alt=""></p>
<h3 id="3）下载镜像"><a href="#3）下载镜像" class="headerlink" title="3）下载镜像"></a>3）下载镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 版本号默认为lastest，最新版本</span><br><span class="line"><span class="meta">$</span> sudo docker pull 下载的镜像名:[版本号]</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/e6KEcJc1E5.png?imageslim" alt=""></p>
<h3 id="4）删除镜像"><a href="#4）删除镜像" class="headerlink" title="4）删除镜像"></a>4）删除镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker rmi 某个镜像的id</span><br><span class="line">	</span><br><span class="line"><span class="meta">	#</span> 强制删除，当镜像被某个容器使用时，无法被删除</span><br><span class="line"><span class="meta">	$</span> sudo docker rmi -f 某个镜像的id</span><br><span class="line"><span class="meta">	#</span> 删除多个镜像</span><br><span class="line"><span class="meta">	$</span> sudo docker rmi 镜像id1 镜像id2...</span><br><span class="line"><span class="meta">	#</span> 删除全部镜像</span><br><span class="line"><span class="meta">	$</span> sudo docker rmi -f $(docker images -qa)	# 查出本机所有镜像的id</span><br></pre></td></tr></table></figure>
<h2 id="3、容器命令"><a href="#3、容器命令" class="headerlink" title="3、容器命令"></a>3、容器命令</h2><h3 id="1）新建并启动容器"><a href="#1）新建并启动容器" class="headerlink" title="1）新建并启动容器"></a>1）新建并启动容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker run 镜像id</span><br><span class="line">	</span><br><span class="line">	Option：</span><br><span class="line">		--name="想要给容器起的名字"：设置容器名（可以不用写，会自动生成）</span><br><span class="line">		-d：在后台运行容器，也称守护式容器**</span><br><span class="line">		-i：以交互式运行容器，通常与-t同时使用**</span><br><span class="line">		-t：为容器分配一个伪终端，常与-i同时使用**</span><br><span class="line">		-P：随机端口映射</span><br><span class="line">		-p：指定端口映射，主要有以下4种格式</span><br><span class="line">			ip:hostPort:containerPort</span><br><span class="line">			ip::containerPort</span><br><span class="line">			hostPort:containerPort**</span><br><span class="line">			containerPort</span><br></pre></td></tr></table></figure>
<p><strong>启动交互式容器</strong></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/djHmH29c4C.png?imageslim" alt=""></p>
<h3 id="2）列出Docker中有哪些容器在运行"><a href="#2）列出Docker中有哪些容器在运行" class="headerlink" title="2）列出Docker中有哪些容器在运行"></a>2）列出Docker中有哪些容器在运行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker ps</span><br><span class="line"></span><br><span class="line">	Option:</span><br><span class="line">		-a：列出所有运行的容器（正在运行+历史运行）</span><br><span class="line">		-l：显示最近创建的容器</span><br><span class="line">		-n 数字：显示指定数字创建的容器</span><br><span class="line">		-q：静默模式，只显示容器编号**</span><br><span class="line">		--no-trunc：不截断输出</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/i7l8cd61d2.png?imageslim" alt=""></p>
<h3 id="3）退出交互式容器"><a href="#3）退出交互式容器" class="headerlink" title="3）退出交互式容器"></a>3）退出交互式容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 容器停止退出</span><br><span class="line">exit</span><br><span class="line"><span class="meta">#</span> 容器不停止退出</span><br><span class="line">Ctrl+P+Q</span><br></pre></td></tr></table></figure>
<h3 id="4）其他操作"><a href="#4）其他操作" class="headerlink" title="4）其他操作"></a>4）其他操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 启动容器，将已经停止的容器启动</span><br><span class="line"><span class="meta">$</span> sudo docker start 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 重启容器</span><br><span class="line"><span class="meta">$</span> sudo docker restart 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 停止容器</span><br><span class="line"><span class="meta">$</span> sudo docker stop 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 强制停止容器</span><br><span class="line"><span class="meta">$</span> sudo docker kill 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 删除已经停止的容器</span><br><span class="line"><span class="meta">$</span> sudo docker rm 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 强制删除所有容器（不管是否停止）</span><br><span class="line"><span class="meta">$</span> sudo docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta">$</span> sudo docker ps -aq | xargs docker rm</span><br></pre></td></tr></table></figure>
<h3 id="5）守护式启动"><a href="#5）守护式启动" class="headerlink" title="5）守护式启动"></a>5）守护式启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 上面说过了，使用-d命令启动，下面介绍注意点</span><br><span class="line"><span class="meta">$</span> sudo docker run -d 镜像id</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/eecmlmI3ci.png?imageslim" alt=""></p>
<p>由上图发现，我们运行的容器已经退出。</p>
<p>这个是Docker机制的问题，由于我们启动的容器中没有前台进程，而是以后台进程的形式运行的，Docker就会以为它没事干，于是就将其杀死。</p>
<p>解决方案：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.如果本地镜像只有一个版本，可以直接使用仓库源的名字</span><br><span class="line"><span class="meta">#</span> 2.这句命令的含义是：运行一个容器，使用/bin/sh执行后面的shell脚本</span><br><span class="line"><span class="meta">$</span> sudo docker run -d centos /bin/sh -c "while true;do echo hello x5456;sleep 2;done"</span><br></pre></td></tr></table></figure>
<h3 id="6）查看容器日志"><a href="#6）查看容器日志" class="headerlink" title="6）查看容器日志"></a>6）查看容器日志</h3><p>查看容器内运行的进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker logs 容器编号</span><br><span class="line"></span><br><span class="line">	Option：</span><br><span class="line">		-t：加入时间戳</span><br><span class="line">		-f：跟随最新的日志打印</span><br><span class="line">		--tail 数字：显示指定数字内些条</span><br></pre></td></tr></table></figure>
<h3 id="7）查看容器内部细节"><a href="#7）查看容器内部细节" class="headerlink" title="7）查看容器内部细节"></a>7）查看容器内部细节</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 以json格式进行显示</span><br><span class="line"><span class="meta">$</span> sudo docker inspect 容器id</span><br></pre></td></tr></table></figure>
<h3 id="8）进入正在运行的容器并以命令行交互"><a href="#8）进入正在运行的容器并以命令行交互" class="headerlink" title="8）进入正在运行的容器并以命令行交互"></a>8）进入正在运行的容器并以命令行交互</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 容器中启动新的终端并执行命令，返回</span><br><span class="line"><span class="meta">#</span> 如果不写后面的shell脚本，则会启动新的终端</span><br><span class="line"><span class="meta">$</span> sudo docker exec -it 容器id shell脚本</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 直接进入容器，不启动新的终端</span><br><span class="line"><span class="meta">$</span> sudo docker attach 容器id</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/k7heBK7FLl.png?imageslim" alt=""></p>
<h3 id="9）拷贝容器中的文件到本地"><a href="#9）拷贝容器中的文件到本地" class="headerlink" title="9）拷贝容器中的文件到本地"></a>9）拷贝容器中的文件到本地</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker cp 容器id:容器中文件的位置 要copy到本地的位置</span><br></pre></td></tr></table></figure>
<h2 id="四、Docker镜像"><a href="#四、Docker镜像" class="headerlink" title="四、Docker镜像"></a>四、Docker镜像</h2><pre><code>镜像是一种轻量级、可执行的独立软件包，**用来打包软件运行环境和机基于运行环境开发的软件**，它包括某个软件所需要的所有内容（代码、库、环境变量、配置文件...）
</code></pre><h3 id="1、UnionFS联合文件系统"><a href="#1、UnionFS联合文件系统" class="headerlink" title="1、UnionFS联合文件系统"></a>1、UnionFS联合文件系统</h3><pre><code>联合文件系统是一种分层、轻量级、高性能的文件系统，它可以一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。

Docker的镜像基于UnionFS，也是由一层一层的文件系统组成。

就像我们拉镜像的时候，实际上下载了多层。
</code></pre><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/GHJGe0Akd6.png?imageslim" alt=""></p>
<h4 id="为啥tomcat会辣么大？？"><a href="#为啥tomcat会辣么大？？" class="headerlink" title="为啥tomcat会辣么大？？"></a>为啥tomcat会辣么大？？</h4><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/51KegbA3lg.png?imageslim" alt="mark"></p>
<h4 id="采用这种分层结构的好处"><a href="#采用这种分层结构的好处" class="headerlink" title="采用这种分层结构的好处"></a>采用这种分层结构的好处</h4><ul>
<li>最大的一个好处就是——共享资源</li>
</ul>
<p>比如：有多个进行都是从相同的A镜像构建而来，那么宿主机只需要在磁盘上保存一份A镜像，内存中只需要加载一份A镜像，就可以为所有容器服务了。</p>
<h3 id="2、生成镜像Demo"><a href="#2、生成镜像Demo" class="headerlink" title="2、生成镜像Demo"></a>2、生成镜像Demo</h3><p>1.从Hub上下载tomcat镜像到本地并运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>                 对外暴露端口 内部使用端口</span><br><span class="line"><span class="meta">$</span> sudo docker run -it -p 8888:8080 tomcat</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/dhjE49Ea8j.png?imageslim" alt="mark"></p>
<p>2.故意删除tomcat容器的文档</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/DaC3FAbIBD.png?imageslim" alt="mark"></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/f6DF25cl6K.png?imageslim" alt="mark"></p>
<p>3.以当前运行的tomcat作为模板，提交生成新的镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker commit -a="作者" -m="描述信息" 容器id 要创建的镜像名:[标签名]</span><br><span class="line"><span class="meta">#</span> eg.</span><br><span class="line"><span class="meta">$</span> sudo docker commit -a="x5456" -m="del tomcat docs" 70c6fc38df47 x5456/tomcat:2.0</span><br></pre></td></tr></table></figure>
<p>4.启动我们生成的镜像</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/CdH72b0abd.png?imageslim" alt="mark"></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/f6DF25cl6K.png?imageslim" alt="mark"></p>
<h2 id="五、Docker的数据管理"><a href="#五、Docker的数据管理" class="headerlink" title="五、Docker的数据管理"></a>五、Docker的数据管理</h2><p>部分参考于：<a href="https://www.cnblogs.com/wade-luffy/p/6542539.html" target="_blank" rel="noopener">这里</a></p>
<p>生产环境中使用Docker的过程中，容器中会产生数据，如果不通过commit命令生成一个新的镜像，当容器删除后，其中数据就没有了，所以我们往往需要<strong>对数据进行持久化</strong>，或者需要在<strong>多个容器之间进行数据共享</strong>，这必然涉及容器的数据管理操作。</p>
<p>容器中管理数据主要有两种方式：</p>
<ol>
<li>数据卷（Data Volumes）：<strong>容器内数据直接映射到本地主机环境</strong>；如何在容器内创建数据卷，并且把本地的目录或文件挂载到容器内的数据卷中。</li>
<li>数据卷容器（Data Volume Containers）：使用特定容器维护数据卷。如何<strong>使用数据卷容器在容器和主机、容器和容器之间共享数据</strong>，并实现数据的备份和恢复。</li>
</ol>
<h3 id="1、数据卷"><a href="#1、数据卷" class="headerlink" title="1、数据卷"></a>1、数据卷</h3><h4 id="1）使用命令添加"><a href="#1）使用命令添加" class="headerlink" title="1）使用命令添加"></a>1）使用命令添加</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker run -v 宿主机绝对路径:容器内目录 镜像id/镜像名</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 这样宿主机和容器中的这两个目录就联系起来了</span><br><span class="line"><span class="meta">$</span> sudo docker run -v /myData:/ContainerData centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 可以在目录后面加上:ro表示只读，这样有:ro的内个目录就只有read权限</span><br><span class="line"><span class="meta">$</span> sudo docker run -v /myData:/ContainerData:ro centos</span><br></pre></td></tr></table></figure>
<h4 id="2）采用DockerFile进行添加"><a href="#2）采用DockerFile进行添加" class="headerlink" title="2）采用DockerFile进行添加"></a>2）采用DockerFile进行添加</h4><p>1.书写DockerFile文件dockerfile2</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">VOLUME ["/dataVolumeContainer1","/dataVolumeContainer2"]</span><br><span class="line">CMD echo "finished,--------success1"</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>
<p>2.使用命令生成镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker build -f dockerfile2 -t x5456/centos .</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/EFaj80cigI.png?imageslim" alt="mark"></p>
<p>3.由于我们上面命令没有指定宿主机的位置，所以我们需要查看容器详细信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker inspect 724f7b7a9793</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/bbeh4KiJ8H.png?imageslim" alt="mark"></p>
<h3 id="2、数据卷容器"><a href="#2、数据卷容器" class="headerlink" title="2、数据卷容器"></a>2、数据卷容器</h3><pre><code>如果用户需要在**多个容器之间共享一些持续更新的数据**，最简单的方式是使用数据卷容器。数据卷容器也是一个容器，但是它的目的是专门用来提供数据卷供其他容器挂载。
</code></pre><p>1.创建一个数据卷容器dbdata，并在其中创建一个数据卷挂载到/dbdata：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker run -it -v /dbdata --name dbdata centos</span><br><span class="line">root@3ed94f279b6f:/#</span><br></pre></td></tr></table></figure>
<p>2.查看/dbdata目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@3ed94f279b6f:/# ls</span><br><span class="line"></span><br><span class="line">bin  boot  **dbdata**  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></table></figure>
<p>3.在其他容器中使用–volumes-from来挂载dbdata容器中的数据卷.</p>
<p>例如创建db1和db2两个容器，并从dbdata容器挂载数据卷：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker run -it --volumes-from dbdata --name db1 ubuntu</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> docker run -it --volumes-from dbdata --name db2 ubuntu</span><br></pre></td></tr></table></figure>
<p>此时，容器db1和db2都挂载同一个数据卷到相同的/dbdata目录。三个容器任何一方在该目录下的写入，其他容器都可以看到。</p>
<p>例如，在dbdata容器中创建一个test文件，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@3ed94f279b6f:/# cd /dbdata</span><br><span class="line"></span><br><span class="line">root@3ed94f279b6f:/dbdata# touch test</span><br><span class="line"></span><br><span class="line">root@3ed94f279b6f:/dbdata# ls</span><br><span class="line"></span><br><span class="line">test</span><br></pre></td></tr></table></figure>
<p>在db1容器内查看它：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker run -it --volumes-from dbdata --name db1  ubuntu</span><br><span class="line"></span><br><span class="line">root@4128d2d804b4:/# ls</span><br><span class="line">bin  boot  dbdata  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line">root@4128d2d804b4:/# ls dbdata/</span><br><span class="line">test</span><br></pre></td></tr></table></figure>
<p>4.<strong>数据卷的生命周期一直会持续到没有容器使用他时</strong></p>
<h2 id="六、Dockerfile"><a href="#六、Dockerfile" class="headerlink" title="六、Dockerfile"></a>六、Dockerfile</h2><p>Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p>
<h3 id="1、Dockerfile基础知识："><a href="#1、Dockerfile基础知识：" class="headerlink" title="1、Dockerfile基础知识："></a>1、Dockerfile基础知识：</h3><p>1）每条保留字指令都必须是大写字母且后面要跟随至少一个参数</p>
<p>2）指令从上到下顺序执行</p>
<p>3）#表示注释</p>
<p>4）<strong>==每条指令都会创建一个新的镜像层，并对镜像进行提交==</strong></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/2DI3gCkELD.png?imageslim" alt=""></p>
<h3 id="2、Docker执行Dockerfile的流程"><a href="#2、Docker执行Dockerfile的流程" class="headerlink" title="2、Docker执行Dockerfile的流程"></a>2、Docker执行Dockerfile的流程</h3><p>1）Docker从基础镜像运行一个容器</p>
<p>2）执行一条指令就对容器进行修改</p>
<p>3）执行完一条指令就使用类似docker commit的操作提交一个新的==<strong>镜像层</strong>==</p>
<p>4）docker再基于刚刚提交的==<strong>镜像</strong>==运行一个新容器</p>
<ul>
<li>由于镜像是由多个镜像层组成的，所以提交一个镜像层 &lt;==&gt; 生成了一个新镜像</li>
</ul>
<p>5）继续执行下一条指令，直到所有指令都执行完毕</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/6elIAjK31A.png?imageslim" alt="mark"></p>
<p>从应用软件的角度上来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段</p>
<ul>
<li>Dockerfile：软件原材料，面向开发<ul>
<li>Docker镜像：软件的交付品</li>
<li>Docker容器：软件运行状态</li>
</ul>
</li>
</ul>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/Gf64bBGCc1.png?imageslim" alt="mark"></p>
<h3 id="3、Dockerfile的保留字指令"><a href="#3、Dockerfile的保留字指令" class="headerlink" title="3、Dockerfile的保留字指令"></a>3、Dockerfile的保留字指令</h3><h4 id="1）FROM"><a href="#1）FROM" class="headerlink" title="1）FROM"></a>1）FROM</h4><p>基础镜像，当前镜像是基于哪个镜像的</p>
<h4 id="2）MAINTAINER"><a href="#2）MAINTAINER" class="headerlink" title="2）MAINTAINER"></a>2）MAINTAINER</h4><p>镜像维护者的姓名和邮箱地址</p>
<h4 id="3）RUN"><a href="#3）RUN" class="headerlink" title="3）RUN"></a>3）RUN</h4><p>容器构建时需要运行的命令</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/hGEDAKL4m9.png?imageslim" alt="mark"></p>
<h4 id="4）EXPOSE"><a href="#4）EXPOSE" class="headerlink" title="4）EXPOSE"></a>4）EXPOSE</h4><p> 容器对外暴露的端口</p>
<h4 id="5）WORKDIR"><a href="#5）WORKDIR" class="headerlink" title="5）WORKDIR"></a>5）WORKDIR</h4><p>指定创建容器后，终端默认登陆进来的工作目录</p>
<h4 id="6）ENV"><a href="#6）ENV" class="headerlink" title="6）ENV"></a>6）ENV</h4><p>在构建镜像过程中设置环境变量</p>
<p>eg：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明一个环境变量，这个变量可以在后续的任何指令中使用</span></span><br><span class="line"><span class="keyword">ENV</span> MY_PATH /usr/test</span><br><span class="line"><span class="comment"># 比如设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span>	$MY_PATH</span><br></pre></td></tr></table></figure>
<h4 id="7）ADD"><a href="#7）ADD" class="headerlink" title="7）ADD"></a>7）ADD</h4><p>将宿主机目录下的文件copy进镜像，而且ADD命令会自动处理URL和解压压缩包</p>
<h4 id="8）COPY"><a href="#8）COPY" class="headerlink" title="8）COPY"></a>8）COPY</h4><p>将文件copy到镜像中</p>
<h4 id="9）VOLUME"><a href="#9）VOLUME" class="headerlink" title="9）VOLUME"></a>9）VOLUME</h4><p>容器数据卷，用于数据的保存和持久化工作</p>
<h4 id="10）CMD"><a href="#10）CMD" class="headerlink" title="10）CMD"></a>10）CMD</h4><p>指定容器启动时要运行的命令</p>
<ul>
<li>Dockerfile中可以<strong>有多个CMD指令，但只有最后一个生效</strong>，CMD会被docker run之后的参数==替换==<ul>
<li>类似docker run /bin/sh xxx这种</li>
</ul>
</li>
</ul>
<h4 id="11）ENTRYPOINT"><a href="#11）ENTRYPOINT" class="headerlink" title="11）ENTRYPOINT"></a>11）ENTRYPOINT</h4><p>指定容器启动时要运行的命令</p>
<ul>
<li>ENTRYPOINT会==追加==docker run之后的参数</li>
</ul>
<h4 id="12）ONBUILD"><a href="#12）ONBUILD" class="headerlink" title="12）ONBUILD"></a>12）ONBUILD</h4><p>当构建一个被继承的Dockerfile时运行的命令，父镜像在被子镜像继承后触发这个命令</p>
<h2 id="七、将镜像发布到阿里云上"><a href="#七、将镜像发布到阿里云上" class="headerlink" title="七、将镜像发布到阿里云上"></a>七、将镜像发布到阿里云上</h2><p>1.创建镜像仓库</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/ji2EFFIFBk.png?imageslim" alt="mark"></p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/Ih9B2LC7ac.png?imageslim" alt="mark"></p>
<p>2.将镜像推送到阿里云上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker login --username=1203901753@qq.com registry.cn-hangzhou.aliyuncs.com</span><br><span class="line"><span class="meta">#</span>                 本地镜像id                                        想要在阿里云上显示的版本号</span><br><span class="line"><span class="meta">$</span> sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/x5456/centos:[镜像版本号]</span><br><span class="line"><span class="meta">$</span> sudo docker push registry.cn-hangzhou.aliyuncs.com/x5456/centos:[镜像版本号]</span><br></pre></td></tr></table></figure>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/8kFIAlBGe5.png?imageslim" alt="mark"></p>
<p>3.在阿里云上查看</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/181005/f533CBd7kE.png?imageslim" alt="mark"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://x54256.github.io/2018/08/21/Docker学习/" data-id="cjmvxlahf000h0gjexq0gs3up" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    <!-- Featured Tags -->

  
    <!-- Short About -->
<section class="visible-md visible-lg">
    <h5><a href="/about/">ABOUT ME</a></h5>
    <div class="short-about">

        

        

        <!-- SNS Link -->
        <ul class="list-inline">
            
            
            

            

            

            
            
            
            
        </ul>
    </div>
</section>

  
    
  <h5>RECENT POSTS</h3>
  <div class="widget">
    <ul>
      
        <li>
          <a href="/2018/09/29/SpringBoot+SpringDataJpa进阶/">Jpa的分页和@Query注解的使用和复杂查询，boot排除自动配置类，为true才启用配置类，SQL分组的使用</a>
        </li>
      
        <li>
          <a href="/2018/09/28/CORS的原理及整合SpringBoot/">CORS的原理及整合SpringBoot</a>
        </li>
      
        <li>
          <a href="/2018/09/27/BS运维/">日常笔记：Dubbo的Filter，httpclient发送webservice请求，Hibranate注解使用，OSS</a>
        </li>
      
        <li>
          <a href="/2018/09/27/Spring注解使用 /">Spring注解使用</a>
        </li>
      
        <li>
          <a href="/2018/09/26/SpringBoot与Redis的整合/">SpringBoot与Redis的整合</a>
        </li>
      
    </ul>
  </div>

  
    <!-- Friends Blog -->

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Yujx<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>