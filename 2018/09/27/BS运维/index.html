<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>日常笔记：Dubbo的Filter，httpclient发送webservice请求，Hibranate注解使用，OSS | x5456</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">日常笔记：Dubbo的Filter，httpclient发送webservice请求，Hibranate注解使用，OSS</h1><a id="logo" href="/.">x5456</a><p class="description">x54256的博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">日常笔记：Dubbo的Filter，httpclient发送webservice请求，Hibranate注解使用，OSS</h1><div class="post-meta">Sep 27, 2018</div><div class="post-content"><h3 id="Dubbo的Filter"><a href="#Dubbo的Filter" class="headerlink" title="Dubbo的Filter"></a>Dubbo的Filter</h3><p><a href="https://blog.csdn.net/mj158518/article/details/47379799" target="_blank" rel="noopener">com.alibaba.dubbo.rpc.Filter接口</a></p>
<p>在开发中，有时候需要限制访问的权限，白名单就是一种方法。对于Java Web应用，Spring的拦截器可以拦截Web接口的调用；而对于dubbo接口，Spring的拦截器就不管用了。</p>
<h4 id="第一步：实现接口"><a href="#第一步：实现接口" class="headerlink" title="第一步：实现接口"></a>第一步：实现接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.*;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorityFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(AuthorityFilter.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ip白名单</span></span><br><span class="line">    <span class="keyword">private</span> IpWhiteList ipWhiteList;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//dubbo通过setter方式自动注入（扩展点加载机制）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIpWhiteList</span><span class="params">(IpWhiteList ipWhiteList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ipWhiteList = ipWhiteList;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!ipWhiteList.isEnabled()) &#123;</span><br><span class="line">            LOGGER.debug(<span class="string">"白名单禁用"</span>);</span><br><span class="line">            <span class="keyword">return</span> invoker.invoke(invocation);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        String clientIp = RpcContext.getContext().getRemoteHost();</span><br><span class="line">        LOGGER.debug(<span class="string">"访问ip为&#123;&#125;"</span>, clientIp);</span><br><span class="line">        List&lt;String&gt; allowedIps = ipWhiteList.getAllowedIps();</span><br><span class="line">        <span class="keyword">if</span> (allowedIps.contains(clientIp)) &#123;</span><br><span class="line">            <span class="keyword">return</span> invoker.invoke(invocation);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> RpcResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：只能通过setter方式来注入其他的bean，且不要标注注解！</strong></p>
<p>dubbo自己会对这些bean进行注入，不需要再标注@Resource让Spring注入，参见扩展点加载</p>
<h4 id="第二步：配置文件"><a href="#第二步：配置文件" class="headerlink" title="第二步：配置文件"></a>第二步：<a href="http://dubbo.apache.org/zh-cn/docs/dev/impls/filter.html" target="_blank" rel="noopener">配置文件</a></h4><p>在resources目录下添加纯文本文件META-INF/dubbo/com.alibaba.dubbo.rpc.Filter，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxxFilter=cn.x5456.xxxFilter</span><br></pre></td></tr></table></figure>
<p>修改dubbo的provider配置文件，在dubbo:provider中添加配置的filter，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">filter</span>=<span class="string">"xxxFilter"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/meilong_whpu/article/details/72179453" target="_blank" rel="noopener">扩展点加载机制</a></p>
<pre><code>只有标有@SPI注解的接口类才会查找扩展点的实现，依次从下面这三个路径读取扩展点文件：META-INF/dubbo/internal 、META-INF/dubbo/ 、META-INF/services/，其中dubbo内部实现的各种扩展文件都放在META-INF/dubbo/internal目录下面。
</code></pre><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/CLh1C0l2bm.png?imageslim" alt="mark"></p>
<p>文件内容，类似下面这样</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/deciJ69Gk0.png?imageslim" alt="mark"></p>
<h3 id="HttpClient作为WebService客户端进行调用服务"><a href="#HttpClient作为WebService客户端进行调用服务" class="headerlink" title="HttpClient作为WebService客户端进行调用服务"></a><a href="https://blog.csdn.net/zilong_zilong/article/details/53932667" target="_blank" rel="noopener">HttpClient作为WebService客户端进行调用服务</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClientCallSoapUtil</span> </span>&#123;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">int</span> socketTimeout = <span class="number">30000</span>;<span class="comment">// 请求超时时间</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">int</span> connectTimeout = <span class="number">30000</span>;<span class="comment">// 传输超时时间</span></span><br><span class="line">   <span class="keyword">static</span> Logger logger = Logger.getLogger(HttpClientCallSoapUtil.class);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用SOAP1.1发送消息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> postUrl</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapXml</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapAction</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">doPostSoap1_1</span><span class="params">(String postUrl, String soapXml,</span></span></span><br><span class="line"><span class="function"><span class="params">         String soapAction)</span> </span>&#123;</span><br><span class="line">      String retStr = <span class="string">""</span>;</span><br><span class="line">      <span class="comment">// 创建HttpClientBuilder</span></span><br><span class="line">      HttpClientBuilder httpClientBuilder = HttpClientBuilder.create();</span><br><span class="line">      <span class="comment">// HttpClient</span></span><br><span class="line">      CloseableHttpClient closeableHttpClient = httpClientBuilder.build();</span><br><span class="line">      HttpPost httpPost = <span class="keyword">new</span> HttpPost(postUrl);</span><br><span class="line">                <span class="comment">//  设置请求和传输超时时间</span></span><br><span class="line">      RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">            .setSocketTimeout(socketTimeout)</span><br><span class="line">            .setConnectTimeout(connectTimeout).build();</span><br><span class="line">      httpPost.setConfig(requestConfig);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         httpPost.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/xml;charset=UTF-8"</span>);</span><br><span class="line">         httpPost.setHeader(<span class="string">"SOAPAction"</span>, soapAction);</span><br><span class="line">         StringEntity data = <span class="keyword">new</span> StringEntity(soapXml,Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">         httpPost.setEntity(data);</span><br><span class="line">         CloseableHttpResponse response = closeableHttpClient.execute(httpPost);</span><br><span class="line">         HttpEntity httpEntity = response.getEntity();</span><br><span class="line">         <span class="keyword">if</span> (httpEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 打印响应内容</span></span><br><span class="line">            retStr = EntityUtils.toString(httpEntity, <span class="string">"UTF-8"</span>);</span><br><span class="line">            logger.info(<span class="string">"response:"</span> + retStr);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 释放资源</span></span><br><span class="line">         closeableHttpClient.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         logger.error(<span class="string">"exception in doPostSoap1_1"</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> retStr;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用SOAP1.2发送消息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> postUrl</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapXml</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> soapAction</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">doPostSoap1_2</span><span class="params">(String postUrl, String soapXml,</span></span></span><br><span class="line"><span class="function"><span class="params">         String soapAction)</span> </span>&#123;</span><br><span class="line">      String retStr = <span class="string">""</span>;</span><br><span class="line">      <span class="comment">// 创建HttpClientBuilder</span></span><br><span class="line">      HttpClientBuilder httpClientBuilder = HttpClientBuilder.create();</span><br><span class="line">      <span class="comment">// HttpClient</span></span><br><span class="line">      CloseableHttpClient closeableHttpClient = httpClientBuilder.build();</span><br><span class="line">      HttpPost httpPost = <span class="keyword">new</span> HttpPost(postUrl);</span><br><span class="line">                <span class="comment">// 设置请求和传输超时时间</span></span><br><span class="line">      RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">            .setSocketTimeout(socketTimeout)</span><br><span class="line">            .setConnectTimeout(connectTimeout).build();</span><br><span class="line">      httpPost.setConfig(requestConfig);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         httpPost.setHeader(<span class="string">"Content-Type"</span>,</span><br><span class="line">               <span class="string">"application/soap+xml;charset=UTF-8"</span>);</span><br><span class="line">         httpPost.setHeader(<span class="string">"SOAPAction"</span>, soapAction);</span><br><span class="line">         StringEntity data = <span class="keyword">new</span> StringEntity(soapXml,</span><br><span class="line">               Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">         httpPost.setEntity(data);</span><br><span class="line">         CloseableHttpResponse response = closeableHttpClient</span><br><span class="line">               .execute(httpPost);</span><br><span class="line">         HttpEntity httpEntity = response.getEntity();</span><br><span class="line">         <span class="keyword">if</span> (httpEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 打印响应内容</span></span><br><span class="line">            retStr = EntityUtils.toString(httpEntity, <span class="string">"UTF-8"</span>);</span><br><span class="line">            logger.info(<span class="string">"response:"</span> + retStr);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 释放资源</span></span><br><span class="line">         closeableHttpClient.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         logger.error(<span class="string">"exception in doPostSoap1_2"</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> retStr;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 需要发送的xml</span></span><br><span class="line">      String orderSoapXml = <span class="string">"&lt;?xml version = \"1.0\" ?&gt;"</span></span><br><span class="line">            + <span class="string">"&lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservices.b.com\"&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Header/&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Body&gt;"</span></span><br><span class="line">            + <span class="string">"      &lt;web:order soapenv:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;in0 xsi:type=\"web:OrderRequest\"&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;mobile xsi:type=\"soapenc:string\" xmlns:soapenc=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;?&lt;/mobile&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;orderStatus xsi:type=\"xsd:int\"&gt;?&lt;/orderStatus&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;productCode xsi:type=\"soapenc:string\" xmlns:soapenc=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;?&lt;/productCode&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;/in0&gt;"</span> + <span class="string">"      &lt;/web:order&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;/soapenv:Body&gt;"</span> + <span class="string">"&lt;/soapenv:Envelope&gt;"</span>;</span><br><span class="line">      String querySoapXml = <span class="string">"&lt;?xml version = \"1.0\" ?&gt;"</span></span><br><span class="line">            + <span class="string">"&lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://webservices.b.com\"&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Header/&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;soapenv:Body&gt;"</span></span><br><span class="line">            + <span class="string">"      &lt;web:query soapenv:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;in0 xsi:type=\"web:QueryRequest\"&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;endTime xsi:type=\"xsd:dateTime\"&gt;?&lt;/endTime&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;mobile xsi:type=\"soapenc:string\" xmlns:soapenc=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;?&lt;/mobile&gt;"</span></span><br><span class="line">            + <span class="string">"            &lt;startTime xsi:type=\"xsd:dateTime\"&gt;?&lt;/startTime&gt;"</span></span><br><span class="line">            + <span class="string">"         &lt;/in0&gt;"</span> + <span class="string">"      &lt;/web:query&gt;"</span></span><br><span class="line">            + <span class="string">"   &lt;/soapenv:Body&gt;"</span> + <span class="string">"&lt;/soapenv:Envelope&gt;"</span>;</span><br><span class="line">      String postUrl = <span class="string">"http://localhost:8080/services/WebServiceFromB"</span>;</span><br><span class="line">      <span class="comment">//采用SOAP1.1调用服务端，这种方式能调用服务端为soap1.1和soap1.2的服务</span></span><br><span class="line">      doPostSoap1_1(postUrl, orderSoapXml, <span class="string">""</span>);</span><br><span class="line">      doPostSoap1_1(postUrl, querySoapXml, <span class="string">""</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//采用SOAP1.2调用服务端，这种方式只能调用服务端为soap1.2的服务</span></span><br><span class="line">      <span class="comment">//doPostSoap1_2(postUrl, orderSoapXml, "order");</span></span><br><span class="line">      <span class="comment">//doPostSoap1_2(postUrl, querySoapXml, "query");</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>问题，怎么传参？？</p>
<p>将xml字符串中的‘？’改为需要传的参数</p>
<h3 id="CORS解决跨域问题"><a href="#CORS解决跨域问题" class="headerlink" title="CORS解决跨域问题"></a><a href="https://www.jianshu.com/p/9203e9b14465" target="_blank" rel="noopener">CORS解决跨域问题</a></h3><p>使用前后端分离模式开发项目时，往往会遇到这样一个问题 – 无法跨域获取服务端数据</p>
<p>这是由于浏览器的同源策略导致的，目的是为了安全。在前后端分离开发模式备受青睐的今天，前端和后台项目往往会在不同的环境下进行开发，这时就会出现跨域请求数据的需求，目前的解决方案主要有以下几种：</p>
<blockquote>
<p>JSONP、iframe、代理模式、CORS等等</p>
</blockquote>
<p>前面几种方式在这里不讲，网上有很多资料。在这里我主要分享一下CORS这种解决方式，CORS即“跨域资源共享”，它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</p>
<p>使用 CORS 跨域的时候和普通的 ajax 过程是一样的，只是浏览器在发现这是一个跨域请求的时候会自动帮我们处理一些事情，所以说<strong>只要服务端提供支持，前端是不需要做额外的事情的</strong>。</p>
<h4 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h4><p>实现的大概思路是这样的，首先使用过滤器获取请求对象request的信息，比如Origin 字段（表示请求来自哪个源，包括协议、域名、端口），通过预先配置的参数判断请求是否合法，然后设置响应对象response的头信息，实现跨域资源请求。在介绍实现方式之前我们先来了解一下会用到的响应头信息。</p>
<h4 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h4><ul>
<li>Access-Control-Allow-Methods<br> 用来列出浏览器的CORS请求允许使用的HTTP方法，如：GET、POST、PUT、DELETE、OPTIONS</li>
<li>Access-Control-Allow-Credentials<br> 表示是否支持跨域Cookie</li>
<li>Access-Control-Allow-Headers<br> 逗号分隔的字符串，表示服务器支持的所有头信息字段，如Content-Type以及自定义的字段</li>
<li>Access-Control-Expose-Headers<br> 与“Access-Control-Allow-Headers”相反，表示不支持的头信息字段</li>
<li>Access-Control-Allow-Origin<br> 允许跨域的请求源信息，包括协议、域名、端口，为*表示允许所有请求来源，并且<strong>只能设置一个请求源</strong></li>
</ul>
<h4 id="使用Servlet-Filter-实现-CORS"><a href="#使用Servlet-Filter-实现-CORS" class="headerlink" title="使用Servlet Filter 实现 CORS"></a>使用Servlet Filter 实现 CORS</h4><pre><code>CORS 跨域协议的实现是通过使用一组 HTTP 首部字段实现的，其核心是服务端返回响应中的 `Access-Control-Allow-Origin` 首部字段，这个字段来声明服务端允许来自哪些源的请求访问该资源，浏览器可以根据这个响应首部字段来判断是否可以放行跨域请求。因此要实现 CORS ，我们可以在项目中声明一个 Filter 过滤器为响应加上需要的 `Access-Control-Allow-*`首部。
</code></pre><p>首先创建一个实现 <code>javax.servlet.Filter</code> 接口的过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CORSFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"work"</span>);</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"POST, GET"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Max-Age"</span>, <span class="string">"3600"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With"</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后在web.xml中，进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- CORS Filter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CORSFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.ken.localserver.filter.CORSFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CORSFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="使用-Spring-MVC-的-CrossOrigin-注解实现-CORS-跨域"><a href="#使用-Spring-MVC-的-CrossOrigin-注解实现-CORS-跨域" class="headerlink" title="使用 Spring MVC 的 @CrossOrigin 注解实现 CORS 跨域"></a>使用 Spring MVC 的 @CrossOrigin 注解实现 CORS 跨域</h4><p>   Spring Framework 从 4.2 版本中开始原生支持 CORS，相比上面的需要配置 Filter 过滤器的实现方式，使用原生的 <code>@CrossOrigin</code> 注解的实现方式来得更加简单。</p>
<p>   要启用 Spring MVC 的 CORS 支持十分简单，只需要添加一个<code>@CrossOrigin</code>注解即可，根据添加注解位置可以控制配置的细粒度，如：允许这个Controller 还是特定的方法</p>
<ul>
<li><p>在方法上使用 <code>@CrossOrigin</code> 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/account"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CrossOrigin</span></span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">retrieve</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上例中将允许对<code>retrieve()</code>方法的跨域访问。默认情况下， <code>@CrossOrigin</code> 注解将允许来自任意的源站以及任意 HTTP 请求方法的请求访问。</p>
</li>
<li><p>在Controller 上使用 <code>@CrossOrigin</code> 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span>(origins = <span class="string">"http://domain2.com"</span>, maxAge = <span class="number">3600</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/account"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">retrieve</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当 <code>@CrossOrigin</code> 注解声明在Controller 时，将允许对 Controller 下得所有方法得跨域请求。另外，如果不满足与  <code>@CrossOrigin</code>  注解得默认属性，我们可以自定义配置 CORS 属性。</p>
</li>
<li><p>同时在 Controller 和方法上使用  <code>@CrossOrigin</code>  注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span>(maxAge = <span class="number">3600</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/account"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CrossOrigin</span>(origins = <span class="string">"http://domain2.com"</span>)</span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">retrieve</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果同时在 Controller 和方法上都有使用<code>@CrossOrigin</code> 注解，那么在具体某个方法上的 CORS 属性将是两个注解属性合并的结果，如果属性的设置发生冲突，那么Controller 上的主机属性将被覆盖。</p>
</li>
<li><p>全局 CORS 配置</p>
<p>在某些情况，我们并不需要针对不同的URL来配置不同 CORS 属性，那么我们可以通过一个全局的 CORS 配置来避免单独注解配置的麻烦。</p>
<ul>
<li><p>基于 JavaConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">"/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在以及 Java 配置的配置方式中，我们只需要简单加入以上的代码就可以配置全局的 CORS。默认情况下，将允许来自任意源站以及任意 HTTP 请求方法的请求访问。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">"/api/**"</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">"http://domain2.com"</span>)</span><br><span class="line">                .allowedMethods(<span class="string">"PUT"</span>, <span class="string">"DELETE"</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">"header1"</span>, <span class="string">"header2"</span>, <span class="string">"header3"</span>)</span><br><span class="line">                .exposedHeaders(<span class="string">"header1"</span>, <span class="string">"header2"</span>)</span><br><span class="line">                .allowCredentials(<span class="keyword">false</span>).maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时，我们也可以根据自己的需要 CORS 的相关属性进行配置，配置的方式如上面的代码所示。</p>
</li>
</ul>
</li>
<li><p>基于 XML 配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:cors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:cors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>基于 XML 配置文件的配置方式也是十分简单，只需要 Spring 的Context 配置文件中加入上面的 <code>&lt;mvc:cors&gt;</code> 即可。同样的，默认情况下将允许来自任意源站以及任意 HTTP 请求方法的请求访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:cors&gt;</span><br><span class="line">    &lt;mvc:mapping path=&quot;/api/**&quot;</span><br><span class="line">        allowed-origins=&quot;http://domain1.com, http://domain2.com&quot;</span><br><span class="line">        allowed-methods=&quot;GET, PUT&quot;</span><br><span class="line">        allowed-headers=&quot;header1, header2, header3&quot;</span><br><span class="line">        exposed-headers=&quot;header1, header2&quot; allow-credentials=&quot;false&quot;</span><br><span class="line">        max-age=&quot;123&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;mvc:mapping path=&quot;/resources/**&quot;</span><br><span class="line">        allowed-origins=&quot;http://domain1.com&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mvc:cors&gt;</span><br></pre></td></tr></table></figure>
<p>另外，也可以通过上面的方式根据自己需要来自定义 CORS 属性。</p>
</li>
</ul>
<h3 id="Java关键字default"><a href="#Java关键字default" class="headerlink" title="Java关键字default"></a>Java关键字default</h3><pre><code>default常用于接口中，我们本来写Java接口的时候，是不能有方法体的函数，default关键字在接口中修饰方法时，方法可以有方法体。
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Default</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"method in interface"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomeThing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"do something in interface"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Spring-Data-Jpa中的CrudRepository和JpaRepository接口之间的区别"><a href="#Spring-Data-Jpa中的CrudRepository和JpaRepository接口之间的区别" class="headerlink" title="Spring Data Jpa中的CrudRepository和JpaRepository接口之间的区别"></a>Spring Data Jpa中的CrudRepository和JpaRepository接口之间的区别</h3><p>JpaRepository延伸PagingAndSortingRepository，其继而延伸CrudRepository。</p>
<p>它们的主要功能是：</p>
<p>> <a href="http://static.springsource.org/spring-data/data-commons/docs/current/api/org/springframework/data/repository/CrudRepository.html" target="_blank" rel="noopener">CrudRepository</a>主要提供CRUD功能。<br>> <a href="http://static.springsource.org/spring-data/data-commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html" target="_blank" rel="noopener">PagingAndSortingRepository</a>提供了做分页和排序记录的方法。<br>> <a href="http://static.springsource.org/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html" target="_blank" rel="noopener">JpaRepository</a>提供了一些JPA相关的方法，例如刷新持久化上下文和批量删除记录。</p>
<p>因为上面提到的继承，JpaRepository将具有CrudRepository和PagingAndSortingRepository的所有函数。因此，如果您不需要存储库具有JpaRepository和PagingAndSortingRepository提供的函数，请使用CrudRepository。</p>
<h3 id="Spring-AOP注解"><a href="#Spring-AOP注解" class="headerlink" title="Spring AOP注解"></a>Spring AOP<a href="https://blog.csdn.net/rainbow702/article/details/52185827" target="_blank" rel="noopener">注解</a></h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/Jeh4Dj6J3J.png?imageslim" alt="mark"></p>
<p>标识有@DomainFilterResource的方法有这个==环绕通知==</p>
<h3 id="利用axis发送webservice的工具类"><a href="#利用axis发送webservice的工具类" class="headerlink" title="利用axis发送webservice的工具类"></a>利用axis发送webservice的工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"><span class="keyword">import</span> javax.xml.namespace.QName;</span><br><span class="line"><span class="keyword">import</span> javax.xml.rpc.ParameterMode;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.OutputKeys;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.dom.DOMSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.stream.StreamResult;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.axis.Constants;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.client.Call;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.client.Service;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.encoding.XMLType;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.message.MessageElement;</span><br><span class="line"><span class="keyword">import</span> org.apache.axis.types.Schema;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.jettison.json.JSONException;</span><br><span class="line"><span class="keyword">import</span> org.codehaus.jettison.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 利用axis解析webservice</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> TangSir</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebServiceByAxisUtil</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Service service; <span class="comment">// 定义一个服务</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		service = <span class="keyword">new</span> Service();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回单个String类型的值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSingleStrFromWb</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 返回值类型，设置为string</span></span><br><span class="line">			call.setReturnType(<span class="keyword">new</span> QName(<span class="string">"http://www.w3.org/2001/XMLSchema"</span>,<span class="string">"string"</span>));</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			Object obj = call.invoke(values);</span><br><span class="line">			<span class="comment">// 返回值</span></span><br><span class="line">			<span class="keyword">return</span> obj.toString();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回XML的String类型值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getXMLStrFromWb</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 返回值类型</span></span><br><span class="line">			call.setReturnType(Constants.XSD_SCHEMA);</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			Object o = call.invoke(values);</span><br><span class="line">			Schema schema = (Schema) o;</span><br><span class="line">			MessageElement[] msgele = schema.get_any();</span><br><span class="line">			String xml = <span class="string">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; msgele.length; i++) &#123;</span><br><span class="line">				xml += msgele[i].toString().replace(<span class="string">"\""</span>, <span class="string">"\'"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> xml.toString();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 利用W3C解析xml，并返回xml字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getXMLStrFromWbByW3C</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			call.setReturnClass(org.w3c.dom.Document.class); <span class="comment">// 返回值类型</span></span><br><span class="line">			Object o = call.invoke(values);</span><br><span class="line">			String result = toStringFromDoc((org.w3c.dom.Document) o);</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 利用W3C解析xml，并返回org.w3c.dom.Document</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace</span></span><br><span class="line"><span class="comment">	 *            webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">	 *            webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName</span></span><br><span class="line"><span class="comment">	 *            方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras</span></span><br><span class="line"><span class="comment">	 *            方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values</span></span><br><span class="line"><span class="comment">	 *            参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> org.w3c.dom.<span class="function">Document <span class="title">getXMLDocumentStrFromWbByW3C</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			String namespace, String wbUrl, String methodName, String[] paras,</span></span></span><br><span class="line"><span class="function"><span class="params">			Object[] values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = getCall(namespace, wbUrl, methodName, paras);</span><br><span class="line">			<span class="comment">// 执行方法</span></span><br><span class="line">			call.setReturnClass(org.w3c.dom.Document.class); <span class="comment">// 返回值类型</span></span><br><span class="line">			Object o = call.invoke(values);</span><br><span class="line">			<span class="keyword">return</span> (org.w3c.dom.Document) o;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回org.codehaus.jettison.json.JSONObject类型的json值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> wbUrl webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title">getJsonFromWbByW3C</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		String result = getSingleStrFromWb(namespace, wbUrl, methodName, paras,values);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			JSONObject json = <span class="keyword">new</span> JSONObject(result);</span><br><span class="line">			<span class="keyword">return</span> json;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回TreeMap类型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> values 参数值,与参数一一对应</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TreeMap <span class="title">getMapFromWbByW3C</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras, Object[] values)</span> </span>&#123;</span><br><span class="line">		String result = getSingleStrFromWb(namespace, wbUrl, methodName, paras,values);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//根据字符串生成Json对象</span></span><br><span class="line">			JSONObject json = <span class="keyword">new</span> JSONObject(result);</span><br><span class="line">			TreeMap&lt;String, String&gt; map = <span class="keyword">new</span> TreeMap();</span><br><span class="line">			<span class="comment">//将Json对象转换成TreeMap</span></span><br><span class="line">			Iterator keys = json.keys();</span><br><span class="line">			String key = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">while</span> (keys.hasNext()) &#123;</span><br><span class="line">				key = keys.next().toString();</span><br><span class="line">				map.put(key, json.get(key).toString());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> map;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取Call</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> namespace webService的命名空间，默认为http://tempuri.org/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url webService的地址</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> paras 方法的参数名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Call <span class="title">getCall</span><span class="params">(String namespace, String wbUrl,</span></span></span><br><span class="line"><span class="function"><span class="params">			String methodName, String[] paras)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//默认的命名空间为 http://tempuri.org/</span></span><br><span class="line">		<span class="keyword">if</span> (namespace == <span class="keyword">null</span>) &#123;</span><br><span class="line">			namespace = <span class="string">"http://tempuri.org/"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Call call = (Call) service.createCall();</span><br><span class="line">			call.setTargetEndpointAddress(<span class="keyword">new</span> java.net.URL(wbUrl));</span><br><span class="line">			call.setEncodingStyle(<span class="keyword">null</span>);</span><br><span class="line">			<span class="comment">// 解决错误：服务器未能识别 HTTP 头 SOAPAction 的值，好像是只有C#的webservice需要加这个</span></span><br><span class="line">			call.setUseSOAPAction(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">//设置URI</span></span><br><span class="line">			call.setSOAPActionURI(namespace + methodName);</span><br><span class="line">			<span class="comment">// 设置调用方法</span></span><br><span class="line">			call.setOperationName(<span class="keyword">new</span> QName(namespace, methodName));</span><br><span class="line">			<span class="comment">// 设置参数</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paras.length; i++) &#123;</span><br><span class="line">				call.addParameter(<span class="keyword">new</span> QName(namespace, paras[i]),<span class="comment">// 参数</span></span><br><span class="line">						Constants.XSD_STRING, ParameterMode.IN);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> call;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(e.getMessage());</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将w3c类型的document转换成String字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">toStringFromDoc</span><span class="params">(Document document)</span> </span>&#123;</span><br><span class="line">		String result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (document != <span class="keyword">null</span>) &#123;</span><br><span class="line">			StringWriter strWtr = <span class="keyword">new</span> StringWriter();</span><br><span class="line">			StreamResult strResult = <span class="keyword">new</span> StreamResult(strWtr);</span><br><span class="line">			TransformerFactory tfac = TransformerFactory.newInstance();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				javax.xml.transform.Transformer t = tfac.newTransformer();</span><br><span class="line">				t.setOutputProperty(OutputKeys.ENCODING, <span class="string">"UTF-8"</span>);</span><br><span class="line">				t.setOutputProperty(OutputKeys.INDENT, <span class="string">"yes"</span>);</span><br><span class="line">				t.setOutputProperty(OutputKeys.METHOD, <span class="string">"xml"</span>); <span class="comment">// xml, html,</span></span><br><span class="line">				<span class="comment">// text</span></span><br><span class="line">				t.setOutputProperty(<span class="string">"&#123;http://xml.apache.org/xslt&#125;indent-amount"</span>, <span class="string">"4"</span>);</span><br><span class="line">				t.transform(<span class="keyword">new</span> DOMSource(document.getDocumentElement()),</span><br><span class="line">						strResult);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				System.err.println(<span class="string">"XML.toString(Document): "</span> + e);</span><br><span class="line">			&#125;</span><br><span class="line">			result = strResult.getWriter().toString();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				strWtr.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Hibranate——一对多（注解）"><a href="#Hibranate——一对多（注解）" class="headerlink" title="Hibranate——一对多（注解）"></a>Hibranate——一对多（注解）</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/g51GJcBiEE.png?imageslim" alt="mark"></p>
<p>还有，写之前好好想想，==外键==到底在那个表中。</p>
<h3 id="Hibranate——表中字段自关联（注解）"><a href="#Hibranate——表中字段自关联（注解）" class="headerlink" title="Hibranate——表中字段自关联（注解）"></a>Hibranate——表中字段自关联（注解）</h3><p>自关联其实就是，@ManyToOne和@OneToMany注解</p>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/b49ekCJhBJ.png?imageslim" alt="mark"></p>
<h3 id="Hibranate——多对多（注解）"><a href="#Hibranate——多对多（注解）" class="headerlink" title="Hibranate——多对多（注解）"></a>Hibranate——多对多（注解）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************用户方**************/</span></span><br><span class="line"><span class="meta">@ManyToMany</span></span><br><span class="line"><span class="meta">@Cascade</span>(org.hibernate.annotations.CascadeType.SAVE_UPDATE)<span class="comment">//使用hibernate注解级联保存和更新</span></span><br><span class="line"><span class="meta">@JoinTable</span>(name = <span class="string">"t_user_role"</span>,</span><br><span class="line">joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"user_id"</span>)&#125;,<span class="comment">//JoinColumns定义本方在中间表的主键映射</span></span><br><span class="line">inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"role_id"</span>)&#125;)<span class="comment">//inverseJoinColumns定义另一在中间表的主键映射</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Role&gt; roles;</span><br><span class="line"><span class="comment">/********************角色方**************/</span></span><br><span class="line"><span class="meta">@ManyToMany</span></span><br><span class="line"><span class="meta">@Cascade</span>(org.hibernate.annotations.CascadeType.SAVE_UPDATE)<span class="comment">//使用hibernate注解级联保存和更新</span></span><br><span class="line"><span class="meta">@JoinTable</span>(name = <span class="string">"t_user_role"</span>,</span><br><span class="line">joinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"role_id"</span>)&#125;,<span class="comment">//JoinColumns定义本方在中间表的主键映射</span></span><br><span class="line">inverseJoinColumns = &#123;<span class="meta">@JoinColumn</span>(name = <span class="string">"user_id"</span>)&#125;)<span class="comment">//inverseJoinColumns定义另一在中间表的主键映射</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;User&gt; users;</span><br></pre></td></tr></table></figure>
<p>在这里，我们将两边都设为主控方，这样两边都可以对关联关系进行维护。假如我们只需要User方维护关联关系，可以将角色方改成如下配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManyToMany</span>(mapperBy = <span class="string">"roles"</span>)</span><br><span class="line"><span class="meta">@Cascade</span>(org.hibernate.annotations.CascadeType.SAVE_UPDATE)<span class="comment">//使用hibernate注解级联保存和更新</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;User&gt; users;</span><br></pre></td></tr></table></figure>
<h3 id="Hibranate使用问题"><a href="#Hibranate使用问题" class="headerlink" title="Hibranate使用问题"></a>Hibranate使用问题</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/ca86KcDcm4.png?imageslim" alt="mark"></p>
<p>在返回的时候，如果entity中有注解，需要转成dto（没有注解的），==否则会导致序列化失败==</p>
<ul>
<li>返回：<strong>在服务提供者与消费者之间的通信的时候不能使用含有JPA注解的实体类</strong></li>
</ul>
<p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/JBL20A3hI2.png?imageslim" alt="mark"></p>
<p>可以使用==Dozer==进行对象转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Mapper dozerMapper;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;BizPlanManageProjectDTO&gt; <span class="title">Entity2DTO</span><span class="params">(List&lt;BizPlanManageProject&gt; entities)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;BizPlanManageProjectDTO&gt; bizPlanManageProjectDTOS = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (BizPlanManageProject entity : entities) &#123;</span><br><span class="line">        </span><br><span class="line">        BizPlanManageProjectDTO bizDto = <span class="keyword">this</span>.dozerMapper.map(entity, BizPlanManageProjectDTO.class);</span><br><span class="line">        bizPlanManageProjectDTOS.add(bizDto);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bizPlanManageProjectDTOS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>注解版entry不加Lazy注解，默认不是懒加载</strong></li>
</ul>
<h3 id="阿里云OSS使用"><a href="#阿里云OSS使用" class="headerlink" title="阿里云OSS使用"></a><a href="https://pan.baidu.com/s/1OxYewBfhpXZce1U-Bk_DcQ" target="_blank" rel="noopener">阿里云OSS使用</a></h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180927/LBbma6micF.png?imageslim" alt="mark"></p>
<h3 id="Postman的使用"><a href="#Postman的使用" class="headerlink" title="Postman的使用"></a>Postman的使用</h3><p><img src="http://pfdxc2ax8.bkt.clouddn.com/blog/180925/lfij3eEBha.png?imageslim" alt="mark"></p>
<h3 id="Controller层使用-Value注解"><a href="#Controller层使用-Value注解" class="headerlink" title="@Controller层使用@Value注解"></a>@Controller层使用@Value注解</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在controller 中使用 properties 文件 所以加上这个 配置项--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"configProperties"</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertiesFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:config/web-server.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/日常笔记/">日常笔记</a></div><div class="post-nav"><a class="pre" href="/2018/09/28/CORS的原理及整合SpringBoot/">CORS的原理及整合SpringBoot</a><a class="next" href="/2018/09/27/Spring注解使用 /">Spring注解使用</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://x54256.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Gitlab/" style="font-size: 15px;">Gitlab</a> <a href="/tags/日常笔记/" style="font-size: 15px;">日常笔记</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/dubbo/" style="font-size: 15px;">dubbo</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/30/SpringBoot整合SpringDataJpa双数据源/">SpringBoot整合SpringDataJpa双数据源</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/30/SpringBoot整合mongodb/">SpringBoot整合mongodb</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/SpringBoot+SpringDataJpa进阶/">Jpa的分页和@Query注解的使用和复杂查询，boot排除自动配置类，为true才启用配置类，SQL分组的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/28/CORS的原理及整合SpringBoot/">CORS的原理及整合SpringBoot</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/BS运维/">日常笔记：Dubbo的Filter，httpclient发送webservice请求，Hibranate注解使用，OSS</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/Spring注解使用 /">Spring注解使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/SpringBoot与Redis的整合/">SpringBoot与Redis的整合</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/24/gitlab+idea的使用/">Idea中使用Gitlab</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/11/Gradle+idea配置/">Gradle+idea的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/03/Dubbo/">Dubbo的使用，以及整合springboot</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.cnblogs.com/x54256" title="cnblogs" target="_blank">cnblogs</a><ul></ul><a href="https://github.com/x54256" title="git" target="_blank">git</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">x5456.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>